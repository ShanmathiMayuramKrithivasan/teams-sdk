"use strict";(self.webpackChunkteams_md=self.webpackChunkteams_md||[]).push([[5248],{26802:(e,n,t)=>{t.d(n,{A:()=>o});var a=t(22147),s=t(62540);function o({language:e,children:n}){return(0,a.zy)().pathname.includes(`/${e}/`)?(0,s.jsx)(s.Fragment,{children:n}):null}},33169:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/compose-area-1c7340e445681d29b0c675f72985a10e.png"},40462:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/message-3851dc816fb377942fa9d1ee49ef8e41.png"},43023:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>c});var a=t(63696);const s={},o=a.createContext(s);function i(e){const n=a.useContext(o);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),a.createElement(o.Provider,{value:n},e.children)}},55429:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/fetch-conversation-members-5072bed90a03c529a5378f8e2b9946a4.png"},78022:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/message-command-24514540c1a0a417b3bcfc517f7ddd3e.png"},92015:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/parameters-12c01d0339a357d6dbab4090c805aff4.png"},99270:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>r,default:()=>p,frontMatter:()=>c,metadata:()=>a,toc:()=>m});const a=JSON.parse('{"id":"typescript/in-depth-guides/message-extensions/action-commands","title":"Action Commands","description":"\x3c!--","source":"@site/docs/main/typescript/in-depth-guides/message-extensions/action-commands.mdx","sourceDirName":"typescript/in-depth-guides/message-extensions","slug":"/typescript/in-depth-guides/message-extensions/action-commands","permalink":"/teams-sdk/typescript/in-depth-guides/message-extensions/action-commands","draft":false,"unlisted":false,"editUrl":"https://github.com/microsoft/teams-sdk/tree/main/teams.md/docs/main/typescript/in-depth-guides/message-extensions/action-commands.mdx","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"sidebar_label":"Action Commands","title":"Action Commands","summary":"Learn how to create action commands for message extensions that present modal dialogs to collect or display information in Teams."},"sidebar":"default","previous":{"title":"Message Extensions","permalink":"/teams-sdk/typescript/in-depth-guides/message-extensions/"},"next":{"title":"Search Commands","permalink":"/teams-sdk/typescript/in-depth-guides/message-extensions/search-commands"}}');var s=t(62540),o=t(43023),i=t(26802);const c={sidebar_position:1,sidebar_label:"Action Commands",title:"Action Commands",summary:"Learn how to create action commands for message extensions that present modal dialogs to collect or display information in Teams."},r="Action commands",d={},m=[{value:"Action command invocation locations",id:"action-command-invocation-locations",level:2},{value:"Compose Area and Box",id:"compose-area-and-box",level:3},{value:"Message action command",id:"message-action-command",level:3},{value:"Setting up your Teams app manifest",id:"setting-up-your-teams-app-manifest",level:2},{value:"Handle submission",id:"handle-submission",level:2},{value:"Create card",id:"create-card",level:3},{value:"Create message details card",id:"create-message-details-card",level:3},{value:"Handle opening adaptive card dialog",id:"handle-opening-adaptive-card-dialog",level:2},{value:"Create conversation members card",id:"create-conversation-members-card",level:3},{value:"Resources",id:"resources",level:2}];function l(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"action-commands",children:"Action commands"})}),"\n",(0,s.jsx)(n.p,{children:"Action commands allow you to present your users with a modal pop-up called a dialog in Teams. The dialog collects or displays information, processes the interaction, and sends the information back to Teams compose box."}),"\n",(0,s.jsx)(n.h2,{id:"action-command-invocation-locations",children:"Action command invocation locations"}),"\n",(0,s.jsx)(n.p,{children:"There are three different areas action commands can be invoked from:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Compose Area"}),"\n",(0,s.jsx)(n.li,{children:"Compose Box"}),"\n",(0,s.jsx)(n.li,{children:"Message"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"compose-area-and-box",children:"Compose Area and Box"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Screenshot of Teams with outlines around the &#39;Compose Box&#39; (for typing messages) and the &#39;Compose Area&#39; (the menu option next to the compose box that provides a search bar for actions and apps).",src:t(33169).A+"",width:"2762",height:"1464"})}),"\n",(0,s.jsx)(n.h3,{id:"message-action-command",children:"Message action command"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Screenshot of message extension response in Teams. By selecting the &#39;...&#39; button, a menu has opened with &#39;More actions&#39; option in which they can select from a list of available message extension actions.",src:t(40462).A+"",width:"3020",height:"1546"})}),"\n",(0,s.jsx)(n.admonition,{type:"tip",children:(0,s.jsxs)(n.p,{children:["See the ",(0,s.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/microsoftteams/platform/messaging-extensions/how-to/action-commands/define-action-command?tabs=Teams-toolkit%2Cdotnet#select-action-command-invoke-locations",children:"Invoke Locations"})," guide to learn more about the different entry points for action commands."]})}),"\n",(0,s.jsx)(n.h2,{id:"setting-up-your-teams-app-manifest",children:"Setting up your Teams app manifest"}),"\n",(0,s.jsx)(n.p,{children:"To use action commands you have define them in the Teams app manifest. Here is an example:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'"composeExtensions": [\n    {\n        "botId": "${{BOT_ID}}",\n        "commands": [\n            {\n            "id": "createCard",\n            "type": "action",\n            "context": [\n                "compose",\n                "commandBox"\n            ],\n            "description": "Command to run action to create a card from the compose box.",\n            "title": "Create Card",\n            "parameters": [\n                {\n                    "name": "title",\n                    "title": "Card title",\n                    "description": "Title for the card",\n                    "inputType": "text"\n                },\n                {\n                    "name": "subTitle",\n                    "title": "Subtitle",\n                    "description": "Subtitle for the card",\n                    "inputType": "text"\n                },\n                {\n                    "name": "text",\n                    "title": "Text",\n                    "description": "Text for the card",\n                    "inputType": "textarea"\n                }\n            ]\n            },\n            {\n                "id": "getMessageDetails",\n                "type": "action",\n                "context": [\n                    "message"\n                ],\n                "description": "Command to run action on message context.",\n                "title": "Get Message Details"\n            },\n            {\n                "id": "fetchConversationMembers",\n                "description": "Fetch the conversation members",\n                "title": "Fetch Conversation Members",\n                "type": "action",\n                "fetchTask": true,\n                "context": [\n                    "compose"\n                ]\n            },\n        ]\n    }\n]\n'})}),"\n",(0,s.jsx)(n.p,{children:"Here we have defining three different commands:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"createCard"})," - that can be invoked from either the ",(0,s.jsx)(n.code,{children:"compose"})," or ",(0,s.jsx)(n.code,{children:"commandBox"})," areas. Upon invocation a dialog will popup asking the user to fill the ",(0,s.jsx)(n.code,{children:"title"}),", ",(0,s.jsx)(n.code,{children:"subTitle"}),", and ",(0,s.jsx)(n.code,{children:"text"}),"."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Screenshot of a message extension dialog with the editable fields &#39;Card title&#39;, &#39;Subtitle&#39;, and &#39;Text&#39;.",src:t(92015).A+"",width:"3002",height:"1550"})}),"\n",(0,s.jsxs)(n.ol,{start:"2",children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"getMessageDetails"})," - It is invoked from the ",(0,s.jsx)(n.code,{children:"message"})," overflow menu. Upon invocation the message payload will be sent to the app which will then return the details like ",(0,s.jsx)(n.code,{children:"createdDate"}),", etc."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Screenshot of the &#39;More actions&#39; message extension menu expanded with &#39;Get Message Details&#39; option selected.",src:t(78022).A+"",width:"3002",height:"1562"})}),"\n",(0,s.jsxs)(n.ol,{start:"3",children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"fetchConversationMembers"})," - It is invoked from the ",(0,s.jsx)(n.code,{children:"compose"})," area. Upon invocation the app will return an adaptive card in the form of a dialog with the conversation roster."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Screenshot of the &#39;Fetch Conversation Members&#39; option exposed from the message extension menu &#39;...&#39; option.",src:t(55429).A+"",width:"2998",height:"1548"})}),"\n",(0,s.jsx)(n.h2,{id:"handle-submission",children:"Handle submission"}),"\n",(0,s.jsx)(i.A,{language:"typescript",children:(0,s.jsxs)(n.p,{children:["Handle submission when the ",(0,s.jsx)(n.code,{children:"createCard"})," or ",(0,s.jsx)(n.code,{children:"getMessageDetails"})," action commands are invoked."]})}),"\n",(0,s.jsx)(i.A,{language:"typescript",children:(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { cardAttachment } from '@microsoft/teams.api';\nimport { App } from '@microsoft/teams.apps';\nimport { IAdaptiveCard } from '@microsoft/teams.cards';\n// ...\n\napp.on('message.ext.submit', async ({ activity }) => {\n  const { commandId } = activity.value;\n  let card: IAdaptiveCard;\n\n  if (commandId === 'createCard') {\n    // The activity.value.commandContext == \"compose\" here because it was from\n    // the compose box\n    card = createCard(activity.value.data);\n  } else if (commandId === 'getMessageDetails' && activity.value.messagePayload) {\n    // The activity.value.commandContext == \"message\" here because it was from\n    // the message context\n    card = createMessageDetailsCard(activity.value.messagePayload);\n  } else {\n    throw new Error(`Unknown commandId: ${commandId}`);\n  }\n\n  return {\n    composeExtension: {\n      type: 'result',\n      attachmentLayout: 'list',\n      attachments: [cardAttachment('adaptive', card)],\n    },\n  };\n});\n"})})}),"\n",(0,s.jsx)(n.h3,{id:"create-card",children:"Create card"}),"\n",(0,s.jsxs)(i.A,{language:"typescript",children:[(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"createCard()"})," function"]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { AdaptiveCard, TextBlock, Image } from '@microsoft/teams.cards';\n// ...\n\ninterface IFormData {\n  title: string;\n  subtitle: string;\n  text: string;\n}\n\nexport function createCard(data: IFormData) {\n  return new AdaptiveCard(\n    new Image(IMAGE_URL),\n    new TextBlock(data.title, {\n      size: 'Large',\n      weight: 'Bolder',\n      color: 'Accent',\n      style: 'heading',\n    }),\n    new TextBlock(data.subtitle, {\n      size: 'Small',\n      weight: 'Lighter',\n      color: 'Good',\n    }),\n    new TextBlock(data.text, {\n      wrap: true,\n      spacing: 'Medium',\n    })\n  );\n}\n"})})]}),"\n",(0,s.jsx)(n.h3,{id:"create-message-details-card",children:"Create message details card"}),"\n",(0,s.jsxs)(i.A,{language:"typescript",children:[(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"createMessageDetailsCard()"})," function"]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { Message } from '@microsoft/teams.api';\nimport {\n  AdaptiveCard,\n  CardElement,\n  TextBlock,\n  ActionSet,\n  OpenUrlAction,\n} from '@microsoft/teams.cards';\n// ...\n\nexport function createMessageDetailsCard(messagePayload: Message) {\n  const cardElements: CardElement[] = [\n    new TextBlock('Message Details', {\n      size: 'Large',\n      weight: 'Bolder',\n      color: 'Accent',\n      style: 'heading',\n    }),\n  ];\n\n  if (messagePayload?.body?.content) {\n    cardElements.push(\n      new TextBlock('Content', {\n        size: 'Medium',\n        weight: 'Bolder',\n        spacing: 'Medium',\n      }),\n      new TextBlock(messagePayload.body.content)\n    );\n  }\n\n  if (messagePayload?.attachments?.length) {\n    cardElements.push(\n      new TextBlock('Attachments', {\n        size: 'Medium',\n        weight: 'Bolder',\n        spacing: 'Medium',\n      }),\n      new TextBlock(`Number of attachments: ${messagePayload.attachments.length}`, {\n        wrap: true,\n        spacing: 'Small',\n      })\n    );\n  }\n\n  if (messagePayload?.createdDateTime) {\n    cardElements.push(\n      new TextBlock('Created Date', {\n        size: 'Medium',\n        weight: 'Bolder',\n        spacing: 'Medium',\n      }),\n      new TextBlock(messagePayload.createdDateTime, {\n        wrap: true,\n        spacing: 'Small',\n      })\n    );\n  }\n\n  if (messagePayload?.linkToMessage) {\n    cardElements.push(\n      new TextBlock('Message Link', {\n        size: 'Medium',\n        weight: 'Bolder',\n        spacing: 'Medium',\n      }),\n      new ActionSet(\n        new OpenUrlAction(messagePayload.linkToMessage, {\n          title: 'Go to message',\n        })\n      )\n    );\n  }\n\n  return new AdaptiveCard(...cardElements);\n}\n"})})]}),"\n",(0,s.jsx)(n.h2,{id:"handle-opening-adaptive-card-dialog",children:"Handle opening adaptive card dialog"}),"\n",(0,s.jsx)(i.A,{language:"typescript",children:(0,s.jsxs)(n.p,{children:["Handle opening adaptive card dialog when the ",(0,s.jsx)(n.code,{children:"fetchConversationMembers"})," command is invoked."]})}),"\n",(0,s.jsx)(i.A,{language:"typescript",children:(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { cardAttachment } from '@microsoft/teams.api';\nimport { App } from '@microsoft/teams.apps';\n// ...\n\napp.on('message.ext.open', async ({ activity, api }) => {\n  const conversationId = activity.conversation.id;\n  const members = await api.conversations.members(conversationId).get();\n  const card = createConversationMembersCard(members);\n\n  return {\n    task: {\n      type: 'continue',\n      value: {\n        title: 'Conversation members',\n        height: 'small',\n        width: 'small',\n        card: cardAttachment('adaptive', card),\n      },\n    },\n  };\n});\n"})})}),"\n",(0,s.jsx)(n.h3,{id:"create-conversation-members-card",children:"Create conversation members card"}),"\n",(0,s.jsxs)(i.A,{language:"typescript",children:[(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"createConversationMembersCard()"})," function"]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { Account } from '@microsoft/teams.api';\nimport { AdaptiveCard, TextBlock } from '@microsoft/teams.cards';\n// ...\n\nexport function createConversationMembersCard(members: Account[]) {\n  const membersList = members.map((member) => member.name).join(', ');\n\n  return new AdaptiveCard(\n    new TextBlock('Conversation members', {\n      size: 'Medium',\n      weight: 'Bolder',\n      color: 'Accent',\n      style: 'heading',\n    }),\n    new TextBlock(membersList, {\n      wrap: true,\n      spacing: 'Small',\n    })\n  );\n}\n"})})]}),"\n",(0,s.jsx)(n.h2,{id:"resources",children:"Resources"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/microsoftteams/platform/messaging-extensions/how-to/action-commands/define-action-command?tabs=Teams-toolkit%2Cdotnet",children:"Action commands"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/microsoftteams/platform/messaging-extensions/how-to/action-commands/respond-to-task-module-submit?tabs=dotnet%2Cdotnet-1#bot-response-with-adaptive-card",children:"Returning Adaptive Card Previews in Task Modules"})}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}}}]);
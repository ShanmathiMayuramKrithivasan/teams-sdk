"use strict";(self.webpackChunkteams_md=self.webpackChunkteams_md||[]).push([[9939],{26802:(e,t,i)=>{i.d(t,{A:()=>a});var n=i(22147),s=i(62540);function a({language:e,children:t}){return(0,n.zy)().pathname.includes(`/${e}/`)?(0,s.jsx)(s.Fragment,{children:t}):null}},43023:(e,t,i)=>{i.d(t,{R:()=>r,x:()=>c});var n=i(63696);const s={},a=n.createContext(s);function r(e){const t=n.useContext(a);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),n.createElement(a.Provider,{value:t},e.children)}},93975:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>p,frontMatter:()=>c,metadata:()=>n,toc:()=>d});const n=JSON.parse('{"id":"typescript/essentials/on-activity/index","title":"Listening to Activities","description":"\x3c!--","source":"@site/docs/main/typescript/essentials/on-activity/index.mdx","sourceDirName":"typescript/essentials/on-activity","slug":"/typescript/essentials/on-activity/","permalink":"/teams-sdk/typescript/essentials/on-activity/","draft":false,"unlisted":false,"editUrl":"https://github.com/microsoft/teams-sdk/tree/main/teams.md/docs/main/typescript/essentials/on-activity/index.mdx","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"summary":"Guide to handling Teams-specific activities like chat messages, card actions, and installs using the fluent router API.","title":"Listening to Activities"},"sidebar":"default","previous":{"title":"Listening to Events","permalink":"/teams-sdk/typescript/essentials/on-event"},"next":{"title":"Activity Type Reference","permalink":"/teams-sdk/typescript/essentials/on-activity/activity-ref"}}');var s=i(62540),a=i(43023),r=i(26802);const c={sidebar_position:1,summary:"Guide to handling Teams-specific activities like chat messages, card actions, and installs using the fluent router API.",title:"Listening to Activities"},o="Listening To Activities",l={},d=[{value:"Middleware pattern",id:"middleware-pattern",level:2},{value:"Activity Reference",id:"activity-reference",level:2}];function h(e){const t={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"listening-to-activities",children:"Listening To Activities"})}),"\n",(0,s.jsxs)(t.p,{children:["An ",(0,s.jsx)(t.strong,{children:"Activity"})," is the Teams\u2011specific payload that flows between the user and your bot.\nWhere ",(0,s.jsx)(t.em,{children:"events"})," describe high\u2011level happenings inside your app, ",(0,s.jsx)(t.em,{children:"activities"})," are the raw Teams messages such as chat text, card actions, installs, or invoke calls."]}),"\n",(0,s.jsx)(r.A,{language:"typescript",children:(0,s.jsxs)(t.p,{children:["The Teams SDK exposes a fluent router so you can subscribe to these activities with ",(0,s.jsx)(t.code,{children:"app.on('<route>', \u2026)"}),"."]})}),"\n",(0,s.jsx)(t.mermaid,{value:'flowchart LR\n    Teams["Teams"]:::less-interesting\n    Server["App Server"]:::interesting\n    ActivityRouter["Activity Router (app.on())"]:::interesting\n    Handlers["Your Activity Handlers"]:::interesting\n\n    Teams --\x3e |Events| Server\n    Server --\x3e |Activity Event| ActivityRouter\n    ActivityRouter --\x3e |handler invoked| Handlers\n\n    classDef interesting fill:#b1650f,stroke:#333,stroke-width:4px;\n    classDef less-interesting fill:#666,stroke:#333,stroke-width:4px;'}),"\n",(0,s.jsx)(t.p,{children:"Here is an example of a basic message handler:"}),"\n",(0,s.jsx)(r.A,{language:"typescript",children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-typescript",children:"app.on('message', async ({ activity, send }) => {\n  await send(`You said: ${activity.text}`);\n});\n"})})}),"\n",(0,s.jsxs)(r.A,{language:"typescript",children:[(0,s.jsxs)(t.p,{children:["In the above example, the ",(0,s.jsx)(t.code,{children:"activity"})," parameter is of type ",(0,s.jsx)(t.code,{children:"MessageActivity"}),", which has a ",(0,s.jsx)(t.code,{children:"text"})," property. You'll notice that the handler here does not return anything, but instead handles it by ",(0,s.jsx)(t.code,{children:"send"}),"ing a message back. For message activities, Teams does not expect your application to return anything (though it's usually a good idea to send some sort of friendly acknowledgment!)."]}),(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.a,{href:"./activity-ref",children:"Other activity types"})," have different properties and different required results. For a given handler, the SDK will automatically determine the type of ",(0,s.jsx)(t.code,{children:"activity"})," and also enforce the correct return type."]})]}),"\n",(0,s.jsx)(t.h2,{id:"middleware-pattern",children:"Middleware pattern"}),"\n",(0,s.jsx)(r.A,{language:"typescript",children:(0,s.jsxs)(t.p,{children:["The ",(0,s.jsx)(t.code,{children:"on"})," activity handlers follow a ",(0,s.jsx)(t.a,{href:"https://www.patterns.dev/vanilla/mediator-pattern/",children:"middleware"})," pattern similar to how ",(0,s.jsx)(t.code,{children:"express"})," middlewares work. This means that for each activity handler, a ",(0,s.jsx)(t.code,{children:"next"})," function is passed in which can be called to pass control to the next handler. This allows you to build a chain of handlers that can process the same activity in different ways."]})}),"\n",(0,s.jsxs)(r.A,{language:"typescript",children:[(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-typescript",children:"app.on('message', async ({ next }) => {\n  console.log('global logger');\n  next(); // pass control onward\n});\n"})}),(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-typescript",children:"app.on('message', async ({ activity, next }) => {\n  if (activity.text === '/help') {\n    await send('Here are all the ways I can help you...');\n    return;\n  }\n\n  // Conditionally pass control to the next handler\n  next();\n});\n"})}),(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-typescript",children:"app.on('message', async ({ activity }) => {\n  // Fallthrough to the final handler\n  await send(`Hello! you said ${activity.text}`);\n});\n"})})]}),"\n",(0,s.jsx)(t.admonition,{type:"info",children:(0,s.jsxs)(t.p,{children:["Just like other middlewares, if you stop the chain by not calling ",(0,s.jsx)(t.code,{children:"next()"}),", the activity will not be passed to the next handler. The order of registration for the handlers also matters as that determines how the handlers will be called."]})}),"\n",(0,s.jsxs)(r.A,{language:"typescript",children:[(0,s.jsx)(t.h2,{id:"activity-reference",children:"Activity Reference"}),(0,s.jsxs)(t.p,{children:["For a list of supported activities that your application can listen to, see the ",(0,s.jsx)(t.a,{href:"./activity-ref",children:"activity reference"}),"."]})]})]})}function p(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}}}]);
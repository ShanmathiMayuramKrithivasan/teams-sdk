"use strict";(self.webpackChunkteams_md=self.webpackChunkteams_md||[]).push([[7303],{26802:(e,t,n)=>{n.d(t,{A:()=>r});var s=n(22147),i=n(62540);function r({language:e,children:t}){return(0,s.zy)().pathname.includes(`/${e}/`)?(0,i.jsx)(i.Fragment,{children:t}):null}},43023:(e,t,n)=>{n.d(t,{R:()=>d,x:()=>a});var s=n(63696);const i={},r=s.createContext(i);function d(e){const t=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),s.createElement(r.Provider,{value:t},e.children)}},43757:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>c,default:()=>u,frontMatter:()=>a,metadata:()=>s,toc:()=>h});const s=JSON.parse('{"id":"csharp/in-depth-guides/tabs/functions/index","title":"Functions","description":"\x3c!--","source":"@site/docs/main/csharp/in-depth-guides/tabs/functions/index.mdx","sourceDirName":"csharp/in-depth-guides/tabs/functions","slug":"/csharp/in-depth-guides/tabs/functions/","permalink":"/teams-sdk/csharp/in-depth-guides/tabs/functions/","draft":false,"unlisted":false,"editUrl":"https://github.com/microsoft/teams-sdk/tree/main/teams.md/docs/main/csharp/in-depth-guides/tabs/functions/index.mdx","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5,"title":"Functions","summary":"Details on how to register REST endpoints that can be called from Tab apps.","languages":["typescript","csharp"]},"sidebar":"default","previous":{"title":"Tabs","permalink":"/teams-sdk/csharp/in-depth-guides/tabs/"},"next":{"title":"Feedback","permalink":"/teams-sdk/csharp/in-depth-guides/feedback"}}');var i=n(62540),r=n(43023),d=n(26802);const a={sidebar_position:5,title:"Functions",summary:"Details on how to register REST endpoints that can be called from Tab apps.",languages:["typescript","csharp"]},c="Functions",o={},h=[{value:"Function context",id:"function-context",level:2},{value:"Additional resources",id:"additional-resources",level:2}];function l(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"functions",children:"Functions"})}),"\n",(0,i.jsx)(d.A,{language:"csharp",children:(0,i.jsxs)(t.p,{children:["Agents may want to expose REST APIs that client applications can call. This SDK makes it easy to implement those APIs through the ",(0,i.jsx)(t.code,{children:"app.AddFunction()"})," method. The function takes a name and a callback that implements the function."]})}),"\n",(0,i.jsxs)(d.A,{language:"csharp",children:[(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-csharp",children:"app.AddFunction('do-something', (context) => {\n  // do something useful\n});\n"})}),(0,i.jsxs)(t.p,{children:["This registers a REST API hosted at ",(0,i.jsx)(t.code,{children:"http://localhost:{PORT}/api/functions/do-something"})," or ",(0,i.jsx)(t.code,{children:"https://{BOT_DOMAIN}/api/functions/do-something"})," that clients can POST to. When they do, this SDK validates that the caller provides a valid Microsoft Entra bearer token before invoking the registered callback. If the token is missing or invalid, the request is denied with a HTTP 401."]}),(0,i.jsxs)(t.p,{children:["The function can be typed to accept input arguments. The clients would include those in the POST request payload, and they are made available in the callback through the ",(0,i.jsx)(t.code,{children:"Data"})," context argument."]}),(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-csharp",children:'public class ProcessMessageData\n{\n    [JsonPropertyName("message")]\n    public required string Message { get; set; }\n}\n\n// ...\n\napp.AddFunction<ProcessMessageData> ("process-message", (context) => {\n    context.Log.Debug($"process-message with: {context.Data.Message}");\n});\n\n'})})]}),"\n",(0,i.jsx)(d.A,{language:"csharp",children:(0,i.jsx)(t.admonition,{type:"warning",children:(0,i.jsx)(t.p,{children:"This SDK does not validate that the function arguments are of the expected types or otherwise trustworthy. You must take care to validate the input arguments before using them."})})}),"\n",(0,i.jsxs)(d.A,{language:"csharp",children:[(0,i.jsx)(t.p,{children:"If desired, the function can return data to the caller."}),(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-csharp",children:"app.AddFunction('get-random-number', () => {\n    return 4; // chosen by fair dice roll;\n              // guaranteed to be random\n});\n"})})]}),"\n",(0,i.jsx)(t.h2,{id:"function-context",children:"Function context"}),"\n",(0,i.jsx)(d.A,{language:"csharp",children:(0,i.jsx)(t.p,{children:"The function callback receives a context object with a number of useful values. Some originate within the agent itself, while others are furnished by the caller via the HTTP Request."})}),"\n",(0,i.jsx)(d.A,{language:"csharp",children:(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Property"}),(0,i.jsx)(t.th,{children:"Source"}),(0,i.jsx)(t.th,{children:"Description"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"Api"})}),(0,i.jsx)(t.td,{children:"Agent"}),(0,i.jsx)(t.td,{children:"The API client."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"AppId"})}),(0,i.jsx)(t.td,{children:"Agent"}),(0,i.jsx)(t.td,{children:"Unique identifier assigned to the app after deployment, ensuring correct app instance recognition across hosts."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"AppSessionId"})}),(0,i.jsx)(t.td,{children:"Caller"}),(0,i.jsx)(t.td,{children:"Unique ID for the calling app's session, used to correlate telemetry data."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"AuthToken"})}),(0,i.jsx)(t.td,{children:"Caller"}),(0,i.jsx)(t.td,{children:"The validated MSAL Entra token."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"ChannelId"})}),(0,i.jsx)(t.td,{children:"Caller"}),(0,i.jsx)(t.td,{children:"Microsoft Teams ID for the channel associated with the content."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"ChatId"})}),(0,i.jsx)(t.td,{children:"Caller"}),(0,i.jsx)(t.td,{children:"Microsoft Teams ID for the chat associated with the content."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"Data"})}),(0,i.jsx)(t.td,{children:"Caller"}),(0,i.jsx)(t.td,{children:"The function payload."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"Log"})}),(0,i.jsx)(t.td,{children:"Agent"}),(0,i.jsx)(t.td,{children:"The app logger instance."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"MeetingId"})}),(0,i.jsx)(t.td,{children:"Caller"}),(0,i.jsx)(t.td,{children:"Meeting ID used by tab when running in meeting context."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"MessageId"})}),(0,i.jsx)(t.td,{children:"Caller"}),(0,i.jsx)(t.td,{children:"ID of the parent message from which the task module was launched (only available in bot card-launched modules)."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"PageId"})}),(0,i.jsx)(t.td,{children:"Caller"}),(0,i.jsx)(t.td,{children:"Developer-defined unique ID for the page this content points to."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"Send"})}),(0,i.jsx)(t.td,{children:"Agent"}),(0,i.jsx)(t.td,{children:"Sends an activity to the current conversation."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"SubPageId"})}),(0,i.jsx)(t.td,{children:"Caller"}),(0,i.jsx)(t.td,{children:"Developer-defined unique ID for the sub-page this content points to. Used to restore specific state within a page."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"TeamId"})}),(0,i.jsx)(t.td,{children:"Caller"}),(0,i.jsx)(t.td,{children:"Microsoft Teams ID for the team associated with the content."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"TenantId"})}),(0,i.jsx)(t.td,{children:"Caller"}),(0,i.jsx)(t.td,{children:"Microsoft Entra tenant ID of the current user, extracted from the validated auth token."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"UserId"})}),(0,i.jsx)(t.td,{children:"Caller"}),(0,i.jsx)(t.td,{children:"Microsoft Entra object ID of the current user, extracted from the validated auth token."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"UserName"})}),(0,i.jsx)(t.td,{children:"Caller"}),(0,i.jsx)(t.td,{children:"Microsoft Entra name of the current user, extracted from the validated auth token."})]})]})]})}),"\n",(0,i.jsxs)(d.A,{language:"csharp",children:[(0,i.jsxs)(t.p,{children:["The ",(0,i.jsx)(t.code,{children:"AuthToken"})," is validated before the function callback is invoked, and the ",(0,i.jsx)(t.code,{children:"TenantId"}),", ",(0,i.jsx)(t.code,{children:"UserId"}),", and ",(0,i.jsx)(t.code,{children:"UserName"})," values are extracted from the validated token. In the typical case, the remaining caller-supplied values would reflect what the Teams Tab app retrieves from the teams-js ",(0,i.jsx)(t.code,{children:"getContext()"})," API, but the agent does not validate these."]}),(0,i.jsx)(t.admonition,{type:"warning",children:(0,i.jsx)(t.p,{children:"Take care to validate the caller-supplied values before using them. Don't assume that the calling user actually has access to items indicated in the context."})})]}),"\n",(0,i.jsxs)(d.A,{language:"csharp",children:[(0,i.jsxs)(t.p,{children:["To simplify a common scenarios, the context provides a ",(0,i.jsx)(t.code,{children:"Send"})," method. This method sends an activity to the current conversation ID, determined from the context values provided by the client (chatId and channelId). If neither chatId or channelId is provided by the caller, the ID of the 1:1 conversation between the agent and the user is assumed."]}),(0,i.jsx)(t.admonition,{type:"warning",children:(0,i.jsxs)(t.p,{children:["The ",(0,i.jsx)(t.code,{children:"Send"})," method does not validate that the chat ID or conversation ID provided by the caller is valid or correct. You must take care to validate that the user and agent both have appropriate access to the conversation."]})})]}),"\n",(0,i.jsx)(t.h2,{id:"additional-resources",children:"Additional resources"}),"\n",(0,i.jsx)(d.A,{language:"csharp",children:(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["For details on how to Tab apps can call these functions, see the TypeScript ",(0,i.jsx)(t.a,{href:"../../../../typescript/in-depth-guides/tabs/functions/function-calling",children:"Executing Functions"})," in-depth guide."]}),"\n",(0,i.jsxs)(t.li,{children:["For more information about the teams-js getContext() API, see the ",(0,i.jsx)(t.a,{href:"https://learn.microsoft.com/en-us/microsoftteams/platform/tabs/how-to/using-teams-client-library",children:"Teams JavaScript client library"})," documentation."]}),"\n"]})})]})}function u(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}}}]);
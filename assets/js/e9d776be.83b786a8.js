"use strict";(self.webpackChunkteams_md=self.webpackChunkteams_md||[]).push([[5306],{26802:(e,s,n)=>{n.d(s,{A:()=>i});var t=n(22147),a=n(62540);function i({language:e,children:s}){return(0,t.zy)().pathname.includes(`/${e}/`)?(0,a.jsx)(a.Fragment,{children:s}):null}},33169:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/compose-area-1c7340e445681d29b0c675f72985a10e.png"},43023:(e,s,n)=>{n.d(s,{R:()=>r,x:()=>o});var t=n(63696);const a={},i=t.createContext(a);function r(e){const s=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),t.createElement(i.Provider,{value:s},e.children)}},51282:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>m,contentTitle:()=>c,default:()=>l,frontMatter:()=>o,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"typescript/in-depth-guides/message-extensions/search-commands","title":"Search Commands","description":"\x3c!--","source":"@site/docs/main/typescript/in-depth-guides/message-extensions/search-commands.mdx","sourceDirName":"typescript/in-depth-guides/message-extensions","slug":"/typescript/in-depth-guides/message-extensions/search-commands","permalink":"/teams-sdk/typescript/in-depth-guides/message-extensions/search-commands","draft":false,"unlisted":false,"editUrl":"https://github.com/microsoft/teams-sdk/tree/main/teams.md/docs/main/typescript/in-depth-guides/message-extensions/search-commands.mdx","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"sidebar_label":"Search Commands","title":"Search Commands","summary":"Create search commands that allow users to search external systems and insert results as cards in Teams messages."},"sidebar":"default","previous":{"title":"Action Commands","permalink":"/teams-sdk/typescript/in-depth-guides/message-extensions/action-commands"},"next":{"title":"Settings","permalink":"/teams-sdk/typescript/in-depth-guides/message-extensions/settings"}}');var a=n(62540),i=n(43023),r=n(26802);const o={sidebar_position:2,sidebar_label:"Search Commands",title:"Search Commands",summary:"Create search commands that allow users to search external systems and insert results as cards in Teams messages."},c="\ud83d\udd0d Search commands",m={},d=[{value:"Search command invocation locations",id:"search-command-invocation-locations",level:2},{value:"Compose Area and Box",id:"compose-area-and-box",level:3},{value:"Setting up your Teams app manifest",id:"setting-up-your-teams-app-manifest",level:2},{value:"Handle submission",id:"handle-submission",level:2},{value:"Resources",id:"resources",level:2}];function h(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s.header,{children:(0,a.jsx)(s.h1,{id:"-search-commands",children:"\ud83d\udd0d Search commands"})}),"\n",(0,a.jsx)(s.p,{children:"Message extension search commands allow users to search external systems and insert the results of that search into a message in the form of a card."}),"\n",(0,a.jsx)(s.h2,{id:"search-command-invocation-locations",children:"Search command invocation locations"}),"\n",(0,a.jsx)(s.p,{children:"There are two different areas search commands can be invoked from:"}),"\n",(0,a.jsxs)(s.ol,{children:["\n",(0,a.jsx)(s.li,{children:"Compose Area"}),"\n",(0,a.jsx)(s.li,{children:"Compose Box"}),"\n"]}),"\n",(0,a.jsx)(s.h3,{id:"compose-area-and-box",children:"Compose Area and Box"}),"\n",(0,a.jsx)(s.p,{children:(0,a.jsx)(s.img,{alt:"Screenshot of Teams with outlines around the &#39;Compose Box&#39; (for typing messages) and the &#39;Compose Area&#39; (the menu option next to the compose box that provides a search bar for actions and apps).",src:n(33169).A+"",width:"2762",height:"1464"})}),"\n",(0,a.jsx)(s.h2,{id:"setting-up-your-teams-app-manifest",children:"Setting up your Teams app manifest"}),"\n",(0,a.jsx)(s.p,{children:"To use search commands you have to define them in the Teams app manifest. Here is an example:"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-json",children:'"composeExtensions": [\n    {\n        "botId": "${{BOT_ID}}",\n        "commands": [\n            {\n                "id": "searchQuery",\n                "context": [\n                    "compose",\n                    "commandBox"\n                ],\n                "description": "Test command to run query",\n                "title": "Search query",\n                "type": "query",\n                "parameters": [\n                    {\n                        "name": "searchQuery",\n                        "title": "Search Query",\n                        "description": "Your search query",\n                        "inputType": "text"\n                    }\n                ]\n            }\n        ]\n    }\n]\n'})}),"\n",(0,a.jsxs)(s.p,{children:["Here we are defining the ",(0,a.jsx)(s.code,{children:"searchQuery"})," search (or query) command."]}),"\n",(0,a.jsx)(s.h2,{id:"handle-submission",children:"Handle submission"}),"\n",(0,a.jsxs)(s.p,{children:["Handle the search query submission when the ",(0,a.jsx)(s.code,{children:"searchQuery"})," search command is invoked."]}),"\n",(0,a.jsx)(r.A,{language:"typescript",children:(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-typescript",children:"import { cardAttachment } from '@microsoft/teams.api';\nimport { App } from '@microsoft/teams.apps';\n// ...\n\napp.on('message.ext.query', async ({ activity }) => {\n  const { commandId } = activity.value;\n  const searchQuery = activity.value.parameters![0].value;\n\n  if (commandId == 'searchQuery') {\n    const cards = await createDummyCards(searchQuery);\n    const attachments = cards.map(({ card, thumbnail }) => {\n      return {\n        ...cardAttachment('adaptive', card), // expanded card in the compose box...\n        preview: cardAttachment('thumbnail', thumbnail), // preview card in the compose box...\n      };\n    });\n\n    return {\n      composeExtension: {\n        type: 'result',\n        attachmentLayout: 'list',\n        attachments: attachments,\n      },\n    };\n  }\n\n  return { status: 400 };\n});\n"})})}),"\n",(0,a.jsxs)(r.A,{language:"typescript",children:[(0,a.jsxs)(s.p,{children:[(0,a.jsx)(s.code,{children:"createDummyCards()"})," function"]}),(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-typescript",children:"import { ThumbnailCard } from '@microsoft/teams.api';\nimport { AdaptiveCard, TextBlock } from '@microsoft/teams.cards';\n// ...\n\nexport async function createDummyCards(searchQuery: string) {\n  const dummyItems = [\n    {\n      title: 'Item 1',\n      description: `This is the first item and this is your search query: ${searchQuery}`,\n    },\n    { title: 'Item 2', description: 'This is the second item' },\n    { title: 'Item 3', description: 'This is the third item' },\n    { title: 'Item 4', description: 'This is the fourth item' },\n    { title: 'Item 5', description: 'This is the fifth item' },\n  ];\n\n  const cards = dummyItems.map((item) => {\n    return {\n      card: new AdaptiveCard(\n        new TextBlock(item.title, {\n          size: 'Large',\n          weight: 'Bolder',\n          color: 'Accent',\n          style: 'heading',\n        }),\n        new TextBlock(item.description, {\n          wrap: true,\n          spacing: 'Medium',\n        })\n      ),\n      thumbnail: {\n        title: item.title,\n        text: item.description,\n        // When a user clicks on a list item in Teams:\n        // - If the thumbnail has a `tap` property: Teams will trigger the `message.ext.select-item` activity\n        // - If no `tap` property: Teams will insert the full adaptive card into the compose box\n        // tap: {\n        //   type: \"invoke\",\n        //   title: item.title,\n        //   value: {\n        //     \"option\": index,\n        //   },\n        // },\n      } satisfies ThumbnailCard,\n    };\n  });\n\n  return cards;\n}\n"})})]}),"\n",(0,a.jsx)(s.p,{children:"The search results include both a full adaptive card and a preview card. The preview card appears as a list item in the search command area:"}),"\n",(0,a.jsx)(s.p,{children:(0,a.jsx)(s.img,{alt:"Screenshot of Teams showing a message extensions search menu open with list of search results displayed as preview cards.",src:n(52916).A+"",width:"2155",height:"1468"})}),"\n",(0,a.jsx)(s.p,{children:"When a user clicks on a list item the dummy adaptive card is added to the compose box:"}),"\n",(0,a.jsx)(s.p,{children:(0,a.jsx)(s.img,{alt:"Screenshot of Teams showing the selected adaptive card added to the compose box.",src:n(92458).A+"",width:"2168",height:"1458"})}),"\n",(0,a.jsxs)(s.p,{children:["To implement custom actions when a user clicks on a search result item, you can add the ",(0,a.jsx)(s.code,{children:"tap"})," property to the preview card. This allows you to handle the click event with custom logic:"]}),"\n",(0,a.jsx)(r.A,{language:"typescript",children:(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-typescript",children:"import { App } from '@microsoft/teams.apps';\n// ...\n\napp.on('message.ext.select-item', async ({ activity, send }) => {\n  const { option } = activity.value;\n\n  await send(`Selected item: ${option}`);\n\n  return {\n    status: 200,\n  };\n});\n"})})}),"\n",(0,a.jsx)(s.h2,{id:"resources",children:"Resources"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsx)(s.li,{children:(0,a.jsx)(s.a,{href:"https://learn.microsoft.com/en-us/microsoftteams/platform/messaging-extensions/how-to/search-commands/define-search-command?tabs=Teams-toolkit%2Cdotnet",children:"Search command"})}),"\n",(0,a.jsx)(s.li,{children:(0,a.jsx)(s.a,{href:"https://learn.microsoft.com/en-us/microsoftteams/platform/messaging-extensions/how-to/search-commands/universal-actions-for-search-based-message-extensions#just-in-time-install",children:"Just-In-Time Install"})}),"\n"]})]})}function l(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,a.jsx)(s,{...e,children:(0,a.jsx)(h,{...e})}):h(e)}},52916:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/preview-card-f633e7427322d135be3416de38d018d0.png"},92458:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/card-in-compose-2317acd98e4b7dea25e1334274f1f3cc.png"}}]);
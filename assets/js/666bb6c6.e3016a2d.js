"use strict";(self.webpackChunkteams_md=self.webpackChunkteams_md||[]).push([[5492],{20500:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/abs-oauth-connection-b1dba56e9bcec1600be86ac60bb4bd53.png"},43023:(e,t,n)=>{n.d(t,{R:()=>r,x:()=>o});var i=n(63696);const s={},a=i.createContext(s);function r(e){const t=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),i.createElement(a.Provider,{value:t},e.children)}},62827:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/entra-oauth-scopes-b14be67c6d055173c17eb8d10992a196.png"},75028:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>l,frontMatter:()=>r,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"teams/user-authentication/sso-setup","title":"SSO Setup","description":"This section describes how to configure the Azure Bot Service (ABS), the Entra App Registration and the Teams manifest to enable Single-Sign-On (SSO) for your Teams app.","source":"@site/docs/main/teams/user-authentication/sso-setup.md","sourceDirName":"teams/user-authentication","slug":"/teams/user-authentication/sso-setup","permalink":"/teams-sdk/teams/user-authentication/sso-setup","draft":false,"unlisted":false,"editUrl":"https://github.com/microsoft/teams-sdk/tree/main/teams.md/docs/main/teams/user-authentication/sso-setup.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"summary":"Describes how to configure SSO in Teams"},"sidebar":"default","previous":{"title":"User Authentication","permalink":"/teams-sdk/teams/user-authentication/"},"next":{"title":"Teams Manifest","permalink":"/teams-sdk/teams/manifest"}}');var s=n(62540),a=n(43023);const r={sidebar_position:1,summary:"Describes how to configure SSO in Teams"},o="SSO Setup",c={},d=[{value:"Create the Entra App Registration",id:"create-the-entra-app-registration",level:2},{value:"Configure the Entra App Registration with the CLI",id:"configure-the-entra-app-registration-with-the-cli",level:3},{value:"Create the OAuth connection in Azure Bot Service",id:"create-the-oauth-connection-in-azure-bot-service",level:2},{value:"Create the OAuth connection using the Azure CLI",id:"create-the-oauth-connection-using-the-azure-cli",level:3},{value:"Configure the App Manifest",id:"configure-the-app-manifest",level:2}];function h(e){const t={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"sso-setup",children:"SSO Setup"})}),"\n",(0,s.jsx)(t.p,{children:"This section describes how to configure the Azure Bot Service (ABS), the Entra App Registration and the Teams manifest to enable Single-Sign-On (SSO) for your Teams app."}),"\n",(0,s.jsx)(t.h2,{id:"create-the-entra-app-registration",children:"Create the Entra App Registration"}),"\n",(0,s.jsx)(t.p,{children:"You need an Entra ID App Registration to configure the OAuth Connection in Azure Bot Service. This can be the same EntraId app registration you used to configure your ABS resource or a new App created just for this purpose. You can create the App Registration from the Azure portal, or the CLI, the next list summarizes the creation steps from the portal."}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["Use the existing App registration, or Create a new App registration from the ",(0,s.jsx)(t.a,{href:"https://portal.azure.com/#view/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/~/RegisteredApps",children:"Entra Id"})," section in the Azure portal. Now you have an Application Id (also known as Client ID) and a Tenant Id."]}),"\n",(0,s.jsxs)(t.li,{children:["Provide a name for the app registration, select SingleTenant, and for the Redirect URI select the platform Web and add the value ",(0,s.jsx)(t.code,{children:"https://token.botframework.com/.auth/web/redirect"})]}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"Entra new app",src:n(81592).A+"",width:"1016",height:"719"})}),"\n",(0,s.jsxs)(t.ol,{start:"3",children:["\n",(0,s.jsxs)(t.li,{children:["Add a new client secret. From ",(0,s.jsx)(t.code,{children:"Certificates & secrets"}),", select ",(0,s.jsx)(t.code,{children:"Client secrets"})," and add ",(0,s.jsx)(t.code,{children:"New client secret"}),". Take note of the secret as you will need the value later on this guide."]}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"Entra client secret",src:n(95490).A+"",width:"1003",height:"618"})}),"\n",(0,s.jsxs)(t.ol,{start:"4",children:["\n",(0,s.jsxs)(t.li,{children:["Configure the API. From ",(0,s.jsx)(t.code,{children:"Expose an API"}),",  Click ",(0,s.jsx)(t.code,{children:"Add"})," to Application ID URI and accept the default value that will look like ",(0,s.jsx)(t.code,{children:"api://<Your-Application-Id>"}),". Add the scope ",(0,s.jsx)(t.code,{children:"access_as_user"})," and select who can ",(0,s.jsx)(t.em,{children:"consent"}),"."]}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"Entra oauth scopes",src:n(62827).A+"",width:"1434",height:"757"})}),"\n",(0,s.jsxs)(t.ol,{start:"5",children:["\n",(0,s.jsxs)(t.li,{children:["Authorize the client applications for SSO. To enable the Teams clients, desktop and web, to perform the SSO flow you must add the next client applications to the scope defined before: Teams Desktop ",(0,s.jsx)(t.code,{children:"1fec8e78-bce4-4aaf-ab1b-5451cc387264"})," and Teams Web ",(0,s.jsx)(t.code,{children:"5e3ce6c0-2b1f-4285-8d4b-75ee78787346"})]}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"Entra oauth authorize client app",src:n(76392).A+"",width:"1450",height:"750"})}),"\n",(0,s.jsx)(t.h3,{id:"configure-the-entra-app-registration-with-the-cli",children:"Configure the Entra App Registration with the CLI"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:'#!/bin/bash\n\naz ad app update --id $appId --web-redirect-uris "https://token.botframework.com/.auth/web/redirect"\naz ad app update --id $appId --identifier-uris "api://$appId"\n# TODO: add oauthpermission settings and client applications.\n'})}),"\n",(0,s.jsx)(t.h2,{id:"create-the-oauth-connection-in-azure-bot-service",children:"Create the OAuth connection in Azure Bot Service"}),"\n",(0,s.jsx)(t.p,{children:"You need to add a new OAuth connection to your Azure Bot Service resource."}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["From the Bot service resource in the Azure Portal, navigate to ",(0,s.jsx)(t.code,{children:"Settings/Configuration"})," and ",(0,s.jsx)(t.code,{children:"Add OAuth Connection settings"}),"."]}),"\n",(0,s.jsxs)(t.li,{children:["Provide a name for your connection e.g. ",(0,s.jsx)(t.code,{children:"graph"}),", and select the ",(0,s.jsx)(t.em,{children:"Service Provider"})," ",(0,s.jsx)(t.code,{children:"Azure Active Directory v2"})]}),"\n",(0,s.jsxs)(t.li,{children:["Populate the ",(0,s.jsx)(t.code,{children:"TenantId"}),"/",(0,s.jsx)(t.code,{children:"ClientId"}),"/",(0,s.jsx)(t.code,{children:"ClientSecret"})," from the values obtained in the previous section steps 2 and 3. Configure the Token Exchange URL with the Application ID URI configured in step 4, and add the Scopes you need e.g. ",(0,s.jsx)(t.code,{children:"User.Read"})]}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"ABS OAuth connection",src:n(20500).A+"",width:"271",height:"536"})}),"\n",(0,s.jsx)(t.h3,{id:"create-the-oauth-connection-using-the-azure-cli",children:"Create the OAuth connection using the Azure CLI"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:'#!/bin/bash\n\naz bot authsetting create \\\n  --resource-group $resourceGroup \\\n  --name $botName \\\n  -c "graph" \\\n  --client-id $appId \\\n  --client-secret $clientSecret \\\n  --provider-scope-string "User.Read" \\\n  --service "Aadv2" \\\n  --parameters "clientId=$appId" "clientSecret=$clientSecret" "tenantId=$tenantId" "tokenExchangeUrl=api://$appId"\n'})}),"\n",(0,s.jsx)(t.h2,{id:"configure-the-app-manifest",children:"Configure the App Manifest"}),"\n",(0,s.jsxs)(t.p,{children:["The Teams application manifest needs to be updated to reflect the settings configure above, with the ",(0,s.jsx)(t.code,{children:"Application Id"})," and ",(0,s.jsx)(t.code,{children:"Application ID URI"}),", if not using ",(0,s.jsx)(t.code,{children:"devtunnels"}),", replace the valid domain with the domain hosting your application."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-json",children:'"validDomains": [\n    "*.devtunnels.ms",\n    "*.botframework.com",\n ],\n "webApplicationInfo": {\n    "id": "<Your-Application-Id>",\n    "resource": "api://<Your-Application-Id>"\n  }\n'})})]})}function l(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},76392:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/entra-authorize-clientapp-ed57b1287e2305feaa579f781412f398.png"},81592:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/entra-new-app-d7e71e1678147506d175f4afddde836c.png"},95490:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/entra-client-secret-34c400d00b76fc48823e2286eb6ed56c.png"}}]);
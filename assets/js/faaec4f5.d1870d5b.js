"use strict";(self.webpackChunkteams_md=self.webpackChunkteams_md||[]).push([[4148],{26802:(e,n,s)=>{s.d(n,{A:()=>o});var t=s(22147),r=s(62540);function o({language:e,children:n}){return(0,t.zy)().pathname.includes(`/${e}/`)?(0,r.jsx)(r.Fragment,{children:n}):null}},43023:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>a});var t=s(63696);const r={},o=t.createContext(r);function i(e){const n=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),t.createElement(o.Provider,{value:n},e.children)}},57953:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>m,frontMatter:()=>a,metadata:()=>t,toc:()=>p});const t=JSON.parse('{"id":"python/in-depth-guides/ai/mcp/mcp-server","title":"MCP Server","description":"\x3c!--","source":"@site/docs/main/python/in-depth-guides/ai/mcp/mcp-server.mdx","sourceDirName":"python/in-depth-guides/ai/mcp","slug":"/python/in-depth-guides/ai/mcp/mcp-server","permalink":"/teams-sdk/python/in-depth-guides/ai/mcp/mcp-server","draft":false,"unlisted":false,"editUrl":"https://github.com/microsoft/teams-sdk/tree/main/teams.md/docs/main/python/in-depth-guides/ai/mcp/mcp-server.mdx","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"sidebar_label":"MCP Server","title":"MCP Server","summary":"How to convert your Teams app into an MCP server using the McpPlugin to expose tools, resources, and prompts to other MCP applications."},"sidebar":"default","previous":{"title":"MCP","permalink":"/teams-sdk/python/in-depth-guides/ai/mcp/"},"next":{"title":"MCP Client","permalink":"/teams-sdk/python/in-depth-guides/ai/mcp/mcp-client"}}');var r=s(62540),o=s(43023),i=s(26802);const a={sidebar_position:1,sidebar_label:"MCP Server",title:"MCP Server",summary:"How to convert your Teams app into an MCP server using the McpPlugin to expose tools, resources, and prompts to other MCP applications."},c="MCP Server",l={},p=[{value:"Piping messages to the user",id:"piping-messages-to-the-user",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"mcp-server",children:"MCP Server"})}),"\n",(0,r.jsx)(i.A,{language:"python",children:(0,r.jsxs)(n.p,{children:["You are able to convert any ",(0,r.jsx)(n.code,{children:"App"})," into an MCP server by using the ",(0,r.jsx)(n.code,{children:"McpPlugin"})," from the ",(0,r.jsx)(n.code,{children:"microsoft-teams-mcp"})," package. This plugin adds the necessary endpoints to your application to serve as an MCP server. The plugin allows you to define tools, resources, and prompts that can be exposed to other MCP applications."]})}),"\n",(0,r.jsx)(i.A,{language:"python",children:(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:'[Dev] Section "install" not found in Python documentation.'})," Either mark the section explicitly as N/A for intentionally ignored, or fill in documentation."]})}),"\n",(0,r.jsxs)(i.A,{language:"python",children:[(0,r.jsx)(n.p,{children:"Your plugin can be configured as follows:"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'from microsoft_teams.ai import Function\nfrom microsoft_teams.mcpplugin import McpServerPlugin\nfrom pydantic import BaseModel\n# ...\n\n# Configure MCP server with custom name\nmcp_server_plugin = McpServerPlugin(\n    name="test-mcp",\n)\n\nclass EchoParams(BaseModel):\n    input: str\n\nasync def echo_handler(params: EchoParams) -> str:\n    return f"You said {params.input}"\n\n# Register the echo tool\nmcp_server_plugin.use_tool(\n    Function(\n        name="echo",\n        description="echo back whatever you said",\n        parameter_schema=EchoParams,\n        handler=echo_handler,\n    )\n)\n'})})]}),"\n",(0,r.jsx)(i.A,{language:"python",children:(0,r.jsx)(n.admonition,{type:"note",children:(0,r.jsxs)(n.p,{children:["By default, the MCP server will be available at ",(0,r.jsx)(n.code,{children:"/mcp"})," on your application. You can change this by setting the ",(0,r.jsx)(n.code,{children:"path"})," property in the plugin configuration."]})})}),"\n",(0,r.jsxs)(i.A,{language:"python",children:[(0,r.jsx)(n.p,{children:"And included in the app like any other plugin:"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"from microsoft_teams.apps import App\nfrom microsoft_teams.devtools import DevToolsPlugin\n# ...\n\napp = App(plugins=[mcp_server_plugin, DevToolsPlugin()])\n"})})]}),"\n",(0,r.jsx)(i.A,{language:"python",children:(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsxs)(n.p,{children:["You may use the ",(0,r.jsx)(n.a,{href:"https://modelcontextprotocol.io/legacy/tools/inspector",children:"MCP-Inspector"})," to test functionality with your server."]})})}),"\n",(0,r.jsx)(i.A,{language:"python",children:(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"MCP Server in Devtools",src:s(93636).A+"",width:"1304",height:"922"})})}),"\n",(0,r.jsx)(n.h2,{id:"piping-messages-to-the-user",children:"Piping messages to the user"}),"\n",(0,r.jsx)(n.p,{children:"Since your agent is provisioned to work on Teams, one very helpful feature is to use this server as a way to send messages to the user. This can be helpful in various scenarios:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Human in the loop - if the server or an MCP client needs to confirm something with the user, it is able to do so."}),"\n",(0,r.jsx)(n.li,{children:"Notifications - the server can be used as a way to send notifications to the user."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Here is an example of how to do this. Configure your plugin so that:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"It can validate if the incoming request is allowed to send messages to the user"}),"\n",(0,r.jsx)(n.li,{children:"It fetches the correct conversation ID for the given user."}),"\n",(0,r.jsxs)(n.li,{children:["It sends a proactive message to the user. See ",(0,r.jsx)(n.a,{href:"../../../essentials/sending-messages/proactive-messaging",children:"Proactive Messaging"})," for more details."]}),"\n"]}),"\n",(0,r.jsxs)(i.A,{language:"python",children:[(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Alert Tool for Proactive Messaging:"})}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'from typing import Dict\nfrom microsoft_teams.ai import Function\nfrom microsoft_teams.mcpplugin import McpServerPlugin\nfrom pydantic import BaseModel\n# ...\n\n# Storage for conversation IDs (for proactive messaging)\nconversation_storage: Dict[str, str] = {}\n\nclass AlertParams(BaseModel):\n    user_id: str\n    message: str\n\nasync def alert_handler(params: AlertParams) -> str:\n    """\n    Send proactive message to user via Teams.\n    This demonstrates the "piping messages to user" feature.\n    """\n    # 1. Validate if the incoming request is allowed to send messages\n    if not params.user_id or not params.message:\n        return "Invalid parameters: user_id and message are required"\n\n    # 2. Fetch the correct conversation ID for the given user\n    conversation_id = conversation_storage.get(params.user_id)\n    if not conversation_id:\n        return f"No conversation found for user {params.user_id}. User needs to message the bot first."\n\n    # 3. Send proactive message to the user\n    await app.send(conversation_id=conversation_id, activity=params.message)\n    return f"Alert sent to user {params.user_id}: {params.message}"\n\n# Register the alert tool\nmcp_server_plugin.use_tool(\n    Function(\n        name="alert",\n        description="Send proactive message to a Teams user",\n        parameter_schema=AlertParams,\n        handler=alert_handler,\n    )\n)\n'})})]}),"\n",(0,r.jsxs)(i.A,{language:"python",children:[(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Store Conversation IDs in Message Handler:"})}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'from microsoft_teams.api import MessageActivity\nfrom microsoft_teams.apps import ActivityContext\n# ...\n\n@app.on_message\nasync def handle_message(ctx: ActivityContext[MessageActivity]):\n    """\n    Handle incoming messages and store conversation IDs for proactive messaging.\n    """\n    # Store conversation ID for this user (for proactive messaging)\n    user_id = ctx.activity.from_.id\n    conversation_id = ctx.activity.conversation.id\n    conversation_storage[user_id] = conversation_id\n\n    # Echo back the message with info about stored conversation\n    await ctx.reply(\n        f"You said: {ctx.activity.text}\\n\\n"\n        f"\ud83d\udcdd Stored conversation ID `{conversation_id}` for user `{user_id}` "\n        f"(for proactive messaging via MCP alert tool)"\n    )\n'})})]})]})}function m(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},93636:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/mcp-inspector-3ce940740dea32792ffe5b6aa75757c6.gif"}}]);
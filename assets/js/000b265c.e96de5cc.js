"use strict";(self.webpackChunkteams_md=self.webpackChunkteams_md||[]).push([[3577],{26802:(e,t,n)=>{n.d(t,{A:()=>o});var s=n(22147),i=n(62540);function o({language:e,children:t}){return(0,s.zy)().pathname.includes(`/${e}/`)?(0,i.jsx)(i.Fragment,{children:t}):null}},37234:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/settings-page-8a9bf62a6e0fe14a0331b1f199ba47b4.png"},43023:(e,t,n)=>{n.d(t,{R:()=>a,x:()=>l});var s=n(63696);const i={},o=s.createContext(i);function a(e){const t=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(o.Provider,{value:t},e.children)}},74567:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>p});const s=JSON.parse('{"id":"python/in-depth-guides/message-extensions/settings","title":"Settings","description":"\x3c!--","source":"@site/docs/main/python/in-depth-guides/message-extensions/settings.mdx","sourceDirName":"python/in-depth-guides/message-extensions","slug":"/python/in-depth-guides/message-extensions/settings","permalink":"/teams-sdk/python/in-depth-guides/message-extensions/settings","draft":false,"unlisted":false,"editUrl":"https://github.com/microsoft/teams-sdk/tree/main/teams.md/docs/main/python/in-depth-guides/message-extensions/settings.mdx","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"sidebar_label":"Settings","title":"Settings","summary":"Add configurable settings pages to your message extensions to allow users to customize app behavior.","ignore":true},"sidebar":"default","previous":{"title":"Search Commands","permalink":"/teams-sdk/python/in-depth-guides/message-extensions/search-commands"},"next":{"title":"Link Unfurling","permalink":"/teams-sdk/python/in-depth-guides/message-extensions/link-unfurling"}}');var i=n(62540),o=n(43023),a=n(26802),l=n(84913);const r={sidebar_position:3,sidebar_label:"Settings",title:"Settings",summary:"Add configurable settings pages to your message extensions to allow users to customize app behavior.",ignore:!0},c="\u2699\ufe0f Settings",d={},p=[{value:"1. Update the Teams Manifest",id:"1-update-the-teams-manifest",level:2},{value:"2. Serve the settings <code>html</code> page",id:"2-serve-the-settings-html-page",level:2},{value:"3. Specify the URL to the settings page",id:"3-specify-the-url-to-the-settings-page",level:2},{value:"4. Handle Form Submission",id:"4-handle-form-submission",level:2}];function g(e){const t={admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",img:"img",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"\ufe0f-settings",children:"\u2699\ufe0f Settings"})}),"\n",(0,i.jsx)(t.p,{children:"You can add a settings page that allows users to configure settings for your app."}),"\n",(0,i.jsx)(t.p,{children:"The user can access the settings by right-clicking the app item in the compose box."}),"\n",(0,i.jsx)("br",{}),"\n",(0,i.jsx)("img",{src:l.A,height:"300px",alt:"Settings"}),"\n",(0,i.jsx)(t.p,{children:"This guide will show how to enable user access to settings, as well as setting up a page that looks like this:"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Settings Page",src:n(37234).A+"",width:"3022",height:"908"})}),"\n",(0,i.jsx)(t.h2,{id:"1-update-the-teams-manifest",children:"1. Update the Teams Manifest"}),"\n",(0,i.jsxs)(t.p,{children:["Set the ",(0,i.jsx)(t.code,{children:"canUpdateConfiguration"})," field to ",(0,i.jsx)(t.code,{children:"true"})," in the desired message extension under ",(0,i.jsx)(t.code,{children:"composeExtensions"}),"."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-json",children:'"composeExtensions": [\n    {\n        "botId": "${{BOT_ID}}",\n        "canUpdateConfiguration": true,\n        ...\n    }\n]\n'})}),"\n",(0,i.jsxs)(t.h2,{id:"2-serve-the-settings-html-page",children:["2. Serve the settings ",(0,i.jsx)(t.code,{children:"html"})," page"]}),"\n",(0,i.jsxs)(t.p,{children:["This is the code snippet for the settings ",(0,i.jsx)(t.code,{children:"html"})," page:"]}),"\n",(0,i.jsx)(a.A,{language:"python",children:(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-html",children:'<!DOCTYPE html>\n<html>\n  <head>\n    <title>Message Extension Settings</title>\n    <link\n      rel="stylesheet"\n      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"\n    />\n    <script src="https://statics.teams.cdn.office.net/sdk/v1.11.0/js/MicrosoftTeams.min.js"><\/script>\n    <style>\n      body {\n        margin: 0;\n        padding: 10px;\n      }\n      .form-group {\n        margin-bottom: 10px;\n      }\n    </style>\n  </head>\n  <body>\n    <div class="container">\n      <h3>Message Extension Settings</h3>\n      <form id="settingsForm">\n        <div class="form-group">\n          <label>Selected Option:</label>\n          <select class="form-control" id="selectedOption" name="selectedOption">\n            <option value="">Please select an option</option>\n            <option value="option1">Option 1</option>\n            <option value="option2">Option 2</option>\n            <option value="option3">Option 3</option>\n          </select>\n        </div>\n        <button type="submit" class="btn btn-primary">Save Settings</button>\n      </form>\n    </div>\n\n    <script>\n      microsoftTeams.initialize();\n\n      // Get the selectedOption from URL parameters\n      const urlParams = new URLSearchParams(window.location.search);\n      const selectedOption = urlParams.get(\'selectedOption\');\n      if (selectedOption) {\n        document.getElementById(\'selectedOption\').value = selectedOption;\n      }\n\n      document.getElementById(\'settingsForm\').addEventListener(\'submit\', function (event) {\n        event.preventDefault();\n        let selectedValue = document.getElementById(\'selectedOption\').value;\n        microsoftTeams.tasks.submitTask(selectedValue);\n      });\n    <\/script>\n  </body>\n</html>\n'})})}),"\n",(0,i.jsxs)(t.p,{children:["Save it in the ",(0,i.jsx)(t.code,{children:"index.html"})," file in the same folder as where your app is initialized."]}),"\n",(0,i.jsx)(t.p,{children:"You can serve it by adding the following code to your app:"}),"\n",(0,i.jsx)(a.A,{language:"python",children:(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-python",children:'app.page("settings", str(Path(__file__).parent), "/tabs/settings")\n'})})}),"\n",(0,i.jsx)(a.A,{language:"python",children:(0,i.jsx)(t.admonition,{type:"note",children:(0,i.jsxs)(t.p,{children:["This will serve the HTML page to the ",(0,i.jsx)(t.code,{children:"${BOT_ENDPOINT}/tabs/settings"})," endpoint as a tab."]})})}),"\n",(0,i.jsx)(t.h2,{id:"3-specify-the-url-to-the-settings-page",children:"3. Specify the URL to the settings page"}),"\n",(0,i.jsxs)(t.p,{children:["To enable the settings page, your app needs to handle the ",(0,i.jsx)(t.code,{children:"message.ext.query-settings-url"})," activity that Teams sends when a user right-clicks the app in the compose box. Your app must respond with the URL to your settings page. Here's how to implement this:"]}),"\n",(0,i.jsx)(a.A,{language:"python",children:(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-python",children:'@app.on_message_ext_query_settings_url\nasync def handle_message_ext_query_settings_url(ctx: ActivityContext[MessageExtensionQuerySettingUrlInvokeActivity]):\n    user_settings = {"selectedOption": ""}\n    escaped_selected_option = user_settings["selectedOption"]\n\n    bot_endpoint = os.environ.get("BOT_ENDPOINT", "")\n\n    settings_action = CardAction(\n        type=CardActionType.OPEN_URL,\n        title="Settings",\n        value=f"{bot_endpoint}/tabs/settings?selectedOption={escaped_selected_option}",\n    )\n\n    suggested_actions = MessagingExtensionSuggestedAction(actions=[settings_action])\n\n    result = MessagingExtensionResult(type=MessagingExtensionResultType.CONFIG, suggested_actions=suggested_actions)\n\n    return MessagingExtensionInvokeResponse(compose_extension=result)\n'})})}),"\n",(0,i.jsx)(t.h2,{id:"4-handle-form-submission",children:"4. Handle Form Submission"}),"\n",(0,i.jsxs)(t.p,{children:["When a user submits the settings form, Teams sends a ",(0,i.jsx)(t.code,{children:"message.ext.setting"})," activity with the selected option in the ",(0,i.jsx)(t.code,{children:"activity.value.state"})," property. Handle it to save the user's selection:"]}),"\n",(0,i.jsx)(a.A,{language:"python",children:(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-python",children:'@app.on_message_ext_setting\nasync def handle_message_ext_setting(ctx: ActivityContext[MessageExtensionSettingInvokeActivity]):\n    state = getattr(ctx.activity.value, "state", None)\n\n    if state == "CancelledByUser":\n        result = MessagingExtensionResult(\n            type=MessagingExtensionResultType.RESULT, attachment_layout=AttachmentLayout.LIST, attachments=[]\n        )\n        return MessagingExtensionInvokeResponse(compose_extension=result)\n\n    selected_option = state\n    await ctx.send(f"Selected option: {selected_option}")\n\n    result = MessagingExtensionResult(\n        type=MessagingExtensionResultType.RESULT, attachment_layout=AttachmentLayout.LIST, attachments=[]\n    )\n\n    return MessagingExtensionInvokeResponse(compose_extension=result)\n'})})})]})}function h(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(g,{...e})}):g(e)}},84913:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/settings-74b93b201e3c79115ad8739e7d8c2c27.png"}}]);
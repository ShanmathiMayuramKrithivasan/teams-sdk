"use strict";(self.webpackChunkteams_md=self.webpackChunkteams_md||[]).push([[1763],{976:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/abs-custom-oauth-connection-539e7c192c1a3b032115f330c65bf5d1.png"},22491:(e,n,s)=>{s.d(n,{A:()=>i});s(63696);var t=s(11750);const a={tabItem:"tabItem_wHwb"};var r=s(62540);function i({children:e,hidden:n,className:s}){return(0,r.jsx)("div",{role:"tabpanel",className:(0,t.A)(a.tabItem,s),hidden:n,children:e})}},26802:(e,n,s)=>{s.d(n,{A:()=>r});var t=s(22147),a=s(62540);function r({language:e,children:n}){return(0,t.zy)().pathname.includes(`/${e}/`)?(0,a.jsx)(a.Fragment,{children:n}):null}},43023:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>o});var t=s(63696);const a={},r=t.createContext(a);function i(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),t.createElement(r.Provider,{value:n},e.children)}},78296:(e,n,s)=>{s.d(n,{A:()=>w});var t=s(63696),a=s(11750),r=s(53237),i=s(90766),o=s(22147),l=s(14395),c=s(35043),d=s(44544),h=s(41506);function u(e){return t.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,t.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function p(e){const{values:n,children:s}=e;return(0,t.useMemo)((()=>{const e=n??function(e){return u(e).map((({props:{value:e,label:n,attributes:s,default:t}})=>({value:e,label:n,attributes:s,default:t})))}(s);return function(e){const n=(0,d.XI)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,s])}function g({value:e,tabValues:n}){return n.some((n=>n.value===e))}function m({queryString:e=!1,groupId:n}){const s=(0,o.W6)(),a=function({queryString:e=!1,groupId:n}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:e,groupId:n});return[(0,c.aZ)(a),(0,t.useCallback)((e=>{if(!a)return;const n=new URLSearchParams(s.location.search);n.set(a,e),s.replace({...s.location,search:n.toString()})}),[a,s])]}function f(e){const{defaultValue:n,queryString:s=!1,groupId:a}=e,r=p(e),[i,o]=(0,t.useState)((()=>function({defaultValue:e,tabValues:n}){if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!g({value:e,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const s=n.find((e=>e.default))??n[0];if(!s)throw new Error("Unexpected error: 0 tabValues");return s.value}({defaultValue:n,tabValues:r}))),[c,d]=m({queryString:s,groupId:a}),[u,f]=function({groupId:e}){const n=function(e){return e?`docusaurus.tab.${e}`:null}(e),[s,a]=(0,h.Dv)(n);return[s,(0,t.useCallback)((e=>{n&&a.set(e)}),[n,a])]}({groupId:a}),x=(()=>{const e=c??u;return g({value:e,tabValues:r})?e:null})();(0,l.A)((()=>{x&&o(x)}),[x]);return{selectedValue:i,selectValue:(0,t.useCallback)((e=>{if(!g({value:e,tabValues:r}))throw new Error(`Can't select invalid tab value=${e}`);o(e),d(e),f(e)}),[d,f,r]),tabValues:r}}var x=s(86681);const v={tabList:"tabList_J5MA",tabItem:"tabItem_l0OV"};var y=s(62540);function j({className:e,block:n,selectedValue:s,selectValue:t,tabValues:r}){const o=[],{blockElementScrollPositionUntilNextRender:l}=(0,i.a_)(),c=e=>{const n=e.currentTarget,a=o.indexOf(n),i=r[a].value;i!==s&&(l(n),t(i))},d=e=>{let n=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const s=o.indexOf(e.currentTarget)+1;n=o[s]??o[0];break}case"ArrowLeft":{const s=o.indexOf(e.currentTarget)-1;n=o[s]??o[o.length-1];break}}n?.focus()};return(0,y.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,a.A)("tabs",{"tabs--block":n},e),children:r.map((({value:e,label:n,attributes:t})=>(0,y.jsx)("li",{role:"tab",tabIndex:s===e?0:-1,"aria-selected":s===e,ref:e=>{o.push(e)},onKeyDown:d,onClick:c,...t,className:(0,a.A)("tabs__item",v.tabItem,t?.className,{"tabs__item--active":s===e}),children:n??e},e)))})}function b({lazy:e,children:n,selectedValue:s}){const r=(Array.isArray(n)?n:[n]).filter(Boolean);if(e){const e=r.find((e=>e.props.value===s));return e?(0,t.cloneElement)(e,{className:(0,a.A)("margin-top--md",e.props.className)}):null}return(0,y.jsx)("div",{className:"margin-top--md",children:r.map(((e,n)=>(0,t.cloneElement)(e,{key:n,hidden:e.props.value!==s})))})}function k(e){const n=f(e);return(0,y.jsxs)("div",{className:(0,a.A)(r.G.tabs.container,"tabs-container",v.tabList),children:[(0,y.jsx)(j,{...n,...e}),(0,y.jsx)(b,{...n,...e})]})}function w(e){const n=(0,x.A)();return(0,y.jsx)(k,{...e,children:u(e.children)},String(n))}},95763:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>h,contentTitle:()=>d,default:()=>g,frontMatter:()=>c,metadata:()=>t,toc:()=>u});const t=JSON.parse('{"id":"typescript/migrations/slack-bolt","title":"Porting your Slack Bolt bot","description":"\x3c!--","source":"@site/docs/main/typescript/migrations/slack-bolt.mdx","sourceDirName":"typescript/migrations","slug":"/typescript/migrations/slack-bolt","permalink":"/teams-sdk/typescript/migrations/slack-bolt","draft":false,"unlisted":false,"editUrl":"https://github.com/microsoft/teams-sdk/tree/main/teams.md/docs/main/typescript/migrations/slack-bolt.mdx","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"title":"Porting your Slack Bolt bot","languages":["typescript"],"summary":"Migration & port guide from Slack Bolt to Teams SDK, highlighting the key changes and upgrade steps."},"sidebar":"default","previous":{"title":"User Authentication","permalink":"/teams-sdk/typescript/migrations/botbuilder/user-authentication"},"next":{"title":"Migrating from Teams SDK v1","permalink":"/teams-sdk/typescript/migrations/v1"}}');var a=s(62540),r=s(43023),i=s(26802),o=s(78296),l=s(22491);const c={sidebar_position:2,title:"Porting your Slack Bolt bot",languages:["typescript"],summary:"Migration & port guide from Slack Bolt to Teams SDK, highlighting the key changes and upgrade steps."},d="Porting your Slack Bolt bot",h={},u=[{value:"Introduction",id:"introduction",level:2},{value:"Configuring your application",id:"configuring-your-application",level:2},{value:"Installing Teams SDK",id:"installing-teams-sdk",level:2},{value:"Configure application",id:"configure-application",level:2},{value:"Migrate message handlers",id:"migrate-message-handlers",level:2},{value:"Message handlers",id:"message-handlers",level:3},{value:"BlockKit -&gt; Adaptive Cards",id:"blockkit---adaptive-cards",level:2},{value:"User authentication",id:"user-authentication",level:2},{value:"User-delegated REST APIs",id:"user-delegated-rest-apis",level:3},{value:"User authentication for external services",id:"user-authentication-for-external-services",level:3}];function p(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"porting-your-slack-bolt-bot",children:"Porting your Slack Bolt bot"})}),"\n",(0,a.jsx)(n.p,{children:"This guide will help you migrate or port your existing Slack Bolt application to the Teams SDK. We'll cover the key conceptual similarities and differences between Slack and Teams APIs, and provide code examples to help you port things over in no time. Let's get started!"}),"\n",(0,a.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,a.jsx)(n.p,{children:"Similar to Slack Bolt, the Teams SDK is designed to interface with the Teams backend APIs for building conversational applications. Both SDKs provide abstractions for handling incoming events, messages, and interactions, as well as sending responses back to users. If you already have a Slack bot, the concepts should feel familiar."}),"\n",(0,a.jsx)(n.p,{children:"However, there are some key differences, such as with app installation. In Slack, apps are installed to workspaces via OAuth, whereas in Teams they are installed via the Teams App Store. Additionally, Teams apps can be installed personally by individual users, or to collaborative scopes like group chats, channels, and meetings."}),"\n",(0,a.jsx)(n.p,{children:"Let's take a look at some similarities and differences between Slack and Teams concepts:"}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Concept"}),(0,a.jsx)(n.th,{children:"Teams"}),(0,a.jsx)(n.th,{children:"Slack"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.strong,{children:"Installation"})}),(0,a.jsx)(n.td,{children:"Installed via app store on per-scope basis"}),(0,a.jsx)(n.td,{children:"Installed via OAuth to Workspace"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.strong,{children:"Quickstart"})}),(0,a.jsx)(n.td,{children:"New projects created via Agent Toolkit CLI, Visual Studio extension, or VS Code extension."}),(0,a.jsx)(n.td,{children:"New projects created via Slack CLI."})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.strong,{children:"App manifest"})}),(0,a.jsx)(n.td,{children:"Authored via JSON, Agent Toolkit, and/or via Teams Developer Portal. Must also setup Azure Bot and Azure App Registration resources, which can be done via Azure Portal or Agent Toolkit."}),(0,a.jsx)(n.td,{children:"Authored via JSON, YAML, or app management page."})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.strong,{children:"Messaging endpoint"})}),(0,a.jsx)(n.td,{children:"Set in Azure Bot resource."}),(0,a.jsx)(n.td,{children:"Set in Slack app manifest."})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.strong,{children:"App authentication"})}),(0,a.jsx)(n.td,{children:"Entra App Registration is authorized during Teams app installation. Teams SDK fetches Entra app token internally when sending messages. Core app features like messaging use this auth type internally within the SDK."}),(0,a.jsxs)(n.td,{children:["App stores Slack bot token after user authorizes application-delegated scopes (e.g.,",(0,a.jsx)(n.code,{children:"incoming-webhook,commands"}),"). Core app features like messaging use this auth type internally within the SDK."]})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.strong,{children:"User authentication for REST APIs"})}),(0,a.jsx)(n.td,{children:"User Entra tokens can be obtained using Teams SSO. Graph REST APIs are integrated into the Teams SDK. Tokens are stored and refreshed by Azure Bot Token service."}),(0,a.jsx)(n.td,{children:"User Slack tokens can be obtained using OAuth 2.0. Slack REST APIs are integrated into Slack Bolt. Tokens must be stored and refreshed by application."})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.strong,{children:"Authentication with external services"})}),(0,a.jsx)(n.td,{children:"Obtain user access tokens for external services using OAuth 2.0. Tokens are stored and refreshed by Azure Bot Token service."}),(0,a.jsx)(n.td,{children:"Users authenticate to external services using OAuth 2.0, perhaps initiated via account binding (see below). Tokens must be stored and refreshed by application."})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.strong,{children:"Account linking"})}),(0,a.jsxs)(n.td,{children:[(0,a.jsx)(n.code,{children:"Activity"})," events include ",(0,a.jsx)(n.code,{children:"Activity.from.id"}),", which is the user's AAD object ID. If you authenticate your external service with OAuth 2.0, these accounts are implicitly bound via the Azure Token Service, but you can also follow a similar flow as what Slack recommends."]}),(0,a.jsxs)(n.td,{children:["Slack recommends following their ",(0,a.jsx)(n.a,{href:"https://docs.slack.dev/authentication/binding-accounts-across-services",children:"Binding accounts across services"})," guide."]})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.strong,{children:"Cards"})}),(0,a.jsx)(n.td,{children:"Rich UI elements in messages using Adaptive Cards."}),(0,a.jsx)(n.td,{children:"Rich UI elements in messages using Block Kit."})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.strong,{children:"Files"})}),(0,a.jsx)(n.td,{children:"Files can be attached or downloaded using SharePoint / OneDrive Graph APIs."}),(0,a.jsx)(n.td,{children:"Files can be attached or downloaded via Slack's files APIs."})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.strong,{children:"Targeted messages"})}),(0,a.jsx)(n.td,{children:"Teams does not currently support targeted messages."}),(0,a.jsx)(n.td,{children:"Slack supports targeted ephemeral messages."})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.strong,{children:"Slash commands"})}),(0,a.jsxs)(n.td,{children:["Teams supports ",(0,a.jsx)(n.a,{href:"https://learn.microsoft.com/microsoftteams/platform/bots/how-to/create-a-bot-commands-menu",children:"slash commands"})," that are declared in the app manifest. Unlike Slack, commands are sent as messages and thus are visible to all users in the conversation. Listen for new commands using ",(0,a.jsx)(n.code,{children:"app.message"})," handler, either via ",(0,a.jsx)(n.code,{children:"app.message('/command')"})," or ",(0,a.jsx)(n.code,{children:"app.message(regexp)"}),"."]}),(0,a.jsxs)(n.td,{children:["Slack Bolt has a dedicated ",(0,a.jsx)(n.code,{children:"app.command"})," handler for commands in the Slack app manifest. Slash commands are not displayed to other users in collaborative contexts."]})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.strong,{children:"Workflows"})}),(0,a.jsxs)(n.td,{children:["Teams Workflows is not integrated with the Teams SDK. To integrate with Teams Workflows, you must create a ",(0,a.jsx)(n.a,{href:"https://learn.microsoft.com/connectors/custom-connectors/",children:"custom Power Platform Connector"}),"."]}),(0,a.jsx)(n.td,{children:"Slack Workflows are integrated with Slack Bolt."})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.strong,{children:"UI dialogs"})}),(0,a.jsxs)(n.td,{children:["Adaptive Cards can include actions that open ",(0,a.jsx)(n.a,{href:"../in-depth-guides/dialogs",children:"UI dialogs"})," with an embedded website or another adaptive card. Dialogs must be opened via an adaptive card action and thus cannot be opened directly via a slash command."]}),(0,a.jsxs)(n.td,{children:["BlockKit UI modals can be opened via slash commands (using ",(0,a.jsx)(n.code,{children:"client.views.open"}),") or BlockKit actions."]})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.strong,{children:"AI strategy"})}),(0,a.jsxs)(n.td,{children:["Teams has unique AI-native features for things like user feedback, AI-generated labels, prompt suggestions, streaming, and citations. We also feature an optional ",(0,a.jsx)(n.code,{children:"ChatPrompt"})," class to simplify integrating LLMs into your bot. Leverage grounded search via the ",(0,a.jsx)(n.a,{href:"https://learn.microsoft.com/microsoft-365-copilot/extensibility/api/ai-services/retrieval/overview",children:"Microsoft 365 Copilot Retrieval Graph API"}),". AI features are generally designed for use in any conversation type."]}),(0,a.jsxs)(n.td,{children:["Slack has a dedicated ",(0,a.jsx)(n.code,{children:"Assistant"})," class for AI interactions in a dedicated agent side panel view, which differs from Teams's strategy of using existing bot interaction patterns. Can still use AI in other conversation types using standard bot APIs. Can use Slack Data Access API for grounded search."]})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.strong,{children:"AI user feedback"})}),(0,a.jsx)(n.td,{children:"User feedback buttons are natively rendered in Teams with dedicated APIs for handling feedback. After user gives positive or negative feedback, a modal is opened where additional information (e.g., plain text response) can be captured."}),(0,a.jsxs)(n.td,{children:["Slack uses a dedicated ",(0,a.jsx)(n.code,{children:"feedback_buttons"})," BlockKit element type and ",(0,a.jsx)(n.code,{children:"app.action('feedback')"})," for attaching user feedback (positive vs. negative) to messages."]})]})]})]}),"\n",(0,a.jsx)(n.h2,{id:"configuring-your-application",children:"Configuring your application"}),"\n",(0,a.jsxs)(n.p,{children:["First, setup a new Teams application, as shown in ",(0,a.jsx)(n.a,{href:"/teams-sdk/teams/",children:"Teams Integration"}),"."]}),"\n",(0,a.jsx)(n.h2,{id:"installing-teams-sdk",children:"Installing Teams SDK"}),"\n",(0,a.jsxs)(i.A,{language:"typescript",children:[(0,a.jsxs)(n.p,{children:["First, let's install the Teams SDK into your project. This will install the Teams SDK alongside any existing packages. After you've completed your migration, you can safely remove the ",(0,a.jsx)(n.code,{children:"@microsoft/teams-ai"})," dependency from your ",(0,a.jsx)(n.code,{children:"package.json"})," file."]}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sh",children:"npm install @microsoft/teams.apps\n"})})]}),"\n",(0,a.jsx)(n.h2,{id:"configure-application",children:"Configure application"}),"\n",(0,a.jsxs)(i.A,{language:"typescript",children:[(0,a.jsxs)(n.p,{children:["First, let's configure the ",(0,a.jsx)(n.code,{children:"App"})," class in Teams JS. This is equivalent to Slack Bolt's ",(0,a.jsx)(n.code,{children:"App"})," class."]}),(0,a.jsxs)(o.A,{children:[(0,a.jsx)(l.A,{value:"Diff",default:!0,children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:'  // Setup app\n  // highlight-error-start\n  import { App } from \'@slack/bolt\';\n\n  const app = new App({\n      signingSecret: process.env.SLACK_SIGNING_SECRET,\n      clientId: process.env.SLACK_CLIENT_ID,\n      clientSecret: process.env.SLACK_CLIENT_SECRET,\n      scopes: [\n          "channels:manage",\n          "channels:read",\n          "chat:write",\n          "groups:read",\n          "incoming-webhook",\n      ],\n      installerOptions: {\n          authVersion: "v2",\n          directInstall: false,\n          installPath: "/slack/install",\n          metadata: "",\n          redirectUriPath: "/slack/oauth_redirect",\n          stateVerification: "true",\n          /**\n          * Example pages to navigate to on certain callbacks.\n          */\n          callbackOptions: {\n              success: (installation, installUrlOptions, req, res) => {\n                  res.send("The installation succeeded!");\n              },\n              failure: (error, installUrlOptions, req, res) => {\n                  res.send("Something strange happened...");\n              },\n          },\n          /**\n          * Example validation of installation options using a random state and an\n          * expiration time between requests.\n          */\n          stateStore: {\n              generateStateParam: async (installUrlOptions, now) => {\n                  const state = randomStringGenerator();\n                  const value = { options: installUrlOptions, now: now.toJSON() };\n                  await database.set(state, value);\n                  return state;\n              },\n              verifyStateParam: async (now, state) => {\n                  const value = await database.get(state);\n                  const generated = new Date(value.now);\n                  const seconds = Math.floor(\n                      (now.getTime() - generated.getTime()) / 1000,\n                  );\n                  if (seconds > 600) {\n                      throw new Error("The state expired after 10 minutes!");\n                  }\n                  return value.options;\n              },\n          },\n      },\n  });\n  // highlight-error-end\n  // highlight-success-start\n  import { App } from \'@microsoft/teams.apps\';\n\n  // Define app\n  const app = new App({\n      clientId: process.env.ENTRA_APP_CLIENT_ID!,\n      clientSecret: process.env.ENTRA_APP_CLIENT_SECRET!,\n      tenantId: process.env.ENTRA_TENANT_ID!,\n  });\n  // highlight-success-end\n\n  // App starts local server with route for /api/messages\n  (async () => {\n      await app.start();\n  })();\n'})})}),(0,a.jsx)(l.A,{value:"slack",label:"Slack Bolt",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:'import { App } from \'@slack/bolt\';\n\nconst app = new App({\n    signingSecret: process.env.SLACK_SIGNING_SECRET,\n    clientId: process.env.SLACK_CLIENT_ID,\n    clientSecret: process.env.SLACK_CLIENT_SECRET,\n    scopes: [\n        "channels:manage",\n        "channels:read",\n        "chat:write",\n        "groups:read",\n        "incoming-webhook",\n    ],\n    installerOptions: {\n        authVersion: "v2",\n        directInstall: false,\n        installPath: "/slack/install",\n        metadata: "",\n        redirectUriPath: "/slack/oauth_redirect",\n        stateVerification: "true",\n        /**\n        * Example pages to navigate to on certain callbacks.\n        */\n        callbackOptions: {\n            success: (installation, installUrlOptions, req, res) => {\n                res.send("The installation succeeded!");\n            },\n            failure: (error, installUrlOptions, req, res) => {\n                res.send("Something strange happened...");\n            },\n        },\n        /**\n        * Example validation of installation options using a random state and an\n        * expiration time between requests.\n        */\n        stateStore: {\n            generateStateParam: async (installUrlOptions, now) => {\n                const state = randomStringGenerator();\n                const value = { options: installUrlOptions, now: now.toJSON() };\n                await database.set(state, value);\n                return state;\n            },\n            verifyStateParam: async (now, state) => {\n                const value = await database.get(state);\n                const generated = new Date(value.now);\n                const seconds = Math.floor(\n                    (now.getTime() - generated.getTime()) / 1000,\n                );\n                if (seconds > 600) {\n                    throw new Error("The state expired after 10 minutes!");\n                }\n                return value.options;\n            },\n        },\n    },\n});\n\n// App starts local server with route for /slack/events\n(async () => {\n    await app.start();\n})();\n'})})}),(0,a.jsx)(l.A,{value:"teams",label:"Teams SDK",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:"import { App } from '@microsoft/teams.apps';\n\n// Define app\nconst app = new App({\n    clientId: process.env.ENTRA_APP_CLIENT_ID!,\n    clientSecret: process.env.ENTRA_APP_CLIENT_SECRET!,\n    tenantId: process.env.ENTRA_TENANT_ID!,\n});\n\n// App starts local server with route for /api/messages\n// To reuse your restify or other server,\n// create a custom `HttpPlugin`.\n(async () => {\n    await app.start();\n})();\n"})})})]})]}),"\n",(0,a.jsx)(n.h2,{id:"migrate-message-handlers",children:"Migrate message handlers"}),"\n",(0,a.jsxs)(n.p,{children:["In Slack, there are message handlers for events with different subtypes (e.g., undefined subtype is a regular message, ",(0,a.jsx)(n.code,{children:"event.subtype == 'file_share'"})," is a file share message, etc.). In Teams, there are different ",(0,a.jsx)(n.code,{children:"Activity"})," handers for different types of events that are enumerated via the ",(0,a.jsx)(n.code,{children:"ActivityTypes"})," enum (e.g., ",(0,a.jsx)(n.code,{children:"app.activity(ActivityTypes.Message)"}),"), with some ",(0,a.jsx)(n.code,{children:"Activity"})," types having tailored APIs within the SDK (e.g., ",(0,a.jsx)(n.code,{children:"app.message"}),"). These concepts are roughly similar, though the naming conventions and syntax differ."]}),"\n",(0,a.jsx)(n.h3,{id:"message-handlers",children:"Message handlers"}),"\n",(0,a.jsx)(i.A,{language:"typescript",children:(0,a.jsxs)(o.A,{children:[(0,a.jsx)(l.A,{value:"Diff",default:!0,children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:'// triggers user sends "hi" or "@bot hi"\n// highlight-error-start\napp.message("hi", async ({ message, say }) => {\n    // Handle only newly posted messages here\n    if (message.subtype) return;\n    await say(`Hello, <@${message.user}>`);\n});\n// highlight-error-end\n// highlight-success-start\napp.message("hi", async ({ send, activity }) => {\n  await send(`Hello, ${activity.from.name}!`);\n});\n// highlight-success-end\n// listen for ANY message to be received\n// highlight-error-start\napp.message(async ({ message, say }) => {\n    // Handle only newly posted messages here\n    if (message.subtype) return;\n    // echo back users request\n    await say(`you said: ${message.text}`);\n});\n// highlight-error-end\n// highlight-success-start\napp.on(\'message\', async ({ send, activity }) => {\n    // echo back users request\n    await send(`you said: ${activity.text}`);\n});\n// highlight-success-end\n'})})}),(0,a.jsx)(l.A,{value:"slack",label:"Slack Bolt",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:'// triggers when user sends a message containing "hi"\napp.message("hi", async ({ message, say }) => {\n    // Handle only newly posted messages here\n    if (message.subtype) return;\n    await say(`Hello, <@${message.user}>`);\n});\n// listen for ANY message\napp.message(async ({ message, say }) => {\n    // Handle only newly posted messages here\n    if (message.subtype) return;\n    // echo back users request\n    await say(`you said: ${message.text}`);\n});\n'})})}),(0,a.jsx)(l.A,{value:"teams",label:"Teams SDK",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:'// triggers when user sends "hi" or "@bot hi"\napp.message("hi", async ({ send, activity }) => {\n  await send(`Hello, ${activity.from.name}!`);\n});\n// listen for ANY message to be received\napp.on(\'message\', async ({ send, activity }) => {\n    // echo back users request\n    await send(`you said: ${activity.text}`);\n});\n'})})})]})}),"\n",(0,a.jsx)(n.h2,{id:"blockkit---adaptive-cards",children:"BlockKit -> Adaptive Cards"}),"\n",(0,a.jsx)(n.p,{children:"To include Rich UI in messages sent by your bot, Slack's Block Kit is equivalent to Teams's Adaptive Cards."}),"\n",(0,a.jsx)(i.A,{language:"typescript",children:(0,a.jsxs)(o.A,{children:[(0,a.jsx)(l.A,{value:"Diff",default:!0,children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:"// highlight-error-start\napp.message('card', async (client) => {\n    await say({\n        blocks: [\n            {\n                type: 'section',\n                text: {\n                    type: 'plain_text',\n                    text: 'Hello, world!',\n                },\n            },\n        ],\n    });\n});\n// highlight-error-end\n// highlight-success-start\nimport { Card, TextBlock } from '@microsoft/teams.cards';\n\napp.message('/card', async ({ send }) => {\n    await send(\n        new Card(new TextBlock('Hello, world!', { wrap: true, isSubtle: false }))\n            .withOptions({\n                width: 'Full',\n            })\n    );\n});\n// highlight-success-end\n"})})}),(0,a.jsxs)(l.A,{value:"slack",label:"Slack Bolt",children:[(0,a.jsx)(n.p,{children:"For existing cards like this, the simplest way to convert that to Teams SDK is this:"}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:"app.message('card', async (client) => {\n    await say({\n        blocks: [\n            {\n                type: 'section',\n                text: {\n                    type: 'plain_text',\n                    text: 'Hello, world!',\n                },\n            },\n        ],\n    });\n});\n"})})]}),(0,a.jsxs)(l.A,{value:"teams",label:"Teams SDK",children:[(0,a.jsx)(n.p,{children:"For a more thorough port, you could also do the following:"}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:"import { Card, TextBlock } from '@microsoft/teams.cards';\n\napp.message('/card', async ({ send }) => {\n  await send(\n    new Card(new TextBlock('Hello, world!', { wrap: true, isSubtle: false })).withOptions({\n      width: 'Full',\n    })\n  );\n});\n"})})]})]})}),"\n",(0,a.jsxs)(n.p,{children:["Learn more in the ",(0,a.jsx)(n.a,{href:"../in-depth-guides/adaptive-cards",children:"Adaptive Cards guide"}),"."]}),"\n",(0,a.jsx)(n.h2,{id:"user-authentication",children:"User authentication"}),"\n",(0,a.jsx)(n.p,{children:"There are two primary types of user authentication for Teams and Slack: authentication for Slack & Graph REST APIs, and authentication for external services. Let's take a look at each of these in turn."}),"\n",(0,a.jsx)(n.h3,{id:"user-delegated-rest-apis",children:"User-delegated REST APIs"}),"\n",(0,a.jsx)(n.p,{children:"In Slack, if you want to use Slack REST APIs that require user-delegated scopes, you need to implement an OAuth 2.0 installation flow in your application to obtain and store Slack user tokens, even if the app was already installed by another user. In Teams, you can leverage Teams SSO to obtain user Entra tokens for calling Graph REST APIs. The Teams SDK integrates with Teams SSO and Azure Bot Token Service to handle token acquisition, storage, and refresh automatically for you."}),"\n",(0,a.jsxs)(n.p,{children:["First, follow the instructions in the ",(0,a.jsx)(n.a,{href:"/teams-sdk/teams/user-authentication/sso-setup",children:"Teams SSO guide"}),"."]}),"\n",(0,a.jsx)(n.p,{children:"Then, configure the authentication in your code."}),"\n",(0,a.jsx)(i.A,{language:"typescript",children:(0,a.jsxs)(o.A,{children:[(0,a.jsx)(l.A,{value:"Diff",default:!0,children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:"// highlight-error-start\n// TODO: Configure App class with user OAuth permissions and install app for user\n\napp.message('me', async ({ client, message }) => {\n    const me = await client.users.info({ user: message.user });\n    await client.send(JSON.stringify(me));\n});\n// highlight-error-end\n// highlight-success-start\nimport { App } from '@microsoft/teams.apps';\nimport * as endpoints from '@microsoft/teams.graph-endpoints';\n\nconst app = new App({\n    // ... rest of App config\n    oauth: {\n        // The key here should match the OAuth Connection setting\n        // defined in your Azure Bot resource.\n        defaultConnectionName: 'graph',\n    },\n});\n\napp.message('me', async ({ signin, userGraph, send }) => {\n    if (!await signin()) {\n        return;\n    }\n    const me = await userGraph.call(endpoints.me.get);\n    await send(JSON.stringify(me));\n});\n// highlight-success-end\n"})})}),(0,a.jsx)(l.A,{value:"slack",label:"Slack Bolt",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:"// TODO: Configure App class with user OAuth permissions and install app for user\n\napp.message('me', async ({ client, message }) => {\n    const me = await client.users.info({ user: message.user });\n    await client.send(JSON.stringify(me));\n});\n"})})}),(0,a.jsx)(l.A,{value:"teams",label:"Teams SDK",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:"import { App } from '@microsoft/teams.apps';\nimport * as endpoints from '@microsoft/teams.graph-endpoints';\n\nconst app = new App({\n    // ... rest of App config\n    oauth: {\n        // The key here should match the OAuth Connection setting\n        // defined in your Azure Bot resource.\n        defaultConnectionName: 'graph',\n    },\n});\n\napp.message('me', async ({ signin, userGraph, send }) => {\n    if (!await signin()) {\n        return;\n    }\n    const me = await userGraph.call(endpoints.me.get);\n    await send(JSON.stringify(me));\n});\n"})})})]})}),"\n",(0,a.jsx)(n.h3,{id:"user-authentication-for-external-services",children:"User authentication for external services"}),"\n",(0,a.jsxs)(n.p,{children:["In Slack, you can access external services by implementing an account binding flow using OAuth 2.0 as documented ",(0,a.jsx)(n.a,{href:"https://docs.slack.dev/authentication/binding-accounts-across-services",children:"here"}),". In Teams, you can access external services by implementing an OAuth 2.0 flow, with the Azure Bot Token Service handling token acquisition, storage, and refresh for you."]}),"\n",(0,a.jsxs)(n.p,{children:["First, setup your OAuth 2.0 connection settings in the ",(0,a.jsx)(n.a,{href:"https://portal.azure.com/",children:"Azure Portal"})," for your Azure Bot resource."]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"Screenshot showing Azure Bot custom OAuth connection settings.",src:s(976).A+"",width:"2648",height:"1698"})}),"\n",(0,a.jsx)(n.p,{children:"Then, add the authentication code to your application to get the relevant user token and call your external service."}),"\n",(0,a.jsx)(i.A,{language:"typescript",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:"import { App } from '@microsoft/teams.apps';\n\nconst app = new App({\n    // ... rest of App config\n    oauth: {\n        // The key here should match the OAuth Connection setting\n        // defined in your Azure Bot resource.\n        defaultConnectionName: 'custom',\n    },\n});\n\napp.message('me', async ({ activity, signin, token, send }) => {\n    // In production, it is probably better to implement a local cache.\n    // (e.g. \\`activity.from.id\\` <-> token).\n    // Otherwise this triggers an API call to Azure Token Service on every inbound message.\n    if (!await signin()) {\n        return;\n    }\n\n    // Call external API\n    const response = await fetch('https://example.com/api/helloworld', {\n        method: 'POST',\n        headers: {\n            \"Authorization\": token,\n        },\n    });\n    const result = await response.json();\n    await send(JSON.stringify(result));\n});\n"})})})]})}function g(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(p,{...e})}):p(e)}}}]);
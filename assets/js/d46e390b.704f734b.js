"use strict";(self.webpackChunkteams_md=self.webpackChunkteams_md||[]).push([[7054],{26802:(e,n,s)=>{s.d(n,{A:()=>o});var t=s(22147),a=s(62540);function o({language:e,children:n}){return(0,t.zy)().pathname.includes(`/${e}/`)?(0,a.jsx)(a.Fragment,{children:n}):null}},33169:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/compose-area-1c7340e445681d29b0c675f72985a10e.png"},43023:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>r});var t=s(63696);const a={},o=t.createContext(a);function i(e){const n=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),t.createElement(o.Provider,{value:n},e.children)}},52916:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/preview-card-f633e7427322d135be3416de38d018d0.png"},61600:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>m,contentTitle:()=>c,default:()=>h,frontMatter:()=>r,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"csharp/in-depth-guides/message-extensions/search-commands","title":"Search Commands","description":"\x3c!--","source":"@site/docs/main/csharp/in-depth-guides/message-extensions/search-commands.mdx","sourceDirName":"csharp/in-depth-guides/message-extensions","slug":"/csharp/in-depth-guides/message-extensions/search-commands","permalink":"/teams-sdk/csharp/in-depth-guides/message-extensions/search-commands","draft":false,"unlisted":false,"editUrl":"https://github.com/microsoft/teams-sdk/tree/main/teams.md/docs/main/csharp/in-depth-guides/message-extensions/search-commands.mdx","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"sidebar_label":"Search Commands","title":"Search Commands","summary":"Create search commands that allow users to search external systems and insert results as cards in Teams messages."},"sidebar":"default","previous":{"title":"Action Commands","permalink":"/teams-sdk/csharp/in-depth-guides/message-extensions/action-commands"},"next":{"title":"Settings","permalink":"/teams-sdk/csharp/in-depth-guides/message-extensions/settings"}}');var a=s(62540),o=s(43023),i=s(26802);const r={sidebar_position:2,sidebar_label:"Search Commands",title:"Search Commands",summary:"Create search commands that allow users to search external systems and insert results as cards in Teams messages."},c="\ud83d\udd0d Search commands",m={},d=[{value:"Search command invocation locations",id:"search-command-invocation-locations",level:2},{value:"Compose Area and Box",id:"compose-area-and-box",level:3},{value:"Setting up your Teams app manifest",id:"setting-up-your-teams-app-manifest",level:2},{value:"Handle submission",id:"handle-submission",level:2},{value:"Resources",id:"resources",level:2}];function l(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"-search-commands",children:"\ud83d\udd0d Search commands"})}),"\n",(0,a.jsx)(n.p,{children:"Message extension search commands allow users to search external systems and insert the results of that search into a message in the form of a card."}),"\n",(0,a.jsx)(n.h2,{id:"search-command-invocation-locations",children:"Search command invocation locations"}),"\n",(0,a.jsx)(n.p,{children:"There are two different areas search commands can be invoked from:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"Compose Area"}),"\n",(0,a.jsx)(n.li,{children:"Compose Box"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"compose-area-and-box",children:"Compose Area and Box"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"Screenshot of Teams with outlines around the &#39;Compose Box&#39; (for typing messages) and the &#39;Compose Area&#39; (the menu option next to the compose box that provides a search bar for actions and apps).",src:s(33169).A+"",width:"2762",height:"1464"})}),"\n",(0,a.jsx)(n.h2,{id:"setting-up-your-teams-app-manifest",children:"Setting up your Teams app manifest"}),"\n",(0,a.jsx)(n.p,{children:"To use search commands you have to define them in the Teams app manifest. Here is an example:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'"composeExtensions": [\n    {\n        "botId": "${{BOT_ID}}",\n        "commands": [\n            {\n                "id": "searchQuery",\n                "context": [\n                    "compose",\n                    "commandBox"\n                ],\n                "description": "Test command to run query",\n                "title": "Search query",\n                "type": "query",\n                "parameters": [\n                    {\n                        "name": "searchQuery",\n                        "title": "Search Query",\n                        "description": "Your search query",\n                        "inputType": "text"\n                    }\n                ]\n            }\n        ]\n    }\n]\n'})}),"\n",(0,a.jsxs)(n.p,{children:["Here we are defining the ",(0,a.jsx)(n.code,{children:"searchQuery"})," search (or query) command."]}),"\n",(0,a.jsx)(n.h2,{id:"handle-submission",children:"Handle submission"}),"\n",(0,a.jsxs)(n.p,{children:["Handle the search query submission when the ",(0,a.jsx)(n.code,{children:"searchQuery"})," search command is invoked."]}),"\n",(0,a.jsx)(i.A,{language:"csharp",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-csharp",children:'using Microsoft.Teams.Api.Activities.Invokes.MessageExtensions;\nusing Microsoft.Teams.Api.MessageExtensions;\nusing Microsoft.Teams.Apps.Annotations;\n\n//...\n\n[MessageExtension.Query]\npublic Response OnMessageExtensionQuery(\n    [Context] QueryActivity activity,\n    [Context] IContext.Client client,\n    [Context] ILogger log)\n{\n    log.Info("[MESSAGE_EXT_QUERY] Search query received");\n\n    var commandId = activity.Value?.CommandId;\n    var query = activity.Value?.Parameters?.FirstOrDefault(p => p.Name == "searchQuery")?.Value?.ToString() ?? "";\n\n    log.Info($"[MESSAGE_EXT_QUERY] Command: {commandId}, Query: {query}");\n\n    if (commandId == "searchQuery")\n    {\n        return CreateSearchResults(query, log);\n    }\n\n    return new Response\n    {\n        ComposeExtension = new Result\n        {\n            Type = ResultType.Result,\n            AttachmentLayout = Layout.List,\n            Attachments = new List<Microsoft.Teams.Api.MessageExtensions.Attachment>()\n        }\n    };\n}\n'})})}),"\n",(0,a.jsxs)(i.A,{language:"csharp",children:[(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"CreateSearchResults()"})," method"]}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-csharp",children:'using Microsoft.Teams.Api.MessageExtensions;\nusing Microsoft.Teams.Cards;\nusing Microsoft.Teams.Common;\n\n//...\n\nprivate static Response CreateSearchResults(string query, ILogger log)\n{\n    var attachments = new List<Microsoft.Teams.Api.MessageExtensions.Attachment>();\n\n    // Create simple search results\n    for (int i = 1; i <= 5; i++)\n    {\n        var card = new AdaptiveCard\n        {\n            Body = new List<CardElement>\n            {\n                new TextBlock($"Search Result {i}")\n                {\n                    Weight = TextWeight.Bolder,\n                    Size = TextSize.Large\n                },\n                new TextBlock($"Query: \'{query}\' - Result description for item {i}")\n                {\n                    Wrap = true,\n                    IsSubtle = true\n                }\n            }\n        };\n\n        var previewCard = new ThumbnailCard()\n        {\n            Title = $"Result {i}",\n            Text = $"This is a preview of result {i} for query \'{query}\'."\n        };\n\n        var attachment = new Microsoft.Teams.Api.MessageExtensions.Attachment\n        {\n            ContentType = ContentType.AdaptiveCard,\n            Content = card,\n            Preview = new Microsoft.Teams.Api.MessageExtensions.Attachment\n            {\n                ContentType = ContentType.ThumbnailCard,\n                Content = previewCard\n            }\n        };\n\n        attachments.Add(attachment);\n    }\n\n    return new Response\n    {\n        ComposeExtension = new Result\n        {\n            Type = ResultType.Result,\n            AttachmentLayout = Layout.List,\n            Attachments = attachments\n        }\n    };\n}\n'})}),(0,a.jsx)(n.p,{children:"To implement custom actions when a user clicks on a search result item, you can handle the select item event:"}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-csharp",children:'using System.Text.Json;\nusing Microsoft.Teams.Api;\nusing Microsoft.Teams.Api.Activities.Invokes.MessageExtensions;\nusing Microsoft.Teams.Api.MessageExtensions;\nusing Microsoft.Teams.Apps.Annotations;\nusing Microsoft.Teams.Cards;\n\n//...\n\n[MessageExtension.SelectItem]\npublic Response OnMessageExtensionSelectItem(\n    [Context] SelectItemActivity activity,\n    [Context] IContext.Client client,\n    [Context] ILogger log)\n{\n    log.Info("[MESSAGE_EXT_SELECT_ITEM] Item selection received");\n\n    var selectedItem = activity.Value;\n    log.Info($"[MESSAGE_EXT_SELECT_ITEM] Selected: {JsonSerializer.Serialize(selectedItem)}");\n\n    return CreateItemSelectionResponse(selectedItem, log);\n}\n\n// Helper method to create item selection response\nprivate static Response CreateItemSelectionResponse(object? selectedItem, ILogger log)\n{\n    var itemJson = JsonSerializer.Serialize(selectedItem);\n\n    var card = new AdaptiveCard\n    {\n        Schema = "http://adaptivecards.io/schemas/adaptive-card.json",\n        Body = new List<CardElement>\n        {\n            new TextBlock("Item Selected")\n            {\n                Weight = TextWeight.Bolder,\n                Size = TextSize.Large,\n                Color = TextColor.Good\n            },\n            new TextBlock("You selected the following item:")\n            {\n                Wrap = true\n            },\n            new TextBlock(itemJson)\n            {\n                Wrap = true,\n                FontType = FontType.Monospace,\n                Separator = true\n            }\n        }\n    };\n\n    var attachment = new Microsoft.Teams.Api.MessageExtensions.Attachment\n    {\n        ContentType = new ContentType("application/vnd.microsoft.card.adaptive"),\n        Content = card\n    };\n\n    return new Response\n    {\n        ComposeExtension = new Result\n        {\n            Type = ResultType.Result,\n            AttachmentLayout = Layout.List,\n            Attachments = new List<Microsoft.Teams.Api.MessageExtensions.Attachment> { attachment }\n        }\n    };\n}\n'})})]}),"\n",(0,a.jsx)(n.p,{children:"The search results include both a full adaptive card and a preview card. The preview card appears as a list item in the search command area:"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"Screenshot of Teams showing a message extensions search menu open with list of search results displayed as preview cards.",src:s(52916).A+"",width:"2155",height:"1468"})}),"\n",(0,a.jsx)(n.p,{children:"When a user clicks on a list item the dummy adaptive card is added to the compose box:"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"Screenshot of Teams showing the selected adaptive card added to the compose box.",src:s(92458).A+"",width:"2168",height:"1458"})}),"\n",(0,a.jsxs)(n.p,{children:["To implement custom actions when a user clicks on a search result item, you can add the ",(0,a.jsx)(n.code,{children:"tap"})," property to the preview card. This allows you to handle the click event with custom logic:"]}),"\n",(0,a.jsx)(n.h2,{id:"resources",children:"Resources"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/microsoftteams/platform/messaging-extensions/how-to/search-commands/define-search-command?tabs=Teams-toolkit%2Cdotnet",children:"Search command"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/microsoftteams/platform/messaging-extensions/how-to/search-commands/universal-actions-for-search-based-message-extensions#just-in-time-install",children:"Just-In-Time Install"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(l,{...e})}):l(e)}},92458:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/card-in-compose-2317acd98e4b7dea25e1334274f1f3cc.png"}}]);
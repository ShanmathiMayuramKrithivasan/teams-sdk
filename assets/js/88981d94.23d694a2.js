"use strict";(self.webpackChunkteams_md=self.webpackChunkteams_md||[]).push([[4132],{26802:(e,n,t)=>{t.d(n,{A:()=>i});var s=t(22147),a=t(62540);function i({language:e,children:n}){return(0,s.zy)().pathname.includes(`/${e}/`)?(0,a.jsx)(a.Fragment,{children:n}):null}},33169:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/compose-area-1c7340e445681d29b0c675f72985a10e.png"},43023:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>r});var s=t(63696);const a={},i=s.createContext(a);function o(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),s.createElement(i.Provider,{value:n},e.children)}},52916:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/preview-card-f633e7427322d135be3416de38d018d0.png"},60554:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>m,contentTitle:()=>c,default:()=>l,frontMatter:()=>r,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"python/in-depth-guides/message-extensions/search-commands","title":"Search Commands","description":"\x3c!--","source":"@site/docs/main/python/in-depth-guides/message-extensions/search-commands.mdx","sourceDirName":"python/in-depth-guides/message-extensions","slug":"/python/in-depth-guides/message-extensions/search-commands","permalink":"/teams-sdk/python/in-depth-guides/message-extensions/search-commands","draft":false,"unlisted":false,"editUrl":"https://github.com/microsoft/teams-sdk/tree/main/teams.md/docs/main/python/in-depth-guides/message-extensions/search-commands.mdx","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"sidebar_label":"Search Commands","title":"Search Commands","summary":"Create search commands that allow users to search external systems and insert results as cards in Teams messages."},"sidebar":"default","previous":{"title":"Action Commands","permalink":"/teams-sdk/python/in-depth-guides/message-extensions/action-commands"},"next":{"title":"Settings","permalink":"/teams-sdk/python/in-depth-guides/message-extensions/settings"}}');var a=t(62540),i=t(43023),o=t(26802);const r={sidebar_position:2,sidebar_label:"Search Commands",title:"Search Commands",summary:"Create search commands that allow users to search external systems and insert results as cards in Teams messages."},c="\ud83d\udd0d Search commands",m={},d=[{value:"Search command invocation locations",id:"search-command-invocation-locations",level:2},{value:"Compose Area and Box",id:"compose-area-and-box",level:3},{value:"Setting up your Teams app manifest",id:"setting-up-your-teams-app-manifest",level:2},{value:"Handle submission",id:"handle-submission",level:2},{value:"Resources",id:"resources",level:2}];function h(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"-search-commands",children:"\ud83d\udd0d Search commands"})}),"\n",(0,a.jsx)(n.p,{children:"Message extension search commands allow users to search external systems and insert the results of that search into a message in the form of a card."}),"\n",(0,a.jsx)(n.h2,{id:"search-command-invocation-locations",children:"Search command invocation locations"}),"\n",(0,a.jsx)(n.p,{children:"There are two different areas search commands can be invoked from:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"Compose Area"}),"\n",(0,a.jsx)(n.li,{children:"Compose Box"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"compose-area-and-box",children:"Compose Area and Box"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"Screenshot of Teams with outlines around the &#39;Compose Box&#39; (for typing messages) and the &#39;Compose Area&#39; (the menu option next to the compose box that provides a search bar for actions and apps).",src:t(33169).A+"",width:"2762",height:"1464"})}),"\n",(0,a.jsx)(n.h2,{id:"setting-up-your-teams-app-manifest",children:"Setting up your Teams app manifest"}),"\n",(0,a.jsx)(n.p,{children:"To use search commands you have to define them in the Teams app manifest. Here is an example:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'"composeExtensions": [\n    {\n        "botId": "${{BOT_ID}}",\n        "commands": [\n            {\n                "id": "searchQuery",\n                "context": [\n                    "compose",\n                    "commandBox"\n                ],\n                "description": "Test command to run query",\n                "title": "Search query",\n                "type": "query",\n                "parameters": [\n                    {\n                        "name": "searchQuery",\n                        "title": "Search Query",\n                        "description": "Your search query",\n                        "inputType": "text"\n                    }\n                ]\n            }\n        ]\n    }\n]\n'})}),"\n",(0,a.jsxs)(n.p,{children:["Here we are defining the ",(0,a.jsx)(n.code,{children:"searchQuery"})," search (or query) command."]}),"\n",(0,a.jsx)(n.h2,{id:"handle-submission",children:"Handle submission"}),"\n",(0,a.jsxs)(n.p,{children:["Handle the search query submission when the ",(0,a.jsx)(n.code,{children:"searchQuery"})," search command is invoked."]}),"\n",(0,a.jsx)(o.A,{language:"python",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'from microsoft_teams.api import AdaptiveCardAttachment, MessageExtensionQueryInvokeActivity, ThumbnailCardAttachment, card_attachment, InvokeResponse, AttachmentLayout, MessagingExtensionAttachment, MessagingExtensionInvokeResponse, MessagingExtensionResult, MessagingExtensionResultType\n# ...\n\n@app.on_message_ext_query\nasync def handle_message_ext_query(ctx: ActivityContext[MessageExtensionQueryInvokeActivity]):\n    command_id = ctx.activity.value.command_id\n    search_query = ""\n    if ctx.activity.value.parameters and len(ctx.activity.value.parameters) > 0:\n        search_query = ctx.activity.value.parameters[0].value or ""\n\n    if command_id == "searchQuery":\n        cards = await create_dummy_cards(search_query)\n        attachments: list[MessagingExtensionAttachment] = []\n        for card_data in cards:\n            main_attachment = card_attachment(AdaptiveCardAttachment(content=card_data["card"]))\n            preview_attachment = card_attachment(ThumbnailCardAttachment(content=card_data["thumbnail"]))\n\n            attachment = MessagingExtensionAttachment(\n                content_type=main_attachment.content_type, content=main_attachment.content, preview=preview_attachment\n            )\n            attachments.append(attachment)\n\n        result = MessagingExtensionResult(\n            type=MessagingExtensionResultType.RESULT, attachment_layout=AttachmentLayout.LIST, attachments=attachments\n        )\n\n        return MessagingExtensionInvokeResponse(compose_extension=result)\n\n    return InvokeResponse[MessagingExtensionInvokeResponse](status=400)\n\n'})})}),"\n",(0,a.jsxs)(o.A,{language:"python",children:[(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"create_dummy_cards()"})," method"]}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'from typing import Any, Dict, List\nfrom microsoft_teams.cards import AdaptiveCard\n# ...\n\nasync def create_dummy_cards(search_query: str) -> List[Dict[str, Any]]:\n    """Create dummy cards for search results."""\n    dummy_items = [\n        {\n            "title": "Item 1",\n            "description": f"This is the first item and this is your search query: {search_query}",\n        },\n        {"title": "Item 2", "description": "This is the second item"},\n        {"title": "Item 3", "description": "This is the third item"},\n        {"title": "Item 4", "description": "This is the fourth item"},\n        {"title": "Item 5", "description": "This is the fifth item"},\n    ]\n\n    cards: List[Dict[str, Any]] = []\n    for item in dummy_items:\n        card_data: Dict[str, Any] = {\n            "card": AdaptiveCard.model_validate(\n                {\n                    "type": "AdaptiveCard",\n                    "version": "1.4",\n                    "body": [\n                        {\n                            "type": "TextBlock",\n                            "text": item["title"],\n                            "size": "Large",\n                            "weight": "Bolder",\n                            "color": "Accent",\n                            "style": "heading",\n                        },\n                        {"type": "TextBlock", "text": item["description"], "wrap": True, "spacing": "Medium"},\n                    ],\n                }\n            ),\n            "thumbnail": {\n                "title": item["title"],\n                "text": item["description"],\n            },\n        }\n        cards.append(card_data)\n\n    return cards\n'})})]}),"\n",(0,a.jsx)(n.p,{children:"The search results include both a full adaptive card and a preview card. The preview card appears as a list item in the search command area:"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"Screenshot of Teams showing a message extensions search menu open with list of search results displayed as preview cards.",src:t(52916).A+"",width:"2155",height:"1468"})}),"\n",(0,a.jsx)(n.p,{children:"When a user clicks on a list item the dummy adaptive card is added to the compose box:"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"Screenshot of Teams showing the selected adaptive card added to the compose box.",src:t(92458).A+"",width:"2168",height:"1458"})}),"\n",(0,a.jsxs)(n.p,{children:["To implement custom actions when a user clicks on a search result item, you can add the ",(0,a.jsx)(n.code,{children:"tap"})," property to the preview card. This allows you to handle the click event with custom logic:"]}),"\n",(0,a.jsx)(o.A,{language:"python",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'from microsoft_teams.api import MessageExtensionSelectItemInvokeActivity, AttachmentLayout, MessagingExtensionInvokeResponse, MessagingExtensionResult, MessagingExtensionResultType\nfrom microsoft_teams.apps import ActivityContext\n# ...\n\n@app.on_message_ext_select_item\nasync def handle_message_ext_select_item(ctx: ActivityContext[MessageExtensionSelectItemInvokeActivity]):\n    option = getattr(ctx.activity.value, "option", None)\n    await ctx.send(f"Selected item: {option}")\n\n    result = MessagingExtensionResult(\n        type=MessagingExtensionResultType.RESULT, attachment_layout=AttachmentLayout.LIST, attachments=[]\n    )\n\n    return MessagingExtensionInvokeResponse(compose_extension=result)\n'})})}),"\n",(0,a.jsx)(n.h2,{id:"resources",children:"Resources"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/microsoftteams/platform/messaging-extensions/how-to/search-commands/define-search-command?tabs=Teams-toolkit%2Cdotnet",children:"Search command"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/microsoftteams/platform/messaging-extensions/how-to/search-commands/universal-actions-for-search-based-message-extensions#just-in-time-install",children:"Just-In-Time Install"})}),"\n"]})]})}function l(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(h,{...e})}):h(e)}},92458:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/card-in-compose-2317acd98e4b7dea25e1334274f1f3cc.png"}}]);
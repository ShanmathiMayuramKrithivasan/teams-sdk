"use strict";(self.webpackChunkteams_md=self.webpackChunkteams_md||[]).push([[1411],{26802:(e,n,t)=>{t.d(n,{A:()=>s});var a=t(22147),i=t(62540);function s({language:e,children:n}){return(0,a.zy)().pathname.includes(`/${e}/`)?(0,i.jsx)(i.Fragment,{children:n}):null}},43023:(e,n,t)=>{t.d(n,{R:()=>c,x:()=>d});var a=t(63696);const i={},s=a.createContext(i);function c(e){const n=a.useContext(s);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),a.createElement(s.Provider,{value:n},e.children)}},51733:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/feedback-6cd52f3d98ce1439c8e07122dc448fa2.gif"},84400:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>r,contentTitle:()=>o,default:()=>u,frontMatter:()=>d,metadata:()=>a,toc:()=>l});const a=JSON.parse('{"id":"csharp/in-depth-guides/feedback","title":"Feedback","description":"\x3c!--","source":"@site/docs/main/csharp/in-depth-guides/feedback.mdx","sourceDirName":"csharp/in-depth-guides","slug":"/csharp/in-depth-guides/feedback","permalink":"/teams-sdk/csharp/in-depth-guides/feedback","draft":false,"unlisted":false,"editUrl":"https://github.com/microsoft/teams-sdk/tree/main/teams.md/docs/main/csharp/in-depth-guides/feedback.mdx","tags":[],"version":"current","sidebarPosition":7,"frontMatter":{"sidebar_position":7,"title":"Feedback","sidebar_label":"Feedback","summary":"Guide to implementing user feedback functionality in Teams applications, covering feedback UI components, event handling, and storage mechanisms for gathering and managing user responses to improve application performance."},"sidebar":"default","previous":{"title":"Functions","permalink":"/teams-sdk/csharp/in-depth-guides/tabs/functions/"},"next":{"title":"Observability","permalink":"/teams-sdk/csharp/in-depth-guides/observability/"}}');var i=t(62540),s=t(43023),c=t(26802);const d={sidebar_position:7,title:"Feedback",sidebar_label:"Feedback",summary:"Guide to implementing user feedback functionality in Teams applications, covering feedback UI components, event handling, and storage mechanisms for gathering and managing user responses to improve application performance."},o="Feedback",r={},l=[{value:"Storage",id:"storage",level:2},{value:"Including Feedback Buttons",id:"including-feedback-buttons",level:2},{value:"Handling the feedback",id:"handling-the-feedback",level:2}];function g(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",img:"img",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"feedback",children:"Feedback"})}),"\n",(0,i.jsx)(n.p,{children:"User feedback is essential for the improvement of any application. Teams provides specialized UI components to help facilitate the gathering of feedback from users."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Animated image showing user selecting the thumbs-up button on an agent response and a dialog opening asking &#39;What did you like?&#39;. The user types &#39;Nice&#39; and hits Submit.",src:t(51733).A+"",width:"1638",height:"1224"})}),"\n",(0,i.jsx)(n.h2,{id:"storage",children:"Storage"}),"\n",(0,i.jsx)(n.p,{children:"Once you receive a feedback event, you can choose to store it in some persistent storage. In the example below, we are storing it in an in-memory store."}),"\n",(0,i.jsx)(c.A,{language:"csharp",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:"// This store would ideally be persisted in a database\npublic static class FeedbackStore\n{\n    public static readonly Dictionary<string, FeedbackData> StoredFeedbackByMessageId = new();\n\n    public class FeedbackData\n    {\n        public string IncomingMessage { get; set; } = string.Empty;\n        public string OutgoingMessage { get; set; } = string.Empty;\n        public int Likes { get; set; }\n        public int Dislikes { get; set; }\n        public List<string> Feedbacks { get; set; } = new();\n    }\n}\n"})})}),"\n",(0,i.jsx)(n.h2,{id:"including-feedback-buttons",children:"Including Feedback Buttons"}),"\n",(0,i.jsx)(n.p,{children:"When sending a message that you want feedback in, simply add feedback functionality to the message you are sending."}),"\n",(0,i.jsx)(c.A,{language:"csharp",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:'var sentMessageId = await context.Send(\n    result.Content != null\n        ? new MessageActivity(result.Content)\n            .AddAiGenerated()\n            /** Add feedback buttons via this method */\n            .AddFeedback()\n        : "I did not generate a response."\n);\n\nFeedbackStore.StoredFeedbackByMessageId[sentMessageId.Id] = new FeedbackStore.FeedbackData\n{\n    IncomingMessage = context.Activity.Text,\n    OutgoingMessage = result.Content ?? string.Empty,\n    Likes = 0,\n    Dislikes = 0,\n    Feedbacks = new List<string>()\n};\n'})})}),"\n",(0,i.jsx)(n.h2,{id:"handling-the-feedback",children:"Handling the feedback"}),"\n",(0,i.jsx)(n.p,{children:"Once the user decides to like/dislike the message, you can handle the feedback in a received event. Once received, you can choose to include it in your persistent store."}),"\n",(0,i.jsx)(c.A,{language:"csharp",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:'[Microsoft.Teams.Apps.Activities.Invokes.Message.Feedback]\npublic Task OnFeedbackReceived([Context] Microsoft.Teams.Api.Activities.Invokes.Messages.SubmitActionActivity activity)\n{\n    var reaction = activity.Value?.ActionValue?.GetType().GetProperty("reaction")?.GetValue(activity.Value?.ActionValue)?.ToString();\n    var feedbackJson = activity.Value?.ActionValue?.GetType().GetProperty("feedback")?.GetValue(activity.Value?.ActionValue)?.ToString();\n\n    if (activity.ReplyToId == null)\n    {\n        _log.LogWarning("No replyToId found for messageId {ActivityId}", activity.Id);\n        return Task.CompletedTask;\n    }\n\n    var existingFeedback = FeedbackStore.StoredFeedbackByMessageId.GetValueOrDefault(activity.ReplyToId);\n    /**\n        * feedbackJson looks like:\n        * {"feedbackText":"Nice!"}\n        */\n    if (existingFeedback == null)\n    {\n        _log.LogWarning("No feedback found for messageId {ActivityId}", activity.Id);\n    }\n    else\n    {\n        var updatedFeedback = new FeedbackStore.FeedbackData\n        {\n            IncomingMessage = existingFeedback.IncomingMessage,\n            OutgoingMessage = existingFeedback.OutgoingMessage,\n            Likes = existingFeedback.Likes + (reaction == "like" ? 1 : 0),\n            Dislikes = existingFeedback.Dislikes + (reaction == "dislike" ? 1 : 0),\n            Feedbacks = existingFeedback.Feedbacks.Concat(new[] { feedbackJson ?? string.Empty }).ToList()\n        };\n\n        FeedbackStore.StoredFeedbackByMessageId[activity.Id] = updatedFeedback;\n    }\n\n    return Task.CompletedTask;\n}\n'})})})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(g,{...e})}):g(e)}}}]);
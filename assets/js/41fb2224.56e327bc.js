"use strict";(self.webpackChunkteams_md=self.webpackChunkteams_md||[]).push([[1724],{26802:(e,t,n)=>{n.d(t,{A:()=>s});var i=n(22147),a=n(62540);function s({language:e,children:t}){return(0,i.zy)().pathname.includes(`/${e}/`)?(0,a.jsx)(a.Fragment,{children:t}):null}},40760:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>d,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"typescript/in-depth-guides/dialogs/creating-dialogs","title":"Creating Dialogs","description":"\x3c!--","source":"@site/docs/main/typescript/in-depth-guides/dialogs/creating-dialogs.mdx","sourceDirName":"typescript/in-depth-guides/dialogs","slug":"/typescript/in-depth-guides/dialogs/creating-dialogs","permalink":"/teams-sdk/typescript/in-depth-guides/dialogs/creating-dialogs","draft":false,"unlisted":false,"editUrl":"https://github.com/microsoft/teams-sdk/tree/main/teams.md/docs/main/typescript/in-depth-guides/dialogs/creating-dialogs.mdx","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"sidebar_label":"Creating Dialogs","title":"Creating Dialogs"},"sidebar":"default","previous":{"title":"Dialogs","permalink":"/teams-sdk/typescript/in-depth-guides/dialogs/"},"next":{"title":"Handling Dialog Submissions","permalink":"/teams-sdk/typescript/in-depth-guides/dialogs/handling-dialog-submissions"}}');var a=n(62540),s=n(43023),r=n(26802);const o={sidebar_position:1,sidebar_label:"Creating Dialogs",title:"Creating Dialogs"},d="Creating Dialogs",l={},c=[{value:"Entry Point",id:"entry-point",level:2},{value:"Handling Dialog Open Events",id:"handling-dialog-open-events",level:2},{value:"Rendering A Card",id:"rendering-a-card",level:3},{value:"Rendering A Webpage",id:"rendering-a-webpage",level:3},{value:"Setting up Embedded Web Content",id:"setting-up-embedded-web-content",level:3}];function p(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.header,{children:(0,a.jsx)(t.h1,{id:"creating-dialogs",children:"Creating Dialogs"})}),"\n",(0,a.jsx)(t.admonition,{type:"tip",children:(0,a.jsxs)(t.p,{children:["If you're not familiar with how to build Adaptive Cards, check out ",(0,a.jsx)(t.a,{href:"../adaptive-cards",children:"the cards guide"}),". Understanding their basics is a prerequisite for this guide."]})}),"\n",(0,a.jsx)(t.h2,{id:"entry-point",children:"Entry Point"}),"\n",(0,a.jsx)(r.A,{language:"typescript",children:(0,a.jsx)(t.p,{children:"To open a dialog, you need to supply a special type of action as to the Adaptive Card. Once this button is clicked, the dialog will open and ask the application what to show."})}),"\n",(0,a.jsx)(r.A,{language:"typescript",children:(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-typescript",children:"import { cardAttachment, MessageActivity } from '@microsoft/teams.api';\nimport { App } from '@microsoft/teams.apps';\nimport {\n  AdaptiveCard,\n  IAdaptiveCard,\n  TaskFetchAction,\n  TaskFetchData,\n} from '@microsoft/teams.cards';\n// ...\n\napp.on('message', async ({ send }) => {\n  await send({ type: 'typing' });\n\n  // Create the launcher adaptive card\n  const card: IAdaptiveCard = new AdaptiveCard({\n    type: 'TextBlock',\n    text: 'Select the examples you want to see!',\n    size: 'Large',\n    weight: 'Bolder',\n  }).withActions(\n    // raw action\n    {\n      type: 'Action.Submit',\n      title: 'Simple form test',\n      data: {\n        msteams: {\n          type: 'task/fetch',\n        },\n        opendialogtype: 'simple_form',\n      },\n    },\n    // Special type of action to open a dialog\n    new TaskFetchAction({})\n      .withTitle('Webpage Dialog')\n      // This data will be passed back in an event so we can\n      // handle what to show in the dialog\n      .withValue(new TaskFetchData({ opendialogtype: 'webpage_dialog' })),\n    new TaskFetchAction({})\n      .withTitle('Multi-step Form')\n      .withValue(new TaskFetchData({ opendialogtype: 'multi_step_form' })),\n    new TaskFetchAction({})\n      .withTitle('Mixed Example')\n      .withValue(new TaskFetchData({ opendialogtype: 'mixed_example' }))\n  );\n\n  // Send the card as an attachment\n  await send(new MessageActivity('Enter this form').addCard('adaptive', card));\n});\n"})})}),"\n",(0,a.jsx)(t.h2,{id:"handling-dialog-open-events",children:"Handling Dialog Open Events"}),"\n",(0,a.jsx)(r.A,{language:"typescript",children:(0,a.jsx)(t.p,{children:"Once an action is executed to open a dialog, the Teams client will send an event to the agent to request what the content of the dialog should be. Here is how to handle this event:"})}),"\n",(0,a.jsx)(r.A,{language:"typescript",children:(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-typescript",children:"import { cardAttachment } from '@microsoft/teams.api';\nimport { App } from '@microsoft/teams.apps';\nimport { AdaptiveCard, IAdaptiveCard } from '@microsoft/teams.cards';\n// ...\n\napp.on('dialog.open', async ({ activity }) => {\n  const card: IAdaptiveCard = new AdaptiveCard()...\n\n  // Return an object with the task value that renders a card\n  return {\n    task: {\n      type: 'continue',\n      value: {\n        title: 'Title of Dialog',\n        card: cardAttachment('adaptive', card),\n      },\n    },\n  };\n}\n"})})}),"\n",(0,a.jsx)(t.h3,{id:"rendering-a-card",children:"Rendering A Card"}),"\n",(0,a.jsx)(t.p,{children:"You can render an Adaptive Card in a dialog by returning a card response."}),"\n",(0,a.jsx)(r.A,{language:"typescript",children:(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-typescript",children:"import { cardAttachment } from '@microsoft/teams.api';\nimport { AdaptiveCard, TextInput, SubmitAction } from '@microsoft/teams.cards';\n// ...\n\nif (dialogType === 'simple_form') {\n  const dialogCard = new AdaptiveCard(\n    {\n      type: 'TextBlock',\n      text: 'This is a simple form',\n      size: 'Large',\n      weight: 'Bolder',\n    },\n    new TextInput()\n      .withLabel('Name')\n      .withIsRequired()\n      .withId('name')\n      .withPlaceholder('Enter your name')\n  )\n    // Inside the dialog, the card actions for submitting the card must be\n    // of type Action.Submit\n    .withActions(\n      new SubmitAction().withTitle('Submit').withData({ submissiondialogtype: 'simple_form' })\n    );\n\n  // Return an object with the task value that renders a card\n  return {\n    task: {\n      type: 'continue',\n      value: {\n        title: 'Simple Form Dialog',\n        card: cardAttachment('adaptive', dialogCard),\n      },\n    },\n  };\n}\n"})})}),"\n",(0,a.jsx)(t.admonition,{type:"info",children:(0,a.jsxs)(t.p,{children:["The action type for submitting a dialog must be ",(0,a.jsx)(t.code,{children:"Action.Submit"}),". This is a requirement of the Teams client. If you use a different action type, the dialog will not be submitted and the agent will not receive the submission event."]})}),"\n",(0,a.jsx)(t.h3,{id:"rendering-a-webpage",children:"Rendering A Webpage"}),"\n",(0,a.jsx)(t.p,{children:"You can render a webpage in a dialog as well. There are some security requirements to be aware of:"}),"\n",(0,a.jsxs)(t.ol,{children:["\n",(0,a.jsxs)(t.li,{children:["The webpage must be hosted on a domain that is allow-listed as ",(0,a.jsx)(t.code,{children:"validDomains"})," in the Teams app ",(0,a.jsx)(t.a,{href:"/teams/manifest",children:"manifest"})," for the agent"]}),"\n",(0,a.jsxs)(t.li,{children:["The webpage must also host the ",(0,a.jsx)(t.a,{href:"https://www.npmjs.com/package/@microsoft/teams-js",children:"teams-js client library"}),". The reason for this is that for security purposes, the Teams client will not render arbitrary webpages. As such, the webpage must explicitly opt-in to being rendered in the Teams client. Setting up the teams-js client library handles this for you."]}),"\n"]}),"\n",(0,a.jsx)(r.A,{language:"typescript",children:(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-typescript",children:"import { App } from '@microsoft/teams.apps';\n// ...\n\nreturn {\n  task: {\n    type: 'continue',\n    value: {\n      title: 'Webpage Dialog',\n      // Here we are using a webpage that is hosted in the same\n      // server as the agent. This server needs to be publicly accessible,\n      // needs to set up teams.js client library (https://www.npmjs.com/package/@microsoft/teams-js)\n      // and needs to be registered in the manifest.\n      url: `${process.env['BOT_ENDPOINT']}/tabs/dialog-form`,\n      width: 1000,\n      height: 800,\n    },\n  },\n};\n"})})}),"\n",(0,a.jsxs)(r.A,{language:"typescript",children:[(0,a.jsx)(t.h3,{id:"setting-up-embedded-web-content",children:"Setting up Embedded Web Content"}),(0,a.jsxs)(t.p,{children:["To serve web content for dialogs, you can use the ",(0,a.jsx)(t.code,{children:"tab"})," method to host static webpages:"]}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-typescript",children:"import path from 'path';\n\n// In your app setup (e.g., index.ts)\n// Hosts a static webpage at /tabs/dialog-form\napp.tab('dialog-form', path.join(__dirname, 'views', 'customform'));\n"})})]})]})}function h(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(p,{...e})}):p(e)}},43023:(e,t,n)=>{n.d(t,{R:()=>r,x:()=>o});var i=n(63696);const a={},s=i.createContext(a);function r(e){const t=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),i.createElement(s.Provider,{value:t},e.children)}}}]);
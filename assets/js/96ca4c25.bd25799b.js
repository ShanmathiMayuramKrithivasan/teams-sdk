"use strict";(self.webpackChunkteams_md=self.webpackChunkteams_md||[]).push([[2670],{26802:(e,t,n)=>{n.d(t,{A:()=>a});var s=n(22147),i=n(62540);function a({language:e,children:t}){return(0,s.zy)().pathname.includes(`/${e}/`)?(0,i.jsx)(i.Fragment,{children:t}):null}},43023:(e,t,n)=>{n.d(t,{R:()=>r,x:()=>c});var s=n(63696);const i={},a=s.createContext(i);function r(e){const t=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),s.createElement(a.Provider,{value:t},e.children)}},82521:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>o,default:()=>p,frontMatter:()=>c,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"python/essentials/on-activity/index","title":"Listening to Activities","description":"\x3c!--","source":"@site/docs/main/python/essentials/on-activity/index.mdx","sourceDirName":"python/essentials/on-activity","slug":"/python/essentials/on-activity/","permalink":"/teams-sdk/python/essentials/on-activity/","draft":false,"unlisted":false,"editUrl":"https://github.com/microsoft/teams-sdk/tree/main/teams.md/docs/main/python/essentials/on-activity/index.mdx","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"summary":"Guide to handling Teams-specific activities like chat messages, card actions, and installs using the fluent router API.","title":"Listening to Activities"},"sidebar":"default","previous":{"title":"Listening to Events","permalink":"/teams-sdk/python/essentials/on-event"},"next":{"title":"App Authentication","permalink":"/teams-sdk/python/essentials/app-authentication"}}');var i=n(62540),a=n(43023),r=n(26802);const c={sidebar_position:1,summary:"Guide to handling Teams-specific activities like chat messages, card actions, and installs using the fluent router API.",title:"Listening to Activities"},o="Listening To Activities",d={},l=[{value:"Middleware pattern",id:"middleware-pattern",level:2}];function h(e){const t={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"listening-to-activities",children:"Listening To Activities"})}),"\n",(0,i.jsxs)(t.p,{children:["An ",(0,i.jsx)(t.strong,{children:"Activity"})," is the Teams\u2011specific payload that flows between the user and your bot.\nWhere ",(0,i.jsx)(t.em,{children:"events"})," describe high\u2011level happenings inside your app, ",(0,i.jsx)(t.em,{children:"activities"})," are the raw Teams messages such as chat text, card actions, installs, or invoke calls."]}),"\n",(0,i.jsx)(r.A,{language:"python",children:(0,i.jsxs)(t.p,{children:["The Teams SDK exposes a fluent router so you can subscribe to these activities with ",(0,i.jsx)(t.code,{children:'@app.event("activity")'}),"."]})}),"\n",(0,i.jsx)(t.mermaid,{value:'flowchart LR\n    Teams["Teams"]:::less-interesting\n    Server["App Server"]:::interesting\n    ActivityRouter["Activity Router (app.on())"]:::interesting\n    Handlers["Your Activity Handlers"]:::interesting\n\n    Teams --\x3e |Events| Server\n    Server --\x3e |Activity Event| ActivityRouter\n    ActivityRouter --\x3e |handler invoked| Handlers\n\n    classDef interesting fill:#b1650f,stroke:#333,stroke-width:4px;\n    classDef less-interesting fill:#666,stroke:#333,stroke-width:4px;'}),"\n",(0,i.jsx)(t.p,{children:"Here is an example of a basic message handler:"}),"\n",(0,i.jsx)(r.A,{language:"python",children:(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-python",children:"@app.on_message\nasync def handle_message(ctx: ActivityContext[MessageActivity]):\n    await ctx.send(f\"You said '{ctx.activity.text}'\")\n"})})}),"\n",(0,i.jsx)(r.A,{language:"python",children:(0,i.jsxs)(t.p,{children:["In the above example, the ",(0,i.jsx)(t.code,{children:"ctx.activity"})," parameter is of type ",(0,i.jsx)(t.code,{children:"MessageActivity"}),", which has a ",(0,i.jsx)(t.code,{children:"text"})," property. You'll notice that the handler here does not return anything, but instead handles it by ",(0,i.jsx)(t.code,{children:"send"}),"ing a message back. For message activities, Teams does not expect your application to return anything (though it's usually a good idea to send some sort of friendly acknowledgment!)."]})}),"\n",(0,i.jsx)(t.h2,{id:"middleware-pattern",children:"Middleware pattern"}),"\n",(0,i.jsx)(r.A,{language:"python",children:(0,i.jsxs)(t.p,{children:["The ",(0,i.jsx)(t.code,{children:"event"})," activity handlers (and attributes) follow a ",(0,i.jsx)(t.a,{href:"https://www.patterns.dev/vanilla/mediator-pattern/",children:"middleware"})," pattern similar to how ",(0,i.jsx)(t.code,{children:"python"})," middlewares work. This means that for each activity handler, a ",(0,i.jsx)(t.code,{children:"next"})," function is passed in which can be called to pass control to the next handler. This allows you to build a chain of handlers that can process the same activity in different ways."]})}),"\n",(0,i.jsxs)(r.A,{language:"python",children:[(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-python",children:'@app.on_message\nasync def handle_message(ctx: ActivityContext[MessageActivity]):\n    """Handle message activities using the new generated handler system."""\n    print(f"[GENERATED onMessage] Message received: {ctx.activity.text}")\n    await ctx.next()\n'})}),(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-python",children:'@app.on_message\nasync def handle_message(ctx: ActivityContext[MessageActivity]):\n    """Handle message activities using the new generated handler system."""\n    if ctx.activity.text == "/help":\n        await ctx.send("Here are all the ways I can help you...")\n    await ctx.next()\n'})}),(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-python",children:"@app.on_message\nasync def handle_message(ctx: ActivityContext[MessageActivity]):\n    await ctx.send(f\"You said '{ctx.activity.text}'\")\n"})})]}),"\n",(0,i.jsx)(t.admonition,{type:"info",children:(0,i.jsxs)(t.p,{children:["Just like other middlewares, if you stop the chain by not calling ",(0,i.jsx)(t.code,{children:"next()"}),", the activity will not be passed to the next handler. The order of registration for the handlers also matters as that determines how the handlers will be called."]})})]})}function p(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}}}]);
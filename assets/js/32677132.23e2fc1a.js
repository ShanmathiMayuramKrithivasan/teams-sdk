"use strict";(self.webpackChunkteams_md=self.webpackChunkteams_md||[]).push([[8378],{26802:(e,n,s)=>{s.d(n,{A:()=>o});var t=s(22147),a=s(62540);function o({language:e,children:n}){return(0,t.zy)().pathname.includes(`/${e}/`)?(0,a.jsx)(a.Fragment,{children:n}):null}},33169:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/compose-area-1c7340e445681d29b0c675f72985a10e.png"},40462:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/message-3851dc816fb377942fa9d1ee49ef8e41.png"},43023:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>r});var t=s(63696);const a={},o=t.createContext(a);function i(e){const n=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),t.createElement(o.Provider,{value:n},e.children)}},55429:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/fetch-conversation-members-5072bed90a03c529a5378f8e2b9946a4.png"},68738:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>r,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"csharp/in-depth-guides/message-extensions/action-commands","title":"Action Commands","description":"\x3c!--","source":"@site/docs/main/csharp/in-depth-guides/message-extensions/action-commands.mdx","sourceDirName":"csharp/in-depth-guides/message-extensions","slug":"/csharp/in-depth-guides/message-extensions/action-commands","permalink":"/teams-sdk/csharp/in-depth-guides/message-extensions/action-commands","draft":false,"unlisted":false,"editUrl":"https://github.com/microsoft/teams-sdk/tree/main/teams.md/docs/main/csharp/in-depth-guides/message-extensions/action-commands.mdx","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"sidebar_label":"Action Commands","title":"Action Commands","summary":"Learn how to create action commands for message extensions that present modal dialogs to collect or display information in Teams."},"sidebar":"default","previous":{"title":"Message Extensions","permalink":"/teams-sdk/csharp/in-depth-guides/message-extensions/"},"next":{"title":"Search Commands","permalink":"/teams-sdk/csharp/in-depth-guides/message-extensions/search-commands"}}');var a=s(62540),o=s(43023),i=s(26802);const r={sidebar_position:1,sidebar_label:"Action Commands",title:"Action Commands",summary:"Learn how to create action commands for message extensions that present modal dialogs to collect or display information in Teams."},c="Action commands",d={},l=[{value:"Action command invocation locations",id:"action-command-invocation-locations",level:2},{value:"Compose Area and Box",id:"compose-area-and-box",level:3},{value:"Message action command",id:"message-action-command",level:3},{value:"Setting up your Teams app manifest",id:"setting-up-your-teams-app-manifest",level:2},{value:"Handle submission",id:"handle-submission",level:2},{value:"Create card",id:"create-card",level:3},{value:"Create message details card",id:"create-message-details-card",level:3},{value:"Handle opening adaptive card dialog",id:"handle-opening-adaptive-card-dialog",level:2},{value:"Create conversation members card",id:"create-conversation-members-card",level:3},{value:"Resources",id:"resources",level:2}];function m(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"action-commands",children:"Action commands"})}),"\n",(0,a.jsx)(n.p,{children:"Action commands allow you to present your users with a modal pop-up called a dialog in Teams. The dialog collects or displays information, processes the interaction, and sends the information back to Teams compose box."}),"\n",(0,a.jsx)(n.h2,{id:"action-command-invocation-locations",children:"Action command invocation locations"}),"\n",(0,a.jsx)(n.p,{children:"There are three different areas action commands can be invoked from:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"Compose Area"}),"\n",(0,a.jsx)(n.li,{children:"Compose Box"}),"\n",(0,a.jsx)(n.li,{children:"Message"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"compose-area-and-box",children:"Compose Area and Box"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"Screenshot of Teams with outlines around the &#39;Compose Box&#39; (for typing messages) and the &#39;Compose Area&#39; (the menu option next to the compose box that provides a search bar for actions and apps).",src:s(33169).A+"",width:"2762",height:"1464"})}),"\n",(0,a.jsx)(n.h3,{id:"message-action-command",children:"Message action command"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"Screenshot of message extension response in Teams. By selecting the &#39;...&#39; button, a menu has opened with &#39;More actions&#39; option in which they can select from a list of available message extension actions.",src:s(40462).A+"",width:"3020",height:"1546"})}),"\n",(0,a.jsx)(n.admonition,{type:"tip",children:(0,a.jsxs)(n.p,{children:["See the ",(0,a.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/microsoftteams/platform/messaging-extensions/how-to/action-commands/define-action-command?tabs=Teams-toolkit%2Cdotnet#select-action-command-invoke-locations",children:"Invoke Locations"})," guide to learn more about the different entry points for action commands."]})}),"\n",(0,a.jsx)(n.h2,{id:"setting-up-your-teams-app-manifest",children:"Setting up your Teams app manifest"}),"\n",(0,a.jsx)(n.p,{children:"To use action commands you have define them in the Teams app manifest. Here is an example:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'"composeExtensions": [\n    {\n        "botId": "${{BOT_ID}}",\n        "commands": [\n            {\n            "id": "createCard",\n            "type": "action",\n            "context": [\n                "compose",\n                "commandBox"\n            ],\n            "description": "Command to run action to create a card from the compose box.",\n            "title": "Create Card",\n            "parameters": [\n                {\n                    "name": "title",\n                    "title": "Card title",\n                    "description": "Title for the card",\n                    "inputType": "text"\n                },\n                {\n                    "name": "subTitle",\n                    "title": "Subtitle",\n                    "description": "Subtitle for the card",\n                    "inputType": "text"\n                },\n                {\n                    "name": "text",\n                    "title": "Text",\n                    "description": "Text for the card",\n                    "inputType": "textarea"\n                }\n            ]\n            },\n            {\n                "id": "getMessageDetails",\n                "type": "action",\n                "context": [\n                    "message"\n                ],\n                "description": "Command to run action on message context.",\n                "title": "Get Message Details"\n            },\n            {\n                "id": "fetchConversationMembers",\n                "description": "Fetch the conversation members",\n                "title": "Fetch Conversation Members",\n                "type": "action",\n                "fetchTask": true,\n                "context": [\n                    "compose"\n                ]\n            },\n        ]\n    }\n]\n'})}),"\n",(0,a.jsx)(n.p,{children:"Here we have defining three different commands:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"createCard"})," - that can be invoked from either the ",(0,a.jsx)(n.code,{children:"compose"})," or ",(0,a.jsx)(n.code,{children:"commandBox"})," areas. Upon invocation a dialog will popup asking the user to fill the ",(0,a.jsx)(n.code,{children:"title"}),", ",(0,a.jsx)(n.code,{children:"subTitle"}),", and ",(0,a.jsx)(n.code,{children:"text"}),"."]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"Screenshot of a message extension dialog with the editable fields &#39;Card title&#39;, &#39;Subtitle&#39;, and &#39;Text&#39;.",src:s(92015).A+"",width:"3002",height:"1550"})}),"\n",(0,a.jsxs)(n.ol,{start:"2",children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"getMessageDetails"})," - It is invoked from the ",(0,a.jsx)(n.code,{children:"message"})," overflow menu. Upon invocation the message payload will be sent to the app which will then return the details like ",(0,a.jsx)(n.code,{children:"createdDate"}),", etc."]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"Screenshot of the &#39;More actions&#39; message extension menu expanded with &#39;Get Message Details&#39; option selected.",src:s(78022).A+"",width:"3002",height:"1562"})}),"\n",(0,a.jsxs)(n.ol,{start:"3",children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"fetchConversationMembers"})," - It is invoked from the ",(0,a.jsx)(n.code,{children:"compose"})," area. Upon invocation the app will return an adaptive card in the form of a dialog with the conversation roster."]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"Screenshot of the &#39;Fetch Conversation Members&#39; option exposed from the message extension menu &#39;...&#39; option.",src:s(55429).A+"",width:"2998",height:"1548"})}),"\n",(0,a.jsx)(n.h2,{id:"handle-submission",children:"Handle submission"}),"\n",(0,a.jsx)(i.A,{language:"csharp",children:(0,a.jsxs)(n.p,{children:["Handle submission when the ",(0,a.jsx)(n.code,{children:"createCard"})," or ",(0,a.jsx)(n.code,{children:"getMessageDetails"})," actions commands are invoked."]})}),"\n",(0,a.jsx)(i.A,{language:"csharp",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-csharp",children:'using System.Text.Json;\nusing Microsoft.Teams.Api.Activities.Invokes.MessageExtensions;\nusing Microsoft.Teams.Api.MessageExtensions;\nusing Microsoft.Teams.Apps.Annotations;\n\n//...\n\n[MessageExtension.SubmitAction]\npublic Response OnMessageExtensionSubmit(\n    [Context] SubmitActionActivity activity,\n    [Context] IContext.Client client,\n    [Context] ILogger log)\n{\n    log.Info("[MESSAGE_EXT_SUBMIT] Action submit received");\n\n    var commandId = activity.Value?.CommandId;\n    var data = activity.Value?.Data as JsonElement?;\n\n    log.Info($"[MESSAGE_EXT_SUBMIT] Command: {commandId}");\n    log.Info($"[MESSAGE_EXT_SUBMIT] Data: {JsonSerializer.Serialize(data)}");\n\n    switch (commandId)\n    {\n        case "createCard":\n            return HandleCreateCard(data, log);\n\n        case "getMessageDetails":\n            return HandleGetMessageDetails(activity, log);\n\n        default:\n            log.Error($"[MESSAGE_EXT_SUBMIT] Unknown command: {commandId}");\n            return CreateErrorActionResponse("Unknown command");\n    }\n}\n'})})}),"\n",(0,a.jsx)(n.h3,{id:"create-card",children:"Create card"}),"\n",(0,a.jsxs)(i.A,{language:"csharp",children:[(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"HandleCreateCard()"})," method"]}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-csharp",children:'using System.Text.Json;\nusing Microsoft.Teams.Api.MessageExtensions;\nusing Microsoft.Teams.Cards;\nusing Microsoft.Teams.Common;\n\n//...\n\nprivate static Response HandleCreateCard(JsonElement? data, ILogger log)\n{\n    var title = GetJsonValue(data, "title") ?? "Default Title";\n    var description = GetJsonValue(data, "description") ?? "Default Description";\n\n    log.Info($"[CREATE_CARD] Title: {title}, Description: {description}");\n\n    var card = new AdaptiveCard\n    {\n        Schema = "http://adaptivecards.io/schemas/adaptive-card.json",\n        Body = new List<CardElement>\n        {\n            new TextBlock("Custom Card Created")\n            {\n                Weight = TextWeight.Bolder,\n                Size = TextSize.Large,\n                Color = TextColor.Good\n            },\n            new TextBlock(title)\n            {\n                Weight = TextWeight.Bolder,\n                Size = TextSize.Medium\n            },\n            new TextBlock(description)\n            {\n                Wrap = true,\n                IsSubtle = true\n            }\n        }\n    };\n\n    var attachment = new Microsoft.Teams.Api.MessageExtensions.Attachment\n    {\n        ContentType = ContentType.AdaptiveCard,\n        Content = card\n    };\n\n    return new Response\n    {\n        ComposeExtension = new Result\n        {\n            Type = ResultType.Result,\n            AttachmentLayout = Layout.List,\n            Attachments = new List<Microsoft.Teams.Api.MessageExtensions.Attachment> { attachment }\n        }\n    };\n}\n'})})]}),"\n",(0,a.jsx)(n.h3,{id:"create-message-details-card",children:"Create message details card"}),"\n",(0,a.jsxs)(i.A,{language:"csharp",children:[(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"HandleGetMessageDetails()"})," method"]}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-csharp",children:'using Microsoft.Teams.Api;\nusing Microsoft.Teams.Api.Activities.Invokes.MessageExtensions;\nusing Microsoft.Teams.Api.MessageExtensions;\nusing Microsoft.Teams.Cards;\n\n//...\n\nprivate static Response HandleGetMessageDetails(SubmitActionActivity activity, ILogger log)\n{\n    var messageText = activity.Value?.MessagePayload?.Body?.Content ?? "No message content";\n    var messageId = activity.Value?.MessagePayload?.Id ?? "Unknown";\n\n    log.Info($"[GET_MESSAGE_DETAILS] Message ID: {messageId}");\n\n    var card = new AdaptiveCard\n    {\n        Schema = "http://adaptivecards.io/schemas/adaptive-card.json",\n        Body = new List<CardElement>\n        {\n            new TextBlock("Message Details")\n            {\n                Weight = TextWeight.Bolder,\n                Size = TextSize.Large,\n                Color = TextColor.Accent\n            },\n            new TextBlock($"Message ID: {messageId}")\n            {\n                Wrap = true\n            },\n            new TextBlock($"Content: {messageText}")\n            {\n                Wrap = true\n            }\n        }\n    };\n\n    var attachment = new Microsoft.Teams.Api.MessageExtensions.Attachment\n    {\n        ContentType = new ContentType("application/vnd.microsoft.card.adaptive"),\n        Content = card\n    };\n\n    return new Response\n    {\n        ComposeExtension = new Result\n        {\n            Type = ResultType.Result,\n            AttachmentLayout = Layout.List,\n            Attachments = new List<Microsoft.Teams.Api.MessageExtensions.Attachment> { attachment }\n        }\n    };\n}\n'})})]}),"\n",(0,a.jsx)(n.h2,{id:"handle-opening-adaptive-card-dialog",children:"Handle opening adaptive card dialog"}),"\n",(0,a.jsx)(i.A,{language:"csharp",children:(0,a.jsxs)(n.p,{children:["Handle opening adaptive card dialog when the ",(0,a.jsx)(n.code,{children:"fetchConversationMembers"})," command is invoked."]})}),"\n",(0,a.jsx)(i.A,{language:"csharp",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-csharp",children:'using Microsoft.Teams.Api.Activities.Invokes.MessageExtensions;\nusing Microsoft.Teams.Api.MessageExtensions;\nusing Microsoft.Teams.Apps.Annotations;\n\n//...\n\n[MessageExtension.FetchTask]\npublic async Task<ActionResponse> OnMessageExtensionFetchTask(\n    [Context] FetchTaskActivity activity,\n    [Context] ILogger log)\n{\n    log.Info("[MESSAGE_EXT_FETCH_TASK] Fetch task received");\n\n    var commandId = activity.Value?.CommandId;\n    log.Info($"[MESSAGE_EXT_FETCH_TASK] Command: {commandId}");\n\n    return CreateFetchTaskResponse(commandId, log);\n}\n'})})}),"\n",(0,a.jsx)(n.h3,{id:"create-conversation-members-card",children:"Create conversation members card"}),"\n",(0,a.jsxs)(i.A,{language:"csharp",children:[(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"CreateFetchTaskResponse()"})," method"]}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-csharp",children:'using Microsoft.Teams.Api;\nusing Microsoft.Teams.Api.MessageExtensions;\nusing Microsoft.Teams.Api.TaskModules;\nusing Microsoft.Teams.Cards;\nusing Microsoft.Teams.Common;\n\n//...\n\nprivate static ActionResponse CreateFetchTaskResponse(string? commandId, ILogger log)\n{\n    log.Info($"[CREATE_FETCH_TASK] Creating task for command: {commandId}");\n\n    // Create an adaptive card for the task module\n    var card = new AdaptiveCard\n    {\n        Body = new List<CardElement>\n        {\n            new TextBlock("Conversation Members is not implemented in C# yet :(")\n            {\n                Weight = TextWeight.Bolder,\n                Color = TextColor.Accent\n            },\n        }\n    };\n\n    return new ActionResponse\n    {\n        Task = new ContinueTask(new TaskInfo\n        {\n            Title = "Fetch Task Dialog",\n            Height = new Union<int, Size>(Size.Small),\n            Width = new Union<int, Size>(Size.Small),\n            Card = new Microsoft.Teams.Api.Attachment(card)\n        })\n    };\n}\n\n// Helper method to extract JSON values\nprivate static string? GetJsonValue(JsonElement? data, string key)\n{\n    if (data?.ValueKind == JsonValueKind.Object && data.Value.TryGetProperty(key, out var value))\n    {\n        return value.GetString();\n    }\n    return null;\n}\n\n// Helper method to create error responses\nprivate static Response CreateErrorActionResponse(string message)\n{\n    return new Response\n    {\n        ComposeExtension = new Result\n        {\n            Type = ResultType.Message,\n            Text = message\n        }\n    };\n}\n'})})]}),"\n",(0,a.jsx)(n.h2,{id:"resources",children:"Resources"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/microsoftteams/platform/messaging-extensions/how-to/action-commands/define-action-command?tabs=Teams-toolkit%2Cdotnet",children:"Action commands"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/microsoftteams/platform/messaging-extensions/how-to/action-commands/respond-to-task-module-submit?tabs=dotnet%2Cdotnet-1#bot-response-with-adaptive-card",children:"Returning Adaptive Card Previews in Task Modules"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(m,{...e})}):m(e)}},78022:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/message-command-24514540c1a0a417b3bcfc517f7ddd3e.png"},92015:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/parameters-12c01d0339a357d6dbab4090c805aff4.png"}}]);
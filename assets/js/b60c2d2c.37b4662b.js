"use strict";(self.webpackChunkteams_md=self.webpackChunkteams_md||[]).push([[1007],{26802:(e,t,n)=>{n.d(t,{A:()=>a});var s=n(22147),i=n(62540);function a({language:e,children:t}){return(0,s.zy)().pathname.includes(`/${e}/`)?(0,i.jsx)(i.Fragment,{children:t}):null}},43023:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>r});var s=n(63696);const i={},a=s.createContext(i);function o(e){const t=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(a.Provider,{value:t},e.children)}},96807:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>c,default:()=>g,frontMatter:()=>r,metadata:()=>s,toc:()=>h});const s=JSON.parse('{"id":"python/essentials/sending-messages/proactive-messaging","title":"Proactive Messaging","description":"\x3c!--","source":"@site/docs/main/python/essentials/sending-messages/proactive-messaging.mdx","sourceDirName":"python/essentials/sending-messages","slug":"/python/essentials/sending-messages/proactive-messaging","permalink":"/teams-sdk/python/essentials/sending-messages/proactive-messaging","draft":false,"unlisted":false,"editUrl":"https://github.com/microsoft/teams-sdk/tree/main/teams.md/docs/main/python/essentials/sending-messages/proactive-messaging.mdx","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"sidebar_label":"Proactive Messaging","title":"Proactive Messaging","summary":"Learn how to send proactive messages to users without waiting for them to initiate the conversation, including storing conversation IDs and sending notifications."},"sidebar":"default","previous":{"title":"Sending Messages","permalink":"/teams-sdk/python/essentials/sending-messages/"},"next":{"title":"API Client","permalink":"/teams-sdk/python/essentials/api"}}');var i=n(62540),a=n(43023),o=n(26802);const r={sidebar_position:1,sidebar_label:"Proactive Messaging",title:"Proactive Messaging",summary:"Learn how to send proactive messages to users without waiting for them to initiate the conversation, including storing conversation IDs and sending notifications."},c="Proactive Messaging",d={},h=[{value:"Targeted Proactive Messages",id:"targeted-proactive-messages",level:2}];function l(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"proactive-messaging",children:"Proactive Messaging"})}),"\n",(0,i.jsxs)(t.p,{children:["In ",(0,i.jsx)(t.a,{href:"./",children:"Sending Messages"}),", you were shown how to respond to an event when it happens. However, there are times when you want to send a message to the user without them sending a message first. This is called proactive messaging. You can do this by using the ",(0,i.jsx)(t.code,{children:"send"})," method in the ",(0,i.jsx)(t.code,{children:"app"})," instance. This approach is useful for sending notifications or reminders to the user."]}),"\n",(0,i.jsxs)(t.p,{children:["The main thing to note is that you need to have the ",(0,i.jsx)(o.A,{language:"python",children:(0,i.jsx)(t.code,{children:"conversation_id"})})," of the chat or channel that you want to send the message to. It's a good idea to store this value somewhere from an activity handler so that you can use it for proactive messaging later."]}),"\n",(0,i.jsx)(o.A,{language:"python",children:(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-python",children:'from microsoft_teams.api import InstalledActivity, MessageActivityInput\nfrom microsoft_teams.apps import ActivityContext\n# ...\n\n# This would be some persistent storage\nstorage = dict[str, str]()\n\n# Installation is just one place to get the conversation_id. All activities have this field as well.\n@app.on_install_add\nasync def handle_install_add(ctx: ActivityContext[InstalledActivity]):\n    # Save the conversation_id\n    storage[ctx.activity.from_.aad_object_id] = ctx.activity.conversation.id\n    await ctx.send("Hi! I am going to remind you to say something to me soon!")\n    # This queues up the proactive notifaction to be sent in 1 minute\n    notication_queue.add_reminder(ctx.activity.from_.aad_object_id, send_proactive_notification, 60000)\n'})})}),"\n",(0,i.jsxs)(t.p,{children:["Then, when you want to send a proactive message, you can retrieve the ",(0,i.jsx)(o.A,{language:"python",children:(0,i.jsx)(t.code,{children:"conversation_id"})})," from storage and use it to send the message."]}),"\n",(0,i.jsx)(o.A,{language:"python",children:(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-python",children:'from microsoft_teams.api import MessageActivityInput\n# ...\n\nasync def send_proactive_notification(user_id: str):\n    conversation_id = storage.get(user_id, "")\n    if not conversation_id:\n        return\n    activity = MessageActivityInput(text="Hey! It\'s been a while. How are you?")\n    await app.send(conversation_id, activity)\n'})})}),"\n",(0,i.jsx)(t.admonition,{type:"tip",children:(0,i.jsxs)(t.p,{children:["In this example, you see how to get the ",(0,i.jsx)(o.A,{language:"python",children:(0,i.jsx)(t.code,{children:"conversation_id"})})," using one of the activity handlers. This is a good place to store the conversation id, but you can also do this in other places like when the user installs the app or when they sign in. The important thing is that you have the conversation id stored somewhere so you can use it later."]})}),"\n",(0,i.jsx)(t.h2,{id:"targeted-proactive-messages",children:"Targeted Proactive Messages"}),"\n",(0,i.jsx)(t.admonition,{title:"Preview Feature",type:"info",children:(0,i.jsx)(t.p,{children:"Targeted proactive messages are currently in preview."})}),"\n",(0,i.jsxs)(t.p,{children:["You can also send ",(0,i.jsx)(t.a,{href:"./#targeted-messages",children:"targeted messages"})," proactively to deliver private messages to a specific user in a conversation."]}),"\n",(0,i.jsx)(t.admonition,{title:"Requirements",type:"info",children:(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Recipient property must be set on the activity when using targeted messages"}),"\n"]})}),"\n",(0,i.jsx)(o.A,{language:"python",children:(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-python",children:'from microsoft_teams.api import MessageActivityInput, Account\n# ...\n\nasync def send_targeted_proactive_notification(user_id: str, recipient_id: str):\n    conversation_id = storage.get(user_id, "")\n    if not conversation_id:\n        return\n    \n    activity = MessageActivityInput(text="This is a private reminder just for you!")\n    activity.recipient = Account(id=recipient_id, role="user")\n    \n    await app.send(conversation_id, activity, is_targeted=True)\n'})})})]})}function g(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}}}]);
"use strict";(self.webpackChunkteams_md=self.webpackChunkteams_md||[]).push([[6235],{22491:(e,n,t)=>{t.d(n,{A:()=>s});t(63696);var r=t(11750);const i={tabItem:"tabItem_wHwb"};var a=t(62540);function s({children:e,hidden:n,className:t}){return(0,a.jsx)("div",{role:"tabpanel",className:(0,r.A)(i.tabItem,t),hidden:n,children:e})}},26802:(e,n,t)=>{t.d(n,{A:()=>a});var r=t(22147),i=t(62540);function a({language:e,children:n}){return(0,r.zy)().pathname.includes(`/${e}/`)?(0,i.jsx)(i.Fragment,{children:n}):null}},43023:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>o});var r=t(63696);const i={},a=r.createContext(i);function s(e){const n=r.useContext(a);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),r.createElement(a.Provider,{value:n},e.children)}},58510:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>u,contentTitle:()=>d,default:()=>g,frontMatter:()=>c,metadata:()=>r,toc:()=>h});const r=JSON.parse('{"id":"csharp/migrations/botbuilder/integration","title":"Using the BotBuilder Plugin","description":"\x3c!--","source":"@site/docs/main/csharp/migrations/botbuilder/integration.mdx","sourceDirName":"csharp/migrations/botbuilder","slug":"/csharp/migrations/botbuilder/integration","permalink":"/teams-sdk/csharp/migrations/botbuilder/integration","draft":false,"unlisted":false,"editUrl":"https://github.com/microsoft/teams-sdk/tree/main/teams.md/docs/main/csharp/migrations/botbuilder/integration.mdx","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"languages":["typescript","csharp","python"],"title":"Using the BotBuilder Plugin","summary":"How to migrate BotBuilder adapters to Teams SDK plugins for handling bot communication and middleware."},"sidebar":"default","previous":{"title":"From BotBuilder","permalink":"/teams-sdk/csharp/migrations/botbuilder/"},"next":{"title":"Sending Activities","permalink":"/teams-sdk/csharp/migrations/botbuilder/sending-activities"}}');var i=t(62540),a=t(43023),s=t(26802),o=t(78296),l=t(22491);const c={sidebar_position:1,languages:["typescript","csharp","python"],title:"Using the BotBuilder Plugin",summary:"How to migrate BotBuilder adapters to Teams SDK plugins for handling bot communication and middleware."},d="Using the BotBuilder Plugin",u={},h=[];function p(e){const n={admonition:"admonition",code:"code",h1:"h1",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"using-the-botbuilder-plugin",children:"Using the BotBuilder Plugin"})}),"\n",(0,i.jsx)(n.h1,{id:"adapters",children:"Adapters"}),"\n",(0,i.jsxs)(n.p,{children:["A BotBuilder ",(0,i.jsx)(n.code,{children:"CloudAdapter"})," is responsible for managing communication between a bot and its users.\nIt serves as the entry point for incoming activities and forwards them to the registered ",(0,i.jsx)(n.code,{children:"ActivityHandler"})," for processing.\nYou can customize the adapter to add middleware for logging, authentication, and define error handling."]}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"BotBuilderPlugin"})," provided within the Teams SDK, connects the SDK with the BotBuilder framework.\nIt can either use an existing ",(0,i.jsx)(n.code,{children:"CloudAdapter"})," or create a new default one, allowing activities to be processed through BotBuilder\nwhile still handling events via the Teams SDK App framework."]}),"\n",(0,i.jsx)(n.h1,{id:"activity-handlers",children:"Activity Handlers"}),"\n",(0,i.jsxs)(n.p,{children:["The BotBuilder ",(0,i.jsx)(n.code,{children:"ActivityHandler"})," contains the actual bot logic for processing messages or events\nsimilar to how the Teams SDK ",(0,i.jsx)(n.code,{children:"App"})," routes messages and events. You can override any number of methods,\nsuch as ",(0,i.jsx)(s.A,{language:"typescript",children:(0,i.jsx)(n.code,{children:"OnMembersAdded"})}),"\n",(0,i.jsx)(s.A,{language:"csharp",children:(0,i.jsx)(n.code,{children:"OnMembersAddedAsync"})}),"\n",(0,i.jsx)(s.A,{language:"python",children:(0,i.jsx)(n.code,{children:"on_members_added_activity"})}),"\nor ",(0,i.jsx)(s.A,{language:"typescript",children:(0,i.jsx)(n.code,{children:"onMessage"})}),"\n",(0,i.jsx)(s.A,{language:"csharp",children:(0,i.jsx)(n.code,{children:"OnMessageActivityAsync"})}),"\n",(0,i.jsx)(s.A,{language:"python",children:(0,i.jsx)(n.code,{children:"on_message_activity"})})," ,\nto handle different activity types."]}),"\n",(0,i.jsx)(n.h1,{id:"turn-context",children:"Turn Context"}),"\n",(0,i.jsxs)(n.p,{children:["Each incoming activity is wrapped in a ",(0,i.jsx)(n.code,{children:"TurnContext"}),", which represents the context of a single turn in the conversation.\nTurnContext provides access to:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"The incoming activity (message, event)."}),"\n",(0,i.jsx)(n.li,{children:"Services for sending responses back to the user."}),"\n",(0,i.jsx)(n.li,{children:"Conversation, user, and channel metadata."}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Teams SDK has ",(0,i.jsx)(s.A,{language:"typescript",children:(0,i.jsx)(n.code,{children:"IActivityContext"})}),"\n",(0,i.jsx)(s.A,{language:"csharp",children:(0,i.jsx)(n.code,{children:"IActivityContext"})}),"\n",(0,i.jsx)(s.A,{language:"python",children:(0,i.jsx)(n.code,{children:"ActivityContext"})})," for the same purpose."]}),"\n",(0,i.jsx)(n.h1,{id:"how-it-all-comes-together",children:"How it all comes together"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"CloudAdapter"})," creates the ",(0,i.jsx)(n.code,{children:"TurnContext"}),", and the ",(0,i.jsx)(n.code,{children:"ActivityHandler"})," uses it to read the activity and send responses."]}),"\n",(0,i.jsxs)(n.p,{children:["With the ",(0,i.jsx)(n.code,{children:"BotBuilderPlugin"}),", when a message or activity is received:"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"The BotBuilder ActivityHandler runs first, handling the activity according to standard Bot Framework logic."}),"\n",(0,i.jsx)(n.li,{children:"The Teams SDK app based activity handlers execute afterward, allowing Teams SDK logic to execute."}),"\n"]}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsxs)(n.p,{children:["This snippet shows how to use the ",(0,i.jsx)(n.code,{children:"BotBuilderPlugin"})," to send and receive activities using botbuilder instead of the default Teams SDK http plugin."]})}),"\n",(0,i.jsx)(s.A,{language:"csharp",children:(0,i.jsxs)(o.A,{children:[(0,i.jsx)(l.A,{value:"Program.cs",default:!0,children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:'\nusing Microsoft.Bot.Builder.Integration.AspNet.Core;\nusing Microsoft.Teams.Api.Activities;\nusing Microsoft.Teams.Apps;\nusing Microsoft.Teams.Apps.Activities;\nusing Microsoft.Teams.Apps.Annotations;\nusing Microsoft.Teams.Plugins.AspNetCore.Extensions;\n\npublic static partial class Program\n{\n    public static void Main(string[] args)\n    {\n        var builder = WebApplication.CreateBuilder(args);\n        builder.Services.AddTransient<Controller>();\n        builder\n            .AddTeams()\n            // highlight-next-line\n            .AddBotBuilder<Bot, BotBuilderAdapter, ConfigurationBotFrameworkAuthentication>();\n\n        var app = builder.Build();\n\n        var teams = app.UseTeams();\n        app.Run();\n    }\n\n    teams.OnMessage(async context =>\n    {\n        await context.Client.Typing();\n        await context.Client.Send($"hi from teams...");\n    });\n}\n'})})}),(0,i.jsx)(l.A,{value:"BotBuilderAdapter.cs",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:'using Microsoft.Bot.Builder.Integration.AspNet.Core;\nusing Microsoft.Bot.Connector.Authentication;\n\n// replace with your Adapter\n// highlight-start\npublic class BotBuilderAdapter : CloudAdapter\n{\n    public BotBuilderAdapter(BotFrameworkAuthentication auth, ILogger<IBotFrameworkHttpAdapter> logger)\n        : base(auth, logger)\n    {\n        OnTurnError = async (turnContext, exception) =>\n        {\n            logger.LogError(exception, $"[OnTurnError] unhandled error : {exception.Message}");\n\n            // Send a message to the user\n            await turnContext.SendActivityAsync("The bot encountered an error or bug.");\n        };\n    }\n}\n// highlight-end\n'})})}),(0,i.jsx)(l.A,{value:"ActivityHandler.cs",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:'using Microsoft.Bot.Builder;\nusing Microsoft.Bot.Schema;\n\n// replace with your ActivityHandler\n// highlight-start\npublic class Bot : ActivityHandler\n{\n    protected override async Task OnMessageActivityAsync(ITurnContext<IMessageActivity> turnContext, CancellationToken cancellationToken)\n    {\n        var replyText = $"hi from botbuilder...";\n        await turnContext.SendActivityAsync(MessageFactory.Text(replyText, replyText), cancellationToken);\n    }\n}\n// highlight-end\n'})})})]})}),"\n",(0,i.jsx)(n.p,{children:"In this example:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(s.A,{language:"typescript",children:(0,i.jsx)(n.code,{children:"adapter.ts"})}),"\n",(0,i.jsx)(s.A,{language:"csharp",children:(0,i.jsx)(n.code,{children:"BotBuilderAdapter.cs"})}),"\n",(0,i.jsx)(s.A,{language:"python",children:(0,i.jsx)(n.code,{children:"adapter.py"})})," defines a ",(0,i.jsx)(n.code,{children:"CloudAdapter"})," to\nhandle incoming activities, and can include middleware support or error handling."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(s.A,{language:"typescript",children:(0,i.jsx)(n.code,{children:"activity-handler.ts"})}),"\n",(0,i.jsx)(s.A,{language:"csharp",children:(0,i.jsx)(n.code,{children:"Bot.cs"})}),"\n",(0,i.jsx)(s.A,{language:"python",children:(0,i.jsx)(n.code,{children:"activity_handler.py"})})," defines the ",(0,i.jsx)(n.code,{children:"ActivityHandler"})," and contains the core bot logic,\nhandling incoming messages and sending responses via the ",(0,i.jsx)(n.code,{children:"TurnContext"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(s.A,{language:"typescript",children:(0,i.jsx)(n.code,{children:"index.ts"})}),"\n",(0,i.jsx)(s.A,{language:"csharp",children:(0,i.jsx)(n.code,{children:"Program.cs"})}),"\n",(0,i.jsx)(s.A,{language:"python",children:(0,i.jsx)(n.code,{children:"app.py"})})," sets up a Teams SDK ",(0,i.jsx)(n.code,{children:"app"}),"\nand registers the ",(0,i.jsx)(n.code,{children:"BotBuilderPlugin"})," with your adapter and activity handler. It also defines a native Teams SDK activity handler that responds to messages."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"In the ouptut below,\nThe first line comes from the BotBuilder ActivityHandler. The second line comes from the Teams SDK message activity handler.\nThis shows that both handlers can process the same message sequentially when using the BotBuilder Plugin.\nThis strategy can now be used to incrementally migrate from BotBuilder to the Teams SDK."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"hi from botbuilder...\nhi from teams...\n"})})]})}function g(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(p,{...e})}):p(e)}},78296:(e,n,t)=>{t.d(n,{A:()=>B});var r=t(63696),i=t(11750),a=t(53237),s=t(90766),o=t(22147),l=t(14395),c=t(35043),d=t(44544),u=t(41506);function h(e){return r.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function p(e){const{values:n,children:t}=e;return(0,r.useMemo)((()=>{const e=n??function(e){return h(e).map((({props:{value:e,label:n,attributes:t,default:r}})=>({value:e,label:n,attributes:t,default:r})))}(t);return function(e){const n=(0,d.XI)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,t])}function g({value:e,tabValues:n}){return n.some((n=>n.value===e))}function m({queryString:e=!1,groupId:n}){const t=(0,o.W6)(),i=function({queryString:e=!1,groupId:n}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:e,groupId:n});return[(0,c.aZ)(i),(0,r.useCallback)((e=>{if(!i)return;const n=new URLSearchParams(t.location.search);n.set(i,e),t.replace({...t.location,search:n.toString()})}),[i,t])]}function x(e){const{defaultValue:n,queryString:t=!1,groupId:i}=e,a=p(e),[s,o]=(0,r.useState)((()=>function({defaultValue:e,tabValues:n}){if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!g({value:e,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const t=n.find((e=>e.default))??n[0];if(!t)throw new Error("Unexpected error: 0 tabValues");return t.value}({defaultValue:n,tabValues:a}))),[c,d]=m({queryString:t,groupId:i}),[h,x]=function({groupId:e}){const n=function(e){return e?`docusaurus.tab.${e}`:null}(e),[t,i]=(0,u.Dv)(n);return[t,(0,r.useCallback)((e=>{n&&i.set(e)}),[n,i])]}({groupId:i}),b=(()=>{const e=c??h;return g({value:e,tabValues:a})?e:null})();(0,l.A)((()=>{b&&o(b)}),[b]);return{selectedValue:s,selectValue:(0,r.useCallback)((e=>{if(!g({value:e,tabValues:a}))throw new Error(`Can't select invalid tab value=${e}`);o(e),d(e),x(e)}),[d,x,a]),tabValues:a}}var b=t(86681);const f={tabList:"tabList_J5MA",tabItem:"tabItem_l0OV"};var v=t(62540);function j({className:e,block:n,selectedValue:t,selectValue:r,tabValues:a}){const o=[],{blockElementScrollPositionUntilNextRender:l}=(0,s.a_)(),c=e=>{const n=e.currentTarget,i=o.indexOf(n),s=a[i].value;s!==t&&(l(n),r(s))},d=e=>{let n=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const t=o.indexOf(e.currentTarget)+1;n=o[t]??o[0];break}case"ArrowLeft":{const t=o.indexOf(e.currentTarget)-1;n=o[t]??o[o.length-1];break}}n?.focus()};return(0,v.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.A)("tabs",{"tabs--block":n},e),children:a.map((({value:e,label:n,attributes:r})=>(0,v.jsx)("li",{role:"tab",tabIndex:t===e?0:-1,"aria-selected":t===e,ref:e=>{o.push(e)},onKeyDown:d,onClick:c,...r,className:(0,i.A)("tabs__item",f.tabItem,r?.className,{"tabs__item--active":t===e}),children:n??e},e)))})}function y({lazy:e,children:n,selectedValue:t}){const a=(Array.isArray(n)?n:[n]).filter(Boolean);if(e){const e=a.find((e=>e.props.value===t));return e?(0,r.cloneElement)(e,{className:(0,i.A)("margin-top--md",e.props.className)}):null}return(0,v.jsx)("div",{className:"margin-top--md",children:a.map(((e,n)=>(0,r.cloneElement)(e,{key:n,hidden:e.props.value!==t})))})}function A(e){const n=x(e);return(0,v.jsxs)("div",{className:(0,i.A)(a.G.tabs.container,"tabs-container",f.tabList),children:[(0,v.jsx)(j,{...n,...e}),(0,v.jsx)(y,{...n,...e})]})}function B(e){const n=(0,b.A)();return(0,v.jsx)(A,{...e,children:h(e.children)},String(n))}}}]);
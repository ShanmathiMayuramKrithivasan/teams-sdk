"use strict";(self.webpackChunkteams_md=self.webpackChunkteams_md||[]).push([[5209],{43023:(e,t,n)=>{n.d(t,{R:()=>a,x:()=>o});var s=n(63696);const i={},r=s.createContext(i);function a(e){const t=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(r.Provider,{value:t},e.children)}},78954:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>o,default:()=>d,frontMatter:()=>a,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"typescript/in-depth-guides/tabs/graph","title":"Microsoft Graph","description":"\x3c!--","source":"@site/docs/main/typescript/in-depth-guides/tabs/graph.mdx","sourceDirName":"typescript/in-depth-guides/tabs","slug":"/typescript/in-depth-guides/tabs/graph","permalink":"/teams-sdk/typescript/in-depth-guides/tabs/graph","draft":false,"unlisted":false,"editUrl":"https://github.com/microsoft/teams-sdk/tree/main/teams.md/docs/main/typescript/in-depth-guides/tabs/graph.mdx","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4,"title":"Microsoft Graph","summary":"Access Microsoft Graph APIs with type-safe client and manage user consent for permissions.","languages":["typescript"],"suppressLanguageIncludeWarning":true},"sidebar":"default","previous":{"title":"App Options","permalink":"/teams-sdk/typescript/in-depth-guides/tabs/app-options"},"next":{"title":"Functions","permalink":"/teams-sdk/typescript/in-depth-guides/tabs/functions/"}}');var i=n(62540),r=n(43023);const a={sidebar_position:4,title:"Microsoft Graph",summary:"Access Microsoft Graph APIs with type-safe client and manage user consent for permissions.",languages:["typescript"],suppressLanguageIncludeWarning:!0},o="Microsoft Graph Client",p={},c=[{value:"Invoking Graph functions",id:"invoking-graph-functions",level:2},{value:"Graph APIs and permissions",id:"graph-apis-and-permissions",level:2},{value:"Pre-warming while starting the app",id:"pre-warming-while-starting-the-app",level:3},{value:"Requesting consent if not already granted",id:"requesting-consent-if-not-already-granted",level:3},{value:"Testing for consent without prompting",id:"testing-for-consent-without-prompting",level:4},{value:"References",id:"references",level:2}];function h(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"microsoft-graph-client",children:"Microsoft Graph Client"})}),"\n",(0,i.jsxs)(t.p,{children:["The client App exposes a ",(0,i.jsx)(t.code,{children:"graph"})," property that gives type-safe access to Microsoft Graph functions. When graph functions are invoked, the app attaches an MSAL bearer token to the request so that the call can be authenticated and authorized."]}),"\n",(0,i.jsx)(t.h2,{id:"invoking-graph-functions",children:"Invoking Graph functions"}),"\n",(0,i.jsxs)(t.p,{children:["After constructing and starting an App instance, you can invoke any graph function by using the ",(0,i.jsx)(t.code,{children:"app.graph"})," client."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-typescript",children:"import { App } from '@microsoft/teams.client';\nimport * as endpoints from '@microsoft/teams.graph-endpoints';\n\nconst app = new App(clientId);\nawait app.start();\n\nconst top10Chats = await app.graph.call(endpoints.chats.list, { $top: 10 });\n"})}),"\n",(0,i.jsx)(t.p,{children:"For best result, it's wise to ensure that the user has consented to a permission required by the graph API before attempting to invoke it. Otherwise, the call is likely to be rejected by the graph server."}),"\n",(0,i.jsx)(t.h2,{id:"graph-apis-and-permissions",children:"Graph APIs and permissions"}),"\n",(0,i.jsx)(t.p,{children:"Different graph APIs have different permission requirements. The app developer should make sure that consent is granted before invoking a graph API. To help request and test for consent, the client App offers three methods:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Pre-warming while starting the app."}),"\n",(0,i.jsx)(t.li,{children:"Requesting consent if not already granted."}),"\n",(0,i.jsx)(t.li,{children:"Testing for consent without prompting."}),"\n"]}),"\n",(0,i.jsx)(t.h3,{id:"pre-warming-while-starting-the-app",children:"Pre-warming while starting the app"}),"\n",(0,i.jsxs)(t.p,{children:["The App constructor takes an option that lets you control how scope consent is requested while starting the app. For more details on this option, see the ",(0,i.jsx)(t.a,{href:"./app-options",children:"App options"})," documentation."]}),"\n",(0,i.jsx)(t.h3,{id:"requesting-consent-if-not-already-granted",children:"Requesting consent if not already granted"}),"\n",(0,i.jsxs)(t.p,{children:["The app provides an ",(0,i.jsx)(t.code,{children:"ensureConsentForScopes"})," method that tests if the user has consented to a certain set of scopes and prompts them if consent isn't yet granted."]}),"\n",(0,i.jsx)(t.p,{children:"The method returns a promise that resolves to true if the user has already provided consent to all listed scopes; and to false if the user declines the prompt."}),"\n",(0,i.jsx)(t.p,{children:"This method is useful for building an incremental, just-in-time, consent model, or to fully control how consent is pre-warmed."}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-typescript",children:"import { App } from '@microsoft/teams.client';\nimport * as endpoints from '@microsoft/teams.graph-endpoints';\n\nconst app = new App(clientId, {\n  msalOptions: { prewarmScopes: ['User.Read'] },\n});\n\n// this will prompt for the User.Read scope if not already granted\nawait app.start();\n\n// this will prompt for Chat.ReadBasic if not already granted\nconst canReadChat = await app.ensureConsentForScopes(['Chat.ReadBasic']);\n\nif (canReadChat) {\n  const top10Chats = await app.graph.call(endpoints.chats.list, { $top: 10 });\n  // ... do something useful ...\n}\n"})}),"\n",(0,i.jsx)(t.h4,{id:"testing-for-consent-without-prompting",children:"Testing for consent without prompting"}),"\n",(0,i.jsxs)(t.p,{children:["The app also provides a ",(0,i.jsx)(t.code,{children:"hasConsentForScopes"})," method to test for consent without raising a prompt. This is handy to enable or disable features based on user choice, or to provide friendly messaging before raising a prompt with ",(0,i.jsx)(t.code,{children:"ensureConsentForScopes"}),"."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-typescript",children:"import { App } from '@microsoft/teams.client';\nimport * as endpoints from '@microsoft/teams.graph-endpoints';\n\nconst app = new App(clientId);\n\n// this will prompt for the '.default' scope if the user hasn't already\n// consented to any scope\nawait app.start();\n\n// this will not raise a prompt under any circumstance\nconst canReadChat = await app.hasConsentForScopes(['Chat.ReadBasic']);\n\nif (canReadChat) {\n  const top10Chats = await app.graph.call(endpoints.chats.list, { $top: 10 });\n  // ... do something useful ...\n}\n"})}),"\n",(0,i.jsx)(t.h2,{id:"references",children:"References"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.a,{href:"https://learn.microsoft.com/en-us/graph/api/overview",children:"Graph API overview"})}),"\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.a,{href:"https://learn.microsoft.com/en-us/graph/permissions-reference",children:"Graph API permissions overview"})}),"\n"]})]})}function d(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}}}]);
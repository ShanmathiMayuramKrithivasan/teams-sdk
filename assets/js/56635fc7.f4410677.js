"use strict";(self.webpackChunkteams_md=self.webpackChunkteams_md||[]).push([[8716],{26802:(e,s,t)=>{t.d(s,{A:()=>i});var r=t(22147),a=t(62540);function i({language:e,children:s}){return(0,r.zy)().pathname.includes(`/${e}/`)?(0,a.jsx)(a.Fragment,{children:s}):null}},28927:(e,s,t)=>{t.r(s),t.d(s,{assets:()=>h,contentTitle:()=>c,default:()=>d,frontMatter:()=>o,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"typescript/essentials/graph","title":"Graph API Client","description":"\x3c!--","source":"@site/docs/main/typescript/essentials/graph.mdx","sourceDirName":"typescript/essentials","slug":"/typescript/essentials/graph","permalink":"/teams-sdk/typescript/essentials/graph","draft":false,"unlisted":false,"editUrl":"https://github.com/microsoft/teams-sdk/tree/main/teams.md/docs/main/typescript/essentials/graph.mdx","tags":[],"version":"current","sidebarPosition":8,"frontMatter":{"sidebar_position":8,"sidebar_label":"Graph API Client","title":"Graph API Client","summary":"Guide to using the Microsoft Graph API client to access Microsoft 365 data and services from your Teams SDK application."},"sidebar":"default","previous":{"title":"Hosting Static Pages","permalink":"/teams-sdk/typescript/essentials/hosting-static-pages"},"next":{"title":"In-Depth Guides","permalink":"/teams-sdk/typescript/in-depth-guides/"}}');var a=t(62540),i=t(43023),n=t(26802);const o={sidebar_position:8,sidebar_label:"Graph API Client",title:"Graph API Client",summary:"Guide to using the Microsoft Graph API client to access Microsoft 365 data and services from your Teams SDK application."},c="Graph API Client",h={},l=[{value:"Package overview",id:"package-overview",level:2},{value:"Calling APIs",id:"calling-apis",level:2},{value:"The Graph Client",id:"the-graph-client",level:2},{value:"Graph Preview APIs",id:"graph-preview-apis",level:2},{value:"Custom Graph API calls",id:"custom-graph-api-calls",level:2},{value:"Additional resources",id:"additional-resources",level:2}];function p(e){const s={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s.header,{children:(0,a.jsx)(s.h1,{id:"graph-api-client",children:"Graph API Client"})}),"\n",(0,a.jsxs)(s.p,{children:[(0,a.jsx)(s.a,{href:"https://docs.microsoft.com/en-us/graph/overview",children:"Microsoft Graph"})," gives you access to the wider Microsoft 365 ecosystem. You can enrich your application with data from across Microsoft 365."]}),"\n",(0,a.jsxs)(s.p,{children:["The SDK gives your application easy access to the Microsoft Graph API via the ",(0,a.jsxs)(n.A,{language:"typescript",children:[(0,a.jsx)(s.code,{children:"@microsoft/teams.graph"}),", ",(0,a.jsx)(s.code,{children:"@microsoft/teams.graph-endpoints"})," and ",(0,a.jsx)(s.code,{children:"@microsoft/teams.graph-endpoints-beta"})," packages"]}),"."]}),"\n",(0,a.jsx)(n.A,{language:"typescript",children:(0,a.jsx)(s.admonition,{type:"note",children:(0,a.jsxs)(s.p,{children:["If you're migrating from an earlier preview version of the Teams SDK, please see the ",(0,a.jsx)(s.a,{href:"../migrations/v2-previews",children:"migration guide"})," for details on breaking changes."]})})}),"\n",(0,a.jsxs)(n.A,{language:"typescript",children:[(0,a.jsx)(s.h2,{id:"package-overview",children:"Package overview"}),(0,a.jsx)(s.p,{children:"The Graph API surface is vast, and this is reflected in the size of the endpoints packages. To help you manage the size of your product, we made sure that the endpoints code is tree-shakable. We also made most of the code into an optional dependency, in case tree-shaking is not supported in your environment."}),(0,a.jsxs)(s.table,{children:[(0,a.jsx)(s.thead,{children:(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.th,{children:"Package"}),(0,a.jsx)(s.th,{children:"Optional"}),(0,a.jsx)(s.th,{children:"Contains"})]})}),(0,a.jsxs)(s.tbody,{children:[(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:(0,a.jsx)(s.code,{children:"@microsoft/teams.graph"})}),(0,a.jsx)(s.td,{children:"No"}),(0,a.jsx)(s.td,{children:"A tiny client to create and issue Graph HTTP requests."})]}),(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:(0,a.jsx)(s.code,{children:"@microsoft/teams.graph-endpoints"})}),(0,a.jsx)(s.td,{children:"Yes"}),(0,a.jsx)(s.td,{children:"Request-builder functions and types to call any of the production ready Graph APIs."})]}),(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:(0,a.jsx)(s.code,{children:"@microsoft/teams.graph-endpoints-beta"})}),(0,a.jsx)(s.td,{children:"Yes"}),(0,a.jsx)(s.td,{children:"Same, but for Graph APIs still in preview."})]})]})]}),(0,a.jsx)(s.p,{children:"To use this SDK to call Graph APIs, the first step is to install the optional endpoints package using your favorite package manager. For instance:"}),(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-sh",children:"npm install @microsoft/teams.graph-endpoints\n"})})]}),"\n",(0,a.jsx)(s.h2,{id:"calling-apis",children:"Calling APIs"}),"\n",(0,a.jsxs)(s.p,{children:["Microsoft Graph can be accessed by your application using its own application token, or by using the user's token. If you need access to resources that your application may not have, but your user does, you will need to use the user's scoped graph client. To grant explicit consent for your application to access resources on behalf of a user, follow the ",(0,a.jsx)(s.a,{href:"../in-depth-guides/user-authentication",children:"auth guide"}),"."]}),"\n",(0,a.jsxs)(s.p,{children:["To access the graph using the Graph using the app, you may use the ",(0,a.jsx)(n.A,{language:"typescript",children:(0,a.jsx)(s.code,{children:"app.graph"})})," object ",(0,a.jsx)(n.A,{language:"typescript",children:"to call the endpoint of your choice"}),"."]}),"\n",(0,a.jsx)(n.A,{language:"typescript",children:(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-typescript",children:"import * as endpoints from '@microsoft/teams.graph-endpoints';\n\n// Equivalent of https://learn.microsoft.com/en-us/graph/api/user-get\n// Gets the details of the bot-user\napp.graph.call(endpoints.me.get).then((user) => {\n  console.log(`User ID: ${user.id}`);\n  console.log(`User Display Name: ${user.displayName}`);\n  console.log(`User Email: ${user.mail}`);\n  console.log(`User Job Title: ${user.jobTitle}`);\n});\n"})})}),"\n",(0,a.jsx)(n.A,{language:"typescript",children:(0,a.jsxs)(s.p,{children:["You can also access the graph using the user's token from within a message handler via the ",(0,a.jsx)(s.code,{children:"userGraph"})," prop."]})}),"\n",(0,a.jsx)(n.A,{language:"typescript",children:(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-typescript",children:"import * as endpoints from '@microsoft/teams.graph-endpoints';\n\n// Gets details of the current user\napp.on('message', async ({ activity, userGraph }) => {\n  const me = await userGraph.call(endpoints.me.get);\n  console.log(`User ID: ${me.id}`);\n  console.log(`User Display Name: ${me.displayName}`);\n  console.log(`User Email: ${me.mail}`);\n  console.log(`User Job Title: ${me.jobTitle}`);\n});\n"})})}),"\n",(0,a.jsxs)(s.p,{children:["Here, the ",(0,a.jsx)(n.A,{language:"typescript",children:(0,a.jsx)(s.code,{children:"userGraph"})})," object is a scoped graph client for the user that sent the message."]}),"\n",(0,a.jsx)(s.admonition,{type:"tip",children:(0,a.jsxs)(s.p,{children:["You also have access to the ",(0,a.jsx)(n.A,{language:"typescript",children:(0,a.jsx)(s.code,{children:"appGraph"})})," object in the activity handler. This is equivalent to ",(0,a.jsx)(n.A,{language:"typescript",children:(0,a.jsx)(s.code,{children:"app.graph"})}),"."]})}),"\n",(0,a.jsxs)(n.A,{language:"typescript",children:[(0,a.jsx)(s.h2,{id:"the-graph-client",children:"The Graph Client"}),(0,a.jsxs)(s.p,{children:["The Graph Client provides a straight-forward ",(0,a.jsx)(s.code,{children:"call"})," method to interact with Microsoft Graph and issue requests scoped to a specific user or application. Paired with the Graph Endpoints packages, it offers discoverable and type-safe access to the vast Microsoft Graph API surface."]}),(0,a.jsxs)(s.p,{children:["Having an understanding of ",(0,a.jsx)(s.a,{href:"https://learn.microsoft.com/en-us/graph/use-the-api",children:"how the graph API works"})," will help you make the most of the SDK. For example, to get the ",(0,a.jsx)(s.code,{children:"id"})," of the chat instance between a user and an app, ",(0,a.jsx)(s.a,{href:"https://learn.microsoft.com/en-us/graph/api/userscopeteamsappinstallation-get-chat?view=graph-rest-1.0&tabs=http",children:"Microsoft Graph"})," exposes it via:"]}),(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{children:"GET /users/{user-id | user-principal-name}/teamwork/installedApps/{app-installation-id}/chat\n"})}),(0,a.jsx)(s.p,{children:"The equivalent using the graph client would look like this:"}),(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-ts",children:"import { users } from '@microsoft/teams.graph-endpoints';\n\nconst chat = await userGraph.call(users.teamwork.installedApps.chat.get, {\n  'user-id': user.id,\n  'userScopeTeamsAppInstallation-id': appInstallationId,\n  $select: ['id'],\n});\n"})}),(0,a.jsxs)(s.p,{children:["Graph APIs often accept arguments that may go into the URL path, the query string, or the request body. As illustrated in this example, all arguments are provided as a second parameter to the ",(0,a.jsx)(s.code,{children:"graph.call"})," method. The graph client puts each value in its place and attaches an authentication token as the request is constructed, and performs the fetch request for you."]}),(0,a.jsx)(s.h2,{id:"graph-preview-apis",children:"Graph Preview APIs"}),(0,a.jsxs)(s.p,{children:["The Graph Preview APIs are not recommended for production use. However, if you have a need to explore preview APIs, the ",(0,a.jsx)(s.code,{children:"@microsoft/teams.graph-endpoints-beta"})," package makes it easy."]}),(0,a.jsx)(s.p,{children:"First, install the optional dependency:"}),(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-sh",children:"npm install @microsoft/teams.graph-endpoints-beta\n"})}),(0,a.jsxs)(s.p,{children:["Then use it just like the regular ",(0,a.jsx)(s.code,{children:"@microsoft/teams.graph-endpoints"})," package."]}),(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-ts",children:"import * as endpointsBeta from '@microsoft/teams.graph-endpoints-beta';\n\n// Gets the current user details from /beta/me, rather than from /v1.0/me.\nconst me = await app.graph.call(endpointsBeta.me.get);\n"})}),(0,a.jsxs)(s.p,{children:["The key differences between ",(0,a.jsx)(s.code,{children:"@microsoft/teams.graph-endpoints"})," and ",(0,a.jsx)(s.code,{children:"@microsoft/teams.graph-endpoints-beta"})," are that they represent different Graph API schemas, and that the ",(0,a.jsx)(s.code,{children:"graph.call()"})," method knows to route the request to either /v1.0 or /beta. This means that it's possible to mix'n'match v1.0 and beta endpoints, for instance to explore a novel beta API in a code base that's already relying on v1.0 for all stable APIs."]}),(0,a.jsx)(s.h2,{id:"custom-graph-api-calls",children:"Custom Graph API calls"}),(0,a.jsxs)(s.p,{children:["It's possible to craft custom builder functions that work just like the ones provided in the ",(0,a.jsx)(s.code,{children:"@microsoft/teams.graph-endpoints"})," and ",(0,a.jsx)(s.code,{children:"@microsoft/teams.graph-endpoints-beta"})," packages. This can be handy if you wish to provide narrower return types, call some novel API that is supported by the Graph backend but not yet included in the endpoints packages, or avoid taking a dependency on the endpoints packages altogether."]}),(0,a.jsxs)(s.p,{children:["For instance, this will ",(0,a.jsx)(s.code,{children:"GET https://graph.microsoft.com/beta/me?$select=displayName"})," and return an object typed to contain just ",(0,a.jsx)(s.code,{children:"displayName"}),", without taking a dependency on the endpoints packages."]}),(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-ts",children:"import { type EndpointRequest } from '@microsoft/teams.graph';\n\nconst getMyDisplayName = (): EndpointRequest<{ displayName: string }> => ({\n  ver: 'beta', // use the beta endpoint; defaults to 'v1.0' if omitted\n  method: 'get', // HTTP method to use\n  path: '/me', // endpoint path\n  paramDefs: {\n    query: ['$select'], // the $select parameter goes in the query string\n  },\n  params: {\n    $select: ['displayName'], // the attribute(s) to select\n  },\n});\n\nconst { displayName } = await app.graph.call(getMyDisplayName);\n"})})]}),"\n",(0,a.jsxs)(n.A,{language:"typescript",children:[(0,a.jsx)(s.h2,{id:"additional-resources",children:"Additional resources"}),(0,a.jsx)(s.p,{children:"Microsoft Graph offers an extensive and thoroughly documented API surface. These essential resources will serve as your go-to references for any Graph development work:"}),(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:["The ",(0,a.jsx)(s.a,{href:"https://learn.microsoft.com/en-us/graph/api/overview",children:"Microsoft Graph Rest API reference documentation"})," gives details for each API, including permissions requirements."]}),"\n",(0,a.jsxs)(s.li,{children:["The ",(0,a.jsx)(s.a,{href:"https://learn.microsoft.com/en-us/graph/api/overview?view=graph-rest-beta",children:"Microsoft Graph REST API beta endpoint reference"})," gives similar information for preview APIs."]}),"\n",(0,a.jsxs)(s.li,{children:["The ",(0,a.jsx)(s.a,{href:"https://developer.microsoft.com/en-us/graph/graph-explorer",children:"Graph Explorer"})," lets you discover and test drive APIs."]}),"\n"]}),(0,a.jsx)(s.p,{children:"In addition, the following endpoints may be especially interesting to Teams developers:"}),(0,a.jsxs)(s.table,{children:[(0,a.jsx)(s.thead,{children:(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.th,{children:"Graph endpoints"}),(0,a.jsx)(s.th,{children:"Description"})]})}),(0,a.jsxs)(s.tbody,{children:[(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:(0,a.jsx)(s.a,{href:"https://learn.microsoft.com/en-us/graph/api/appcatalogs-list-teamsapps?view=graph-rest-1.0",children:"appCatalogs"})}),(0,a.jsx)(s.td,{children:"Apps in the Teams App Catalog"})]}),(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:(0,a.jsx)(s.a,{href:"https://learn.microsoft.com/en-us/graph/api/serviceprincipal-list-approleassignments?view=graph-rest-1.0",children:"appRoleAssignments"})}),(0,a.jsx)(s.td,{children:"App role assignments"})]}),(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:(0,a.jsx)(s.a,{href:"https://learn.microsoft.com/en-us/graph/api/resources/applicationtemplate?view=graph-rest-1.0",children:"applicationTemplates"})}),(0,a.jsx)(s.td,{children:"Applications in the Microsoft Entra App Gallery"})]}),(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:(0,a.jsx)(s.a,{href:"https://learn.microsoft.com/en-us/graph/api/resources/application?view=graph-rest-1.0",children:"applications"})}),(0,a.jsx)(s.td,{children:"Application resources"})]}),(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:(0,a.jsx)(s.a,{href:"https://learn.microsoft.com/en-us/graph/api/chat-list?view=graph-rest-1.0&tabs=http",children:"chats"})}),(0,a.jsx)(s.td,{children:"Chat resources between users"})]}),(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:(0,a.jsx)(s.a,{href:"https://learn.microsoft.com/en-us/graph/api/application-post-calls?view=graph-rest-1.0",children:"communications"})}),(0,a.jsx)(s.td,{children:"Calls and Online meetings"})]}),(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:(0,a.jsx)(s.a,{href:"https://learn.microsoft.com/en-us/graph/api/resources/engagement-api-overview?view=graph-rest-1.0",children:"employeeExperience"})}),(0,a.jsx)(s.td,{children:"Employee Experience and Engagement"})]}),(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:(0,a.jsx)(s.a,{href:"https://learn.microsoft.com/en-us/graph/api/user-get?view=graph-rest-1.0&tabs=http",children:"me"})}),(0,a.jsxs)(s.td,{children:["Same as ",(0,a.jsx)(s.code,{children:"/users"})," but scoped to one user (who is making the request)"]})]}),(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:(0,a.jsx)(s.a,{href:"https://learn.microsoft.com/en-us/graph/api/resources/team?view=graph-rest-1.0",children:"teams"})}),(0,a.jsx)(s.td,{children:"Team resources in Microsoft Teams"})]}),(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:(0,a.jsx)(s.a,{href:"https://learn.microsoft.com/en-us/microsoftteams/get-started-with-teams-templates",children:"teamsTemplates"})}),(0,a.jsx)(s.td,{children:"Templates used to create teams"})]}),(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:(0,a.jsx)(s.a,{href:"https://learn.microsoft.com/en-us/graph/api/resources/teamwork?view=graph-rest-1.0",children:"teamwork"})}),(0,a.jsx)(s.td,{children:"A range of Microsoft Teams functionalities"})]}),(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:(0,a.jsx)(s.a,{href:"https://learn.microsoft.com/en-us/graph/api/resources/users?view=graph-rest-1.0",children:"users"})}),(0,a.jsx)(s.td,{children:"User resources"})]})]})]})]})]})}function d(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,a.jsx)(s,{...e,children:(0,a.jsx)(p,{...e})}):p(e)}},43023:(e,s,t)=>{t.d(s,{R:()=>n,x:()=>o});var r=t(63696);const a={},i=r.createContext(a);function n(e){const s=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:n(e.components),r.createElement(i.Provider,{value:s},e.children)}}}]);
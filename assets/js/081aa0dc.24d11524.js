"use strict";(self.webpackChunkteams_md=self.webpackChunkteams_md||[]).push([[8653],{19511:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>u,default:()=>m,frontMatter:()=>c,metadata:()=>a,toc:()=>h});const a=JSON.parse('{"id":"csharp/in-depth-guides/ai/mcp/mcp-client","title":"MCP Client","description":"\x3c!--","source":"@site/docs/main/csharp/in-depth-guides/ai/mcp/mcp-client.mdx","sourceDirName":"csharp/in-depth-guides/ai/mcp","slug":"/csharp/in-depth-guides/ai/mcp/mcp-client","permalink":"/teams-sdk/csharp/in-depth-guides/ai/mcp/mcp-client","draft":false,"unlisted":false,"editUrl":"https://github.com/microsoft/teams-sdk/tree/main/teams.md/docs/main/csharp/in-depth-guides/ai/mcp/mcp-client.mdx","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"sidebar_label":"MCP Client","title":"MCP Client","summary":"How to implement an MCP client to leverage remote MCP servers and their tools in your AI agent application."},"sidebar":"default","previous":{"title":"MCP","permalink":"/teams-sdk/csharp/in-depth-guides/ai/mcp/"},"next":{"title":"Tabs","permalink":"/teams-sdk/csharp/in-depth-guides/tabs/"}}');var r=n(62540),s=n(43023),i=n(26802),o=n(78296),l=n(22491);const c={sidebar_position:2,sidebar_label:"MCP Client",title:"MCP Client",summary:"How to implement an MCP client to leverage remote MCP servers and their tools in your AI agent application."},u="MCP Client",d={},h=[{value:"Remote MCP Server",id:"remote-mcp-server",level:2},{value:"MCP Client Plugin",id:"mcp-client-plugin",level:2},{value:"Custom Headers",id:"custom-headers",level:3}];function p(e){const t={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"mcp-client",children:"MCP Client"})}),"\n",(0,r.jsxs)(t.p,{children:["You are able to leverage other MCP servers that expose tools via the ",(0,r.jsx)(i.A,{language:"csharp",children:"SSE protocol"})," as part of your application. This allows your AI agent to use remote tools to accomplish tasks."]}),"\n",(0,r.jsxs)(i.A,{language:"csharp",children:[(0,r.jsx)(t.p,{children:"Install it to your application:"}),(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"dotnet add package Microsoft.Teams.Plugins.External.McpClient --prerelease\n"})})]}),"\n",(0,r.jsx)(t.admonition,{type:"info",children:(0,r.jsxs)(t.p,{children:["Take a look at ",(0,r.jsx)(t.a,{href:"../function-calling",children:"Function calling"})," to understand how the ",(0,r.jsx)(t.code,{children:"ChatPrompt"})," leverages tools to enhance the LLM's capabilities. MCP extends this functionality by allowing remote tools, that may or may not be developed or maintained by you, to be used by your application."]})}),"\n",(0,r.jsx)(t.h2,{id:"remote-mcp-server",children:"Remote MCP Server"}),"\n",(0,r.jsxs)(t.p,{children:["The first thing that's needed is access to a ",(0,r.jsx)(t.strong,{children:"remote"})," MCP server. MCP Servers (at present) come using two main types protocols:"]}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsxs)(t.li,{children:["StandardIO - This is a ",(0,r.jsx)(t.em,{children:"local"})," MCP server, which runs on your machine. An MCP client may connect to this server, and use standard input and outputs to communicate with it. Since our application is running remotely, this is not something that we want to use"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(i.A,{language:"csharp",children:"SSE"})," - This is a ",(0,r.jsx)(t.em,{children:"remote"})," MCP server. An MCP client may\nsend it requests and the server responds in the expected MCP protocol."]}),"\n"]}),"\n",(0,r.jsxs)(t.p,{children:["For hooking up to your ",(0,r.jsx)(i.A,{language:"csharp",children:"a valid SSE"})," server, you will need to know the URL of the server, and if applicable, ",(0,r.jsx)(i.A,{language:"csharp",children:"and keys"})," that must be included as part of the header."]}),"\n",(0,r.jsx)(t.h2,{id:"mcp-client-plugin",children:"MCP Client Plugin"}),"\n",(0,r.jsxs)(t.p,{children:["The ",(0,r.jsxs)(i.A,{language:"csharp",children:[(0,r.jsx)(t.code,{children:"MCPClientPlugin"})," (from ",(0,r.jsx)(t.code,{children:"Microsoft.Teams.Plugins.External.McpClient"})," package)"]})," integrates directly with the ",(0,r.jsx)(t.code,{children:"ChatPrompt"})," ",(0,r.jsx)(i.A,{language:"csharp",children:"object as a plugin"}),". When the ",(0,r.jsx)(t.code,{children:"ChatPrompt"}),"'s ",(0,r.jsx)(i.A,{language:"csharp",children:(0,r.jsx)(t.code,{children:"send"})})," function is called, it calls the external MCP server and loads up all the tools that are available to it."]}),"\n",(0,r.jsxs)(t.p,{children:["Once loaded, it treats these tools like any functions that are available to the ",(0,r.jsx)(t.code,{children:"ChatPrompt"})," object. If the LLM then decides to call one of these remote MCP tools, the MCP Client plugin will call the remote MCP server and return the result back to the LLM. The LLM can then use this result in its response."]}),"\n",(0,r.jsx)(i.A,{language:"csharp",children:(0,r.jsx)(o.A,{children:(0,r.jsx)(l.A,{label:"Minimal",value:"minimal",children:(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-csharp",children:'using Microsoft.Teams.AI.Models.OpenAI;\nusing Microsoft.Teams.AI.Prompts;\nusing Microsoft.Teams.Api.Activities;\nusing Microsoft.Teams.Apps;\nusing Microsoft.Teams.Apps.Activities;\nusing Microsoft.Teams.Plugins.AspNetCore.Extensions;\nusing Microsoft.Teams.Plugins.External.McpClient;\n\nWebApplicationBuilder builder = WebApplication.CreateBuilder(args);\nbuilder.AddTeams();\nWebApplication webApp = builder.Build();\n\nOpenAIChatPrompt prompt = new(\n        new OpenAIChatModel(\n            model: "gpt-4o",\n            apiKey: Environment.GetEnvironmentVariable("OPENAI_API_KEY")!),\n            new ChatPromptOptions()\n                .WithDescription("helpful assistant")\n                .WithInstructions(\n                    "You are a helpful assistant that can help answer questions using Microsoft docs.",\n                    "You MUST use tool calls to do all your work.")\n                );\nprompt.Plugin(new McpClientPlugin().UseMcpServer("https://learn.microsoft.com/api/mcp"));\n\nApp app = webApp.UseTeams();\napp.OnMessage(async context =>\n{\n    await context.Send(new TypingActivity());\n    var result = await prompt.Send(context.Activity.Text);\n    await context.Send(result.Content);\n});\nwebApp.Run();\n'})})})})}),"\n",(0,r.jsxs)(i.A,{language:"csharp",children:[(0,r.jsx)(t.h3,{id:"custom-headers",children:"Custom Headers"}),(0,r.jsxs)(t.p,{children:["Some MCP servers may require custom headers to be sent as part of the request. You can customize the headers when calling the ",(0,r.jsx)(t.code,{children:"UseMcpServer"})," function:"]}),(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-csharp",children:'new McpClientPlugin()\n    .UseMcpServer("https://learn.microsoft.com/api/mcp",\n        new McpClientPluginParams()\n        {\n               HeadersFactory = () => new Dictionary<string, string>()\n               { { "HEADER_KEY", "HEADER_VALUE" } }\n        }\n    );\n'})})]}),"\n",(0,r.jsx)(i.A,{language:"csharp",children:(0,r.jsxs)(t.p,{children:["In this example, we augment the ",(0,r.jsx)(t.code,{children:"ChatPrompt"})," with a remote MCP Server."]})}),"\n",(0,r.jsx)(i.A,{language:"csharp",children:(0,r.jsx)(t.admonition,{type:"note",children:(0,r.jsxs)(t.p,{children:["You can quickly set up an MCP server using ",(0,r.jsx)(t.a,{href:"https://techcommunity.microsoft.com/blog/appsonazureblog/build-ai-agent-tools-using-remote-mcp-with-azure-functions/4401059",children:"Azure Functions"}),"."]})})}),"\n",(0,r.jsx)(i.A,{language:"csharp",children:(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"Animated image of user typing a prompt (&#39;Tell me about Charizard&#39;) to DevTools Chat window and multiple paragraphs of information being returned.",src:n(65368).A+"",width:"874",height:"720"})})}),"\n",(0,r.jsx)(i.A,{language:"csharp",children:(0,r.jsxs)(t.p,{children:["In this example, our MCP server is a Pokemon API and our client knows how to call it. The LLM is able to call the ",(0,r.jsx)(t.code,{children:"getPokemon"})," function exposed by the server and return the result back to the user."]})})]})}function m(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(p,{...e})}):p(e)}},22491:(e,t,n)=>{n.d(t,{A:()=>i});n(63696);var a=n(11750);const r={tabItem:"tabItem_wHwb"};var s=n(62540);function i({children:e,hidden:t,className:n}){return(0,s.jsx)("div",{role:"tabpanel",className:(0,a.A)(r.tabItem,n),hidden:t,children:e})}},26802:(e,t,n)=>{n.d(t,{A:()=>s});var a=n(22147),r=n(62540);function s({language:e,children:t}){return(0,a.zy)().pathname.includes(`/${e}/`)?(0,r.jsx)(r.Fragment,{children:t}):null}},43023:(e,t,n)=>{n.d(t,{R:()=>i,x:()=>o});var a=n(63696);const r={},s=a.createContext(r);function i(e){const t=a.useContext(s);return a.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),a.createElement(s.Provider,{value:t},e.children)}},65368:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/mcp-client-pokemon-b37c9fe6f433ede5bb0ad4f03ffe69c6.gif"},78296:(e,t,n)=>{n.d(t,{A:()=>M});var a=n(63696),r=n(11750),s=n(53237),i=n(90766),o=n(22147),l=n(14395),c=n(35043),u=n(44544),d=n(41506);function h(e){return a.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,a.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function p(e){const{values:t,children:n}=e;return(0,a.useMemo)((()=>{const e=t??function(e){return h(e).map((({props:{value:e,label:t,attributes:n,default:a}})=>({value:e,label:t,attributes:n,default:a})))}(n);return function(e){const t=(0,u.XI)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,n])}function m({value:e,tabValues:t}){return t.some((t=>t.value===e))}function g({queryString:e=!1,groupId:t}){const n=(0,o.W6)(),r=function({queryString:e=!1,groupId:t}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:e,groupId:t});return[(0,c.aZ)(r),(0,a.useCallback)((e=>{if(!r)return;const t=new URLSearchParams(n.location.search);t.set(r,e),n.replace({...n.location,search:t.toString()})}),[r,n])]}function f(e){const{defaultValue:t,queryString:n=!1,groupId:r}=e,s=p(e),[i,o]=(0,a.useState)((()=>function({defaultValue:e,tabValues:t}){if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!m({value:e,tabValues:t}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${t.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const n=t.find((e=>e.default))??t[0];if(!n)throw new Error("Unexpected error: 0 tabValues");return n.value}({defaultValue:t,tabValues:s}))),[c,u]=g({queryString:n,groupId:r}),[h,f]=function({groupId:e}){const t=function(e){return e?`docusaurus.tab.${e}`:null}(e),[n,r]=(0,d.Dv)(t);return[n,(0,a.useCallback)((e=>{t&&r.set(e)}),[t,r])]}({groupId:r}),b=(()=>{const e=c??h;return m({value:e,tabValues:s})?e:null})();(0,l.A)((()=>{b&&o(b)}),[b]);return{selectedValue:i,selectValue:(0,a.useCallback)((e=>{if(!m({value:e,tabValues:s}))throw new Error(`Can't select invalid tab value=${e}`);o(e),u(e),f(e)}),[u,f,s]),tabValues:s}}var b=n(86681);const x={tabList:"tabList_J5MA",tabItem:"tabItem_l0OV"};var v=n(62540);function j({className:e,block:t,selectedValue:n,selectValue:a,tabValues:s}){const o=[],{blockElementScrollPositionUntilNextRender:l}=(0,i.a_)(),c=e=>{const t=e.currentTarget,r=o.indexOf(t),i=s[r].value;i!==n&&(l(t),a(i))},u=e=>{let t=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const n=o.indexOf(e.currentTarget)+1;t=o[n]??o[0];break}case"ArrowLeft":{const n=o.indexOf(e.currentTarget)-1;t=o[n]??o[o.length-1];break}}t?.focus()};return(0,v.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.A)("tabs",{"tabs--block":t},e),children:s.map((({value:e,label:t,attributes:a})=>(0,v.jsx)("li",{role:"tab",tabIndex:n===e?0:-1,"aria-selected":n===e,ref:e=>{o.push(e)},onKeyDown:u,onClick:c,...a,className:(0,r.A)("tabs__item",x.tabItem,a?.className,{"tabs__item--active":n===e}),children:t??e},e)))})}function C({lazy:e,children:t,selectedValue:n}){const s=(Array.isArray(t)?t:[t]).filter(Boolean);if(e){const e=s.find((e=>e.props.value===n));return e?(0,a.cloneElement)(e,{className:(0,r.A)("margin-top--md",e.props.className)}):null}return(0,v.jsx)("div",{className:"margin-top--md",children:s.map(((e,t)=>(0,a.cloneElement)(e,{key:t,hidden:e.props.value!==n})))})}function A(e){const t=f(e);return(0,v.jsxs)("div",{className:(0,r.A)(s.G.tabs.container,"tabs-container",x.tabList),children:[(0,v.jsx)(j,{...t,...e}),(0,v.jsx)(C,{...t,...e})]})}function M(e){const t=(0,b.A)();return(0,v.jsx)(A,{...e,children:h(e.children)},String(t))}}}]);
"use strict";(self.webpackChunkteams_md=self.webpackChunkteams_md||[]).push([[5682],{22491:(e,n,t)=>{t.d(n,{A:()=>i});t(63696);var s=t(11750);const a={tabItem:"tabItem_wHwb"};var r=t(62540);function i({children:e,hidden:n,className:t}){return(0,r.jsx)("div",{role:"tabpanel",className:(0,s.A)(a.tabItem,t),hidden:n,children:e})}},26802:(e,n,t)=>{t.d(n,{A:()=>r});var s=t(22147),a=t(62540);function r({language:e,children:n}){return(0,s.zy)().pathname.includes(`/${e}/`)?(0,a.jsx)(a.Fragment,{children:n}):null}},43023:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>o});var s=t(63696);const a={},r=s.createContext(a);function i(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),s.createElement(r.Provider,{value:n},e.children)}},57505:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>u,default:()=>p,frontMatter:()=>l,metadata:()=>s,toc:()=>h});const s=JSON.parse('{"id":"csharp/essentials/sending-messages/proactive-messaging","title":"Proactive Messaging","description":"\x3c!--","source":"@site/docs/main/csharp/essentials/sending-messages/proactive-messaging.mdx","sourceDirName":"csharp/essentials/sending-messages","slug":"/csharp/essentials/sending-messages/proactive-messaging","permalink":"/teams-sdk/csharp/essentials/sending-messages/proactive-messaging","draft":false,"unlisted":false,"editUrl":"https://github.com/microsoft/teams-sdk/tree/main/teams.md/docs/main/csharp/essentials/sending-messages/proactive-messaging.mdx","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"sidebar_label":"Proactive Messaging","title":"Proactive Messaging","summary":"Learn how to send proactive messages to users without waiting for them to initiate the conversation, including storing conversation IDs and sending notifications."},"sidebar":"default","previous":{"title":"Sending Messages","permalink":"/teams-sdk/csharp/essentials/sending-messages/"},"next":{"title":"API Client","permalink":"/teams-sdk/csharp/essentials/api"}}');var a=t(62540),r=t(43023),i=t(26802),o=t(78296),c=t(22491);const l={sidebar_position:1,sidebar_label:"Proactive Messaging",title:"Proactive Messaging",summary:"Learn how to send proactive messages to users without waiting for them to initiate the conversation, including storing conversation IDs and sending notifications."},u="Proactive Messaging",d={},h=[{value:"Targeted Proactive Messages",id:"targeted-proactive-messages",level:2}];function g(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"proactive-messaging",children:"Proactive Messaging"})}),"\n",(0,a.jsxs)(n.p,{children:["In ",(0,a.jsx)(n.a,{href:"./",children:"Sending Messages"}),", you were shown how to respond to an event when it happens. However, there are times when you want to send a message to the user without them sending a message first. This is called proactive messaging. You can do this by using the ",(0,a.jsx)(n.code,{children:"send"})," method in the ",(0,a.jsx)(n.code,{children:"app"})," instance. This approach is useful for sending notifications or reminders to the user."]}),"\n",(0,a.jsxs)(n.p,{children:["The main thing to note is that you need to have the ",(0,a.jsx)(i.A,{language:"csharp",children:(0,a.jsx)(n.code,{children:"conversationId"})})," of the chat or channel that you want to send the message to. It's a good idea to store this value somewhere from an activity handler so that you can use it for proactive messaging later."]}),"\n",(0,a.jsx)(i.A,{language:"csharp",children:(0,a.jsx)(o.A,{children:(0,a.jsx)(c.A,{label:"Minimal",value:"minimal",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-csharp",children:'app.OnInstall(async context =>\n{\n    // Save the conversation id in \n    context.Storage.Set(activity.From.AadObjectId!, activity.Conversation.Id);\n    await context.Send("Hi! I am going to remind you to say something to me soon!");\n    notificationQueue.AddReminder(activity.From.AadObjectId!, Notifications.SendProactive, 10_000);\n});\n'})})})})}),"\n",(0,a.jsxs)(n.p,{children:["Then, when you want to send a proactive message, you can retrieve the ",(0,a.jsx)(i.A,{language:"csharp",children:(0,a.jsx)(n.code,{children:"conversationId"})})," from storage and use it to send the message."]}),"\n",(0,a.jsx)(i.A,{language:"csharp",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-csharp",children:'public static class Notifications\n{\n    public static async Task SendProactive(string userId)\n    {\n        var conversationId = (string?)storage.Get(userId);\n\n        if (conversationId is null) return;\n\n        await app.Send(conversationId, "Hey! It\'s been a while. How are you?");\n    }\n}\n'})})}),"\n",(0,a.jsx)(n.admonition,{type:"tip",children:(0,a.jsxs)(n.p,{children:["In this example, you see how to get the ",(0,a.jsx)(i.A,{language:"csharp",children:(0,a.jsx)(n.code,{children:"conversationId"})})," using one of the activity handlers. This is a good place to store the conversation id, but you can also do this in other places like when the user installs the app or when they sign in. The important thing is that you have the conversation id stored somewhere so you can use it later."]})}),"\n",(0,a.jsx)(n.h2,{id:"targeted-proactive-messages",children:"Targeted Proactive Messages"}),"\n",(0,a.jsx)(n.admonition,{title:"Preview",type:"info",children:(0,a.jsx)(n.p,{children:"Targeted messages are currently in preview."})}),"\n",(0,a.jsx)(n.p,{children:"Targeted messages, also known as ephemeral messages, are delivered to a specific user in a shared conversation. From a single user's perspective, it appears as regular inline messages in a conversation. Other participants won't see these messages."}),"\n",(0,a.jsx)(n.p,{children:"When sending targeted messages proactively, you must explicitly specify the recipient's user ID."}),"\n",(0,a.jsx)(i.A,{language:"csharp",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-csharp",children:'// When sending proactively, you must provide the explicit user ID\npublic static async Task SendTargetedNotification(string conversationId, string userId)\n{\n    var teams = app.UseTeams();\n    await teams.Send(\n        conversationId,\n        new MessageActivity("This is a private notification just for you!")\n            .WithTargetedRecipient(userId)\n    );\n}\n'})})})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(g,{...e})}):g(e)}},78296:(e,n,t)=>{t.d(n,{A:()=>I});var s=t(63696),a=t(11750),r=t(53237),i=t(90766),o=t(22147),c=t(14395),l=t(35043),u=t(44544),d=t(41506);function h(e){return s.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,s.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function g(e){const{values:n,children:t}=e;return(0,s.useMemo)((()=>{const e=n??function(e){return h(e).map((({props:{value:e,label:n,attributes:t,default:s}})=>({value:e,label:n,attributes:t,default:s})))}(t);return function(e){const n=(0,u.XI)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,t])}function p({value:e,tabValues:n}){return n.some((n=>n.value===e))}function m({queryString:e=!1,groupId:n}){const t=(0,o.W6)(),a=function({queryString:e=!1,groupId:n}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:e,groupId:n});return[(0,l.aZ)(a),(0,s.useCallback)((e=>{if(!a)return;const n=new URLSearchParams(t.location.search);n.set(a,e),t.replace({...t.location,search:n.toString()})}),[a,t])]}function v(e){const{defaultValue:n,queryString:t=!1,groupId:a}=e,r=g(e),[i,o]=(0,s.useState)((()=>function({defaultValue:e,tabValues:n}){if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!p({value:e,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const t=n.find((e=>e.default))??n[0];if(!t)throw new Error("Unexpected error: 0 tabValues");return t.value}({defaultValue:n,tabValues:r}))),[l,u]=m({queryString:t,groupId:a}),[h,v]=function({groupId:e}){const n=function(e){return e?`docusaurus.tab.${e}`:null}(e),[t,a]=(0,d.Dv)(n);return[t,(0,s.useCallback)((e=>{n&&a.set(e)}),[n,a])]}({groupId:a}),f=(()=>{const e=l??h;return p({value:e,tabValues:r})?e:null})();(0,c.A)((()=>{f&&o(f)}),[f]);return{selectedValue:i,selectValue:(0,s.useCallback)((e=>{if(!p({value:e,tabValues:r}))throw new Error(`Can't select invalid tab value=${e}`);o(e),u(e),v(e)}),[u,v,r]),tabValues:r}}var f=t(86681);const b={tabList:"tabList_J5MA",tabItem:"tabItem_l0OV"};var x=t(62540);function y({className:e,block:n,selectedValue:t,selectValue:s,tabValues:r}){const o=[],{blockElementScrollPositionUntilNextRender:c}=(0,i.a_)(),l=e=>{const n=e.currentTarget,a=o.indexOf(n),i=r[a].value;i!==t&&(c(n),s(i))},u=e=>{let n=null;switch(e.key){case"Enter":l(e);break;case"ArrowRight":{const t=o.indexOf(e.currentTarget)+1;n=o[t]??o[0];break}case"ArrowLeft":{const t=o.indexOf(e.currentTarget)-1;n=o[t]??o[o.length-1];break}}n?.focus()};return(0,x.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,a.A)("tabs",{"tabs--block":n},e),children:r.map((({value:e,label:n,attributes:s})=>(0,x.jsx)("li",{role:"tab",tabIndex:t===e?0:-1,"aria-selected":t===e,ref:e=>{o.push(e)},onKeyDown:u,onClick:l,...s,className:(0,a.A)("tabs__item",b.tabItem,s?.className,{"tabs__item--active":t===e}),children:n??e},e)))})}function w({lazy:e,children:n,selectedValue:t}){const r=(Array.isArray(n)?n:[n]).filter(Boolean);if(e){const e=r.find((e=>e.props.value===t));return e?(0,s.cloneElement)(e,{className:(0,a.A)("margin-top--md",e.props.className)}):null}return(0,x.jsx)("div",{className:"margin-top--md",children:r.map(((e,n)=>(0,s.cloneElement)(e,{key:n,hidden:e.props.value!==t})))})}function j(e){const n=v(e);return(0,x.jsxs)("div",{className:(0,a.A)(r.G.tabs.container,"tabs-container",b.tabList),children:[(0,x.jsx)(y,{...n,...e}),(0,x.jsx)(w,{...n,...e})]})}function I(e){const n=(0,f.A)();return(0,x.jsx)(j,{...e,children:h(e.children)},String(n))}}}]);
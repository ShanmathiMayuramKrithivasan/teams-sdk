"use strict";(self.webpackChunkteams_md=self.webpackChunkteams_md||[]).push([[2549],{30189:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>r,contentTitle:()=>p,default:()=>d,frontMatter:()=>s,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"typescript/in-depth-guides/tabs/app-options","title":"App Options","description":"\x3c!--","source":"@site/docs/main/typescript/in-depth-guides/tabs/app-options.mdx","sourceDirName":"typescript/in-depth-guides/tabs","slug":"/typescript/in-depth-guides/tabs/app-options","permalink":"/teams-sdk/typescript/in-depth-guides/tabs/app-options","draft":false,"unlisted":false,"editUrl":"https://github.com/microsoft/teams-sdk/tree/main/teams.md/docs/main/typescript/in-depth-guides/tabs/app-options.mdx","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"title":"App Options","summary":"Configure app settings for observability, MSAL authentication, and remote agent function calling.","languages":["typescript"],"suppressLanguageIncludeWarning":true},"sidebar":"default","previous":{"title":"Using the App","permalink":"/teams-sdk/typescript/in-depth-guides/tabs/using-the-app"},"next":{"title":"Microsoft Graph","permalink":"/teams-sdk/typescript/in-depth-guides/tabs/graph"}}');var a=t(62540),o=t(43023);const s={sidebar_position:3,title:"App Options",summary:"Configure app settings for observability, MSAL authentication, and remote agent function calling.",languages:["typescript"],suppressLanguageIncludeWarning:!0},p="App Options",r={},c=[{value:"Logger",id:"logger",level:2},{value:"Remote API options",id:"remote-api-options",level:2},{value:"Base URL",id:"base-url",level:3},{value:"Remote app resource",id:"remote-app-resource",level:3},{value:"MSAL options",id:"msal-options",level:2},{value:"MSAL instance and configuration",id:"msal-instance-and-configuration",level:3},{value:"Default behavior",id:"default-behavior",level:4},{value:"Providing a custom MSAL configuration",id:"providing-a-custom-msal-configuration",level:4},{value:"Providing a pre-configured MSAL IPublicClientApplication",id:"providing-a-pre-configured-msal-ipublicclientapplication",level:4},{value:"Scope consent pre-warming",id:"scope-consent-pre-warming",level:3},{value:"Default behavior",id:"default-behavior-1",level:4},{value:"Pre-warm a specific set of scopes",id:"pre-warm-a-specific-set-of-scopes",level:4},{value:"Disabling pre-warming",id:"disabling-pre-warming",level:4},{value:"References",id:"references",level:2}];function l(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"app-options",children:"App Options"})}),"\n",(0,a.jsx)(n.p,{children:"The app options offer various settings that you can use to customize observability, Microsoft Authentication Library (MSAL) configuration, and\nremote agent function calling. Each setting is optional, with the app using a reasonable default as needed."}),"\n",(0,a.jsx)(n.h2,{id:"logger",children:"Logger"}),"\n",(0,a.jsxs)(n.p,{children:["If no logger is specified in the app options, the app will create a ",(0,a.jsx)(n.a,{href:"../observability/logging",children:"ConsoleLogger"}),". You can however provide your own logger implementation to control log level and destination."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"import { App } from '@microsoft/teams.client';\nimport { ConsoleLogger } from '@microsoft/teams.common';\n\nconst app = new App(clientId, {\n  logger: new ConsoleLogger('myTabApp', { level: 'debug' }),\n});\n\nawait app.start();\n"})}),"\n",(0,a.jsx)(n.h2,{id:"remote-api-options",children:"Remote API options"}),"\n",(0,a.jsxs)(n.p,{children:["The remote API options let you control which endpoint that ",(0,a.jsx)(n.code,{children:"app.exec()"})," make a request to, as well as the default resource name to use when requesting an MSAL token to attach to the request."]}),"\n",(0,a.jsx)(n.h3,{id:"base-url",children:"Base URL"}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"baseUrl"})," value is used to provide the URL where the remote API is hosted. This can be omitted if the tab app is hosted on the same domain as the remote agent."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"import { App } from '@microsoft/teams.client';\n\nconst app = new App(clientId, {\n  remoteApiOptions: {\n    baseUrl: 'https://agent1.contoso.com',\n  },\n});\nawait app.start();\n\n// this requests a token for 'api://<clientId>/access_as_user' and attaches\n// that to a request to https://agent1.contoso.com/api/functions/my-function\nawait app.exec('my-function');\n"})}),"\n",(0,a.jsx)(n.h3,{id:"remote-app-resource",children:"Remote app resource"}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"remoteAppResource"})," value is used to control the default resource name used when building a token request for the Entra token to include when invoking the function. This can be omitted if the tab app and the remote agent app are in the same AAD app, but should be provided if they're in different apps or the agent requires scopes for a different resource than the default ",(0,a.jsx)(n.code,{children:"api://<clientId>/access_as_user"}),"."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"import { App } from '@microsoft/teams.client';\n\nconst app = new App(clientId, {\n  remoteApiOptions: {\n    baseUrl: 'https://agent1.contoso.com',\n    remoteAppResource: 'api://agent1ClientId',\n  },\n});\nawait app.start();\n\n// this requests a token for 'api://agent1ClientId/access_as_user' and attaches that\n// to a request to https://agent1.contoso.com/api/functions/my-function\nawait app.exec('my-function');\n"})}),"\n",(0,a.jsx)(n.h2,{id:"msal-options",children:"MSAL options"}),"\n",(0,a.jsx)(n.p,{children:"The MSAL options let you control how the Microsoft Authentication Library (MSAL) is initialized and used, and how the user is prompted for scope consent as the app starts."}),"\n",(0,a.jsx)(n.h3,{id:"msal-instance-and-configuration",children:"MSAL instance and configuration"}),"\n",(0,a.jsx)(n.p,{children:"You have three options to control the MSAL instance used by the app."}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Provide a pre-configured and pre-initialized MSAL IPublicClientApplication."}),"\n",(0,a.jsx)(n.li,{children:"Provide a custom MSAL configuration for the app to use when creating an MSAL IPublicClientApplication instance."}),"\n",(0,a.jsx)(n.li,{children:"Provide neither, and let the app create IPublicClientApplication from a default MSAL configuration."}),"\n"]}),"\n",(0,a.jsx)(n.h4,{id:"default-behavior",children:"Default behavior"}),"\n",(0,a.jsx)(n.p,{children:"If the app options contain neither an MSAL instance nor an MSAL configuration, the app constructs a simple MSAL configuration that is suitable for multi-tenant apps and that connects the MSAL logger callbacks to the app logger."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"import { App } from '@microsoft/teams.client';\n\nconst app = new App(clientId);\n\nawait app.start();\n// app.msalInstance is now available, and any logging is forwarded from\n// MSAL to the app.log instance.\n"})}),"\n",(0,a.jsx)(n.h4,{id:"providing-a-custom-msal-configuration",children:"Providing a custom MSAL configuration"}),"\n",(0,a.jsx)(n.p,{children:"MSAL offers a rich set of configuration options, and you can provide your own configuration as an app option."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"import * as msal from '@azure/msal-browser';\nimport { App } from '@microsoft/teams.client';\n\nconst configuration: msal.Configuration = {\n  /* custom MSAL configuration options */\n};\n\nconst app = new App(clientId, { msalOptions: { configuration } });\n\nawait app.start();\n"})}),"\n",(0,a.jsx)(n.h4,{id:"providing-a-pre-configured-msal-ipublicclientapplication",children:"Providing a pre-configured MSAL IPublicClientApplication"}),"\n",(0,a.jsx)(n.p,{children:"MSAL cautions against an app using multiple IPublicClientApp instances at the same time. If you're already using MSAL, you can provide a pre-created MSAL instance to use as an app option."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"import * as msal from '@azure/msal-browser';\nimport { App } from '@microsoft/teams.client';\n\nconst msalInstance =\n  await msal.createNestablePublicClientApplication(/* custom MSAL configuration */);\nawait msalInstance.initialize();\n\nconst app = new App(clientId, { msalOptions: { msalInstance } });\n\nawait app.start();\n"})}),"\n",(0,a.jsx)(n.p,{children:"If you need multiple app instances in order to call functions in several agents, you can re-use the MSAL instance from one as you construct another."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"import { App } from '@microsoft/teams.client';\n\n// let app1 create & initialize an MSAL IPublicClientApplication\nconst app1 = new App(clientId, {\n  remoteApiOptions: {\n    baseUrl: 'https://agent1.contoso.com',\n    remoteAppResource: 'api://agent1AppClientId',\n  },\n});\nawait app1.start();\n\n// let app2 re-use the MSAL IPublicClientApplication from app1\nconst app2 = new App(clientId, {\n  remoteApiOptions: {\n    baseUrl: 'https://agent2.contoso.com',\n    remoteAppResource: 'api://agent2AppClientId',\n  },\n  msalOptions: { msalInstance: app1.msalInstance },\n});\n"})}),"\n",(0,a.jsx)(n.h3,{id:"scope-consent-pre-warming",children:"Scope consent pre-warming"}),"\n",(0,a.jsx)(n.p,{children:"The MSAL options let you control whether and how the user is prompted to give the app permission for any necessary scope as the app starts. This option can be used to reduce the number of consent prompts the user sees while using the app, and to help make sure the app gets consent for the resource it needs to function."}),"\n",(0,a.jsx)(n.p,{children:"With this option, you can either pre-warm a specific set of scopes or disable pre-warming altogether. If no setting is provided, the default behavior is to prompt the user for the Graph scopes listed in the app manifest, unless they've already consented to at least on Graph scope."}),"\n",(0,a.jsxs)(n.p,{children:["For more details on how and when to prompt for scope consent, see the ",(0,a.jsx)(n.a,{href:"./graph",children:"Graph"})," documentation."]}),"\n",(0,a.jsx)(n.h4,{id:"default-behavior-1",children:"Default behavior"}),"\n",(0,a.jsxs)(n.p,{children:["If the app is started without specifying any option to control scope pre-warming, the ",(0,a.jsx)(n.code,{children:".default"})," scope is pre-warmed. This means that in a first-run experience, the user would be prompted to consent for all Graph permissions listed in the app manifest. However, if the user has consented to at least one Graph permission, any one at all, no prompt appears."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"import { App } from '@microsoft/teams.client';\n\nconst app = new App(clientId);\n\n// if the user hasn't already given consent for any scope at\n// all, this will prompt them\nawait app.start();\n"})}),"\n",(0,a.jsx)(n.admonition,{type:"info",children:(0,a.jsx)(n.p,{children:"The user can decline the prompt and the app will still continue to run. However, the user will again be prompted next time they launch the app."})}),"\n",(0,a.jsx)(n.h4,{id:"pre-warm-a-specific-set-of-scopes",children:"Pre-warm a specific set of scopes"}),"\n",(0,a.jsx)(n.p,{children:"If your app requires a specific set of scopes in order to run well, you can list those in the set of scopes to pre-warm."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"import { App } from '@microsoft/teams.client';\n\nconst app = new App(clientId, {\n  msalOptions: { prewarmScopes: ['User.Read', 'Chat.ReadBasic'] },\n});\n\n// if the user hasn't already given consent for each listed scope,\n// this will prompt them\nawait app.start();\n"})}),"\n",(0,a.jsx)(n.admonition,{type:"info",children:(0,a.jsx)(n.p,{children:"The user can decline the prompt and the app will still continue to run. However, the user will again be prompted next time they launch the app."})}),"\n",(0,a.jsx)(n.h4,{id:"disabling-pre-warming",children:"Disabling pre-warming"}),"\n",(0,a.jsx)(n.p,{children:"Scope pre-warming can be disabled if needed. This is useful if your app doesn't use graph APIs, or if you want more control over the consent prompt."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"import { App } from '@microsoft/teams.client';\nimport * as endpoints from '@microsoft/teams.graph-endpoints';\n\nconst app = new App(clientId, {\n  msalOptions: { prewarmScopes: false },\n});\n\n// this will not raise any consent prompt\nawait app.start();\n\n// this will prompt for the '.default' scope if the user hasn't already\n// consented to any scope\nconst top10Chats = await app.graph.call(endpoints.chats.list, { $top: 10 });\n"})}),"\n",(0,a.jsx)(n.admonition,{type:"info",children:(0,a.jsxs)(n.p,{children:["Even if pre-warming is disabled and the user is not prompted to consent, a prompt for the ",(0,a.jsx)(n.code,{children:".default"})," scope will appear when invoking any graph API."]})}),"\n",(0,a.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/entra/identity-platform/msal-client-application-configuration",children:"MSAL Configuration"})})]})}function d(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(l,{...e})}):l(e)}},43023:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>p});var i=t(63696);const a={},o=i.createContext(a);function s(e){const n=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function p(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);
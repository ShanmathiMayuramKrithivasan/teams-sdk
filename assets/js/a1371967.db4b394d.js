"use strict";(self.webpackChunkteams_md=self.webpackChunkteams_md||[]).push([[3344],{26802:(e,n,i)=>{i.d(n,{A:()=>s});var t=i(22147),a=i(62540);function s({language:e,children:n}){return(0,t.zy)().pathname.includes(`/${e}/`)?(0,a.jsx)(a.Fragment,{children:n}):null}},43023:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>r});var t=i(63696);const a={},s=t.createContext(a);function o(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),t.createElement(s.Provider,{value:n},e.children)}},95990:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>g,frontMatter:()=>r,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"csharp/in-depth-guides/dialogs/creating-dialogs","title":"Creating Dialogs","description":"\x3c!--","source":"@site/docs/main/csharp/in-depth-guides/dialogs/creating-dialogs.mdx","sourceDirName":"csharp/in-depth-guides/dialogs","slug":"/csharp/in-depth-guides/dialogs/creating-dialogs","permalink":"/teams-sdk/csharp/in-depth-guides/dialogs/creating-dialogs","draft":false,"unlisted":false,"editUrl":"https://github.com/microsoft/teams-sdk/tree/main/teams.md/docs/main/csharp/in-depth-guides/dialogs/creating-dialogs.mdx","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"sidebar_label":"Creating Dialogs","title":"Creating Dialogs"},"sidebar":"default","previous":{"title":"Dialogs","permalink":"/teams-sdk/csharp/in-depth-guides/dialogs/"},"next":{"title":"Handling Dialog Submissions","permalink":"/teams-sdk/csharp/in-depth-guides/dialogs/handling-dialog-submissions"}}');var a=i(62540),s=i(43023),o=i(26802);const r={sidebar_position:1,sidebar_label:"Creating Dialogs",title:"Creating Dialogs"},l="Creating Dialogs",d={},c=[{value:"Entry Point",id:"entry-point",level:2},{value:"Handling Dialog Open Events",id:"handling-dialog-open-events",level:2},{value:"Rendering A Card",id:"rendering-a-card",level:3},{value:"Rendering A Webpage",id:"rendering-a-webpage",level:3},{value:"Setting up Embedded Web Content",id:"setting-up-embedded-web-content",level:3}];function p(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"creating-dialogs",children:"Creating Dialogs"})}),"\n",(0,a.jsx)(n.admonition,{type:"tip",children:(0,a.jsxs)(n.p,{children:["If you're not familiar with how to build Adaptive Cards, check out ",(0,a.jsx)(n.a,{href:"../adaptive-cards",children:"the cards guide"}),". Understanding their basics is a prerequisite for this guide."]})}),"\n",(0,a.jsx)(n.h2,{id:"entry-point",children:"Entry Point"}),"\n",(0,a.jsx)(o.A,{language:"csharp",children:(0,a.jsxs)(n.p,{children:["To open a dialog, you need to supply a special type of action to the Adaptive Card. The ",(0,a.jsx)(n.code,{children:"TaskFetchAction"})," is specifically designed for this purpose - it automatically sets up the proper Teams data structure to trigger a dialog. Once this button is clicked, the dialog will open and ask the application what to show."]})}),"\n",(0,a.jsx)(o.A,{language:"csharp",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-csharp",children:'using Microsoft.Teams.Api.Activities;\nusing Microsoft.Teams.Apps;\nusing Microsoft.Teams.Apps.Annotations;\nusing Microsoft.Teams.Cards;\nusing Microsoft.Teams.Common.Logging;\n\n//...\n\n[Message]\npublic async Task OnMessage([Context] MessageActivity activity, [Context] IContext.Client client, [Context] ILogger log)\n{\n    // Create the launcher adaptive card\n    var card = CreateDialogLauncherCard();\n    await client.Send(card);\n}\n\nprivate static AdaptiveCard CreateDialogLauncherCard()\n{\n    var card = new AdaptiveCard\n    {\n        Body = new List<CardElement>\n        {\n            new TextBlock("Select the examples you want to see!")\n            {\n                Size = TextSize.Large,\n                Weight = TextWeight.Bolder\n            }\n        },\n        Actions = new List<Action>\n        {\n            new TaskFetchAction(new { opendialogtype = "simple_form" })\n            {\n                Title = "Simple form test"\n            },\n            new TaskFetchAction(new { opendialogtype = "webpage_dialog" })\n            {\n                Title = "Webpage Dialog"\n            },\n            new TaskFetchAction(new { opendialogtype = "multi_step_form" })\n            {\n                Title = "Multi-step Form"\n            }\n        }\n    };\n\n    return card;\n}\n'})})}),"\n",(0,a.jsx)(n.h2,{id:"handling-dialog-open-events",children:"Handling Dialog Open Events"}),"\n",(0,a.jsx)(o.A,{language:"csharp",children:(0,a.jsxs)(n.p,{children:["Once an action is executed to open a dialog, the Teams client will send an event to the agent to request what the content of the dialog should be. When using ",(0,a.jsx)(n.code,{children:"TaskFetchAction"}),", the data is nested inside an ",(0,a.jsx)(n.code,{children:"MsTeams"})," property structure."]})}),"\n",(0,a.jsx)(o.A,{language:"csharp",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-csharp",children:'using System.Text.Json;\nusing Microsoft.Teams.Api.TaskModules;\nusing Microsoft.Teams.Apps;\nusing Microsoft.Teams.Apps.Activities.Invokes;\nusing Microsoft.Teams.Apps.Annotations;\nusing Microsoft.Teams.Common.Logging;\n\n//...\n\n[TaskFetch]\npublic Microsoft.Teams.Api.TaskModules.Response OnTaskFetch([Context] Tasks.FetchActivity activity, [Context] IContext.Client client, [Context] ILogger log)\n{\n    var data = activity.Value?.Data as JsonElement?;\n    if (data == null)\n    {\n        log.Info("[TASK_FETCH] No data found in the activity value");\n        return new Microsoft.Teams.Api.TaskModules.Response(\n            new Microsoft.Teams.Api.TaskModules.MessageTask("No data found in the activity value"));\n    }\n\n    var dialogType = data.Value.TryGetProperty("opendialogtype", out var dialogTypeElement) && dialogTypeElement.ValueKind == JsonValueKind.String\n        ? dialogTypeElement.GetString()\n        : null;\n\n    log.Info($"[TASK_FETCH] Dialog type: {dialogType}");\n\n    return dialogType switch\n    {\n        "simple_form" => CreateSimpleFormDialog(),\n        "webpage_dialog" => CreateWebpageDialog(_configuration, log),\n        "multi_step_form" => CreateMultiStepFormDialog(),\n        "mixed_example" => CreateMixedExampleDialog(),\n        _ => new Microsoft.Teams.Api.TaskModules.Response(\n            new Microsoft.Teams.Api.TaskModules.MessageTask("Unknown dialog type"))\n    };\n}\n'})})}),"\n",(0,a.jsx)(n.h3,{id:"rendering-a-card",children:"Rendering A Card"}),"\n",(0,a.jsx)(n.p,{children:"You can render an Adaptive Card in a dialog by returning a card response."}),"\n",(0,a.jsx)(o.A,{language:"csharp",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-csharp",children:'using System.Text.Json;\nusing Microsoft.Teams.Api;\nusing Microsoft.Teams.Api.TaskModules;\nusing Microsoft.Teams.Cards;\n\n//...\n\nprivate static Microsoft.Teams.Api.TaskModules.Response CreateSimpleFormDialog()\n{\n    var choices = new List<Choice>\n    {\n        new Choice { Title = "Option 1", Value = "opt1" },\n        new Choice { Title = "Option 2", Value = "opt2" },\n        new Choice { Title = "Option 3", Value = "opt3" }\n    };\n\n    var dialogCard = new AdaptiveCard\n    {\n        Body = new List<CardElement>\n        {\n            new TextBlock("This is a simple form")\n            {\n                Size = TextSize.Large,\n                Weight = TextWeight.Bolder\n            },\n            new TextInput\n            {\n                Id = "name",\n                Label = "Name",\n                Placeholder = "Enter your name",\n                IsRequired = true\n            },\n            new ChoiceSetInput\n            {\n                Id = "preference",\n                Label = "Select your preference",\n                Choices = choices,\n                Style = StyleEnum.Compact\n            }\n        },\n        Actions = new List<Action>\n        {\n            new SubmitAction\n            {\n                Title = "Submit",\n                Data = new { submissiondialogtype = "simple_form" }\n            }\n        }\n    };\n\n    var taskInfo = new TaskInfo\n    {\n        Title = "Simple Form Dialog",\n        Card = new Attachment\n        {\n            ContentType = new ContentType("application/vnd.microsoft.card.adaptive"),\n            Content = dialogCard\n        }\n    };\n\n    return new Microsoft.Teams.Api.TaskModules.Response(\n        new Microsoft.Teams.Api.TaskModules.ContinueTask(taskInfo));\n}\n'})})}),"\n",(0,a.jsx)(n.admonition,{type:"info",children:(0,a.jsxs)(n.p,{children:["The action type for submitting a dialog must be ",(0,a.jsx)(n.code,{children:"Action.Submit"}),". This is a requirement of the Teams client. If you use a different action type, the dialog will not be submitted and the agent will not receive the submission event."]})}),"\n",(0,a.jsx)(n.h3,{id:"rendering-a-webpage",children:"Rendering A Webpage"}),"\n",(0,a.jsx)(n.p,{children:"You can render a webpage in a dialog as well. There are some security requirements to be aware of:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["The webpage must be hosted on a domain that is allow-listed as ",(0,a.jsx)(n.code,{children:"validDomains"})," in the Teams app ",(0,a.jsx)(n.a,{href:"/teams/manifest",children:"manifest"})," for the agent"]}),"\n",(0,a.jsxs)(n.li,{children:["The webpage must also host the ",(0,a.jsx)(n.a,{href:"https://www.npmjs.com/package/@microsoft/teams-js",children:"teams-js client library"}),". The reason for this is that for security purposes, the Teams client will not render arbitrary webpages. As such, the webpage must explicitly opt-in to being rendered in the Teams client. Setting up the teams-js client library handles this for you."]}),"\n"]}),"\n",(0,a.jsx)(o.A,{language:"csharp",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-csharp",children:'using Microsoft.Teams.Api.TaskModules;\nusing Microsoft.Teams.Common;\n\n//...\n\nprivate static Microsoft.Teams.Api.TaskModules.Response CreateWebpageDialog(IConfiguration configuration, ILogger log)\n{\n    var botEndpoint = configuration["BotEndpoint"];\n    if (string.IsNullOrEmpty(botEndpoint))\n    {\n        log.Warn("No remote endpoint detected. Using webpages for dialog will not work as expected");\n        botEndpoint = "http://localhost:3978"; // Fallback for local development\n    }\n    else\n    {\n        log.Info($"Using BotEndpoint: {botEndpoint}/tabs/dialog-form");\n    }\n\n    var taskInfo = new TaskInfo\n    {\n        Title = "Webpage Dialog",\n        Width = new Union<int, Size>(1000),\n        Height = new Union<int, Size>(800),\n        // Here we are using a webpage that is hosted in the same\n        // server as the agent. This server needs to be publicly accessible,\n        // needs to set up teams.js client library (https://www.npmjs.com/package/@microsoft/teams-js)\n        // and needs to be registered in the manifest.\n        Url = $"{botEndpoint}/tabs/dialog-form"\n    };\n\n    return new Microsoft.Teams.Api.TaskModules.Response(\n        new Microsoft.Teams.Api.TaskModules.ContinueTask(taskInfo));\n}\n'})})}),"\n",(0,a.jsxs)(o.A,{language:"csharp",children:[(0,a.jsx)(n.h3,{id:"setting-up-embedded-web-content",children:"Setting up Embedded Web Content"}),(0,a.jsxs)(n.p,{children:["To serve web content for dialogs, you can use the ",(0,a.jsx)(n.code,{children:"AddTab"})," functionality to embed HTML files as resources:"]}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-csharp",children:'// In Program.cs when building your app\napp.UseTeams();\napp.AddTab("dialog-form", "Web/dialog-form");\n\n// Configure project file to embed web resources\n// In .csproj:\n// <GenerateEmbeddedFilesManifest>true</GenerateEmbeddedFilesManifest>\n// <EmbeddedResource Include="Web/**" />\n// <Content Remove="Web/**" />\n'})})]})]})}function g(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(p,{...e})}):p(e)}}}]);
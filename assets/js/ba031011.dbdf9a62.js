"use strict";(self.webpackChunkteams_md=self.webpackChunkteams_md||[]).push([[1726],{26802:(e,s,n)=>{n.d(s,{A:()=>t});var i=n(22147),a=n(62540);function t({language:e,children:s}){return(0,i.zy)().pathname.includes(`/${e}/`)?(0,a.jsx)(a.Fragment,{children:s}):null}},43023:(e,s,n)=>{n.d(s,{R:()=>o,x:()=>l});var i=n(63696);const a={},t=i.createContext(a);function o(e){const s=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),i.createElement(t.Provider,{value:s},e.children)}},63231:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>d,contentTitle:()=>r,default:()=>c,frontMatter:()=>l,metadata:()=>i,toc:()=>m});const i=JSON.parse('{"id":"csharp/in-depth-guides/dialogs/handling-dialog-submissions","title":"Handling Dialog Submissions","description":"\x3c!--","source":"@site/docs/main/csharp/in-depth-guides/dialogs/handling-dialog-submissions.mdx","sourceDirName":"csharp/in-depth-guides/dialogs","slug":"/csharp/in-depth-guides/dialogs/handling-dialog-submissions","permalink":"/teams-sdk/csharp/in-depth-guides/dialogs/handling-dialog-submissions","draft":false,"unlisted":false,"editUrl":"https://github.com/microsoft/teams-sdk/tree/main/teams.md/docs/main/csharp/in-depth-guides/dialogs/handling-dialog-submissions.mdx","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"sidebar_label":"Handling Dialog Submissions","title":"Handling Dialog Submissions","summary":"Guide to processing dialog submissions in Teams applications, showing how to handle form data from both Adaptive Cards and web pages using dialog submission event handlers."},"sidebar":"default","previous":{"title":"Creating Dialogs","permalink":"/teams-sdk/csharp/in-depth-guides/dialogs/creating-dialogs"},"next":{"title":"Handling Multi-Step Forms","permalink":"/teams-sdk/csharp/in-depth-guides/dialogs/handling-multi-step-forms"}}');var a=n(62540),t=n(43023),o=n(26802);const l={sidebar_position:2,sidebar_label:"Handling Dialog Submissions",title:"Handling Dialog Submissions",summary:"Guide to processing dialog submissions in Teams applications, showing how to handle form data from both Adaptive Cards and web pages using dialog submission event handlers."},r="Handling Dialog Submissions",d={},m=[{value:"Basic Example",id:"basic-example",level:2},{value:"Complete TaskSubmit Handler Example",id:"complete-tasksubmit-handler-example",level:3}];function u(e){const s={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",strong:"strong",...(0,t.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s.header,{children:(0,a.jsx)(s.h1,{id:"handling-dialog-submissions",children:"Handling Dialog Submissions"})}),"\n",(0,a.jsxs)(o.A,{language:"csharp",children:[(0,a.jsxs)(s.p,{children:["Dialogs have a specific ",(0,a.jsx)(s.code,{children:"TaskSubmit"})," event to handle submissions. When a user submits a form inside a dialog, the app is notified via this event, which is then handled to process the submission values, and can either send a response or proceed to more steps in the dialogs (see ",(0,a.jsx)(s.a,{href:"./handling-multi-step-forms",children:"Multi-step Dialogs"}),")."]}),(0,a.jsx)(s.admonition,{title:"Return Type Requirement",type:"warning",children:(0,a.jsxs)(s.p,{children:["Methods decorated with ",(0,a.jsx)(s.code,{children:"[TaskSubmit]"})," ",(0,a.jsx)(s.strong,{children:"must"})," return ",(0,a.jsx)(s.code,{children:"Task<Microsoft.Teams.Api.TaskModules.Response>"}),". Every code path must return a Response object containing either a ",(0,a.jsx)(s.code,{children:"MessageTask"})," (to show a message and close the dialog) or a ",(0,a.jsx)(s.code,{children:"ContinueTask"})," (to show another dialog). Using just ",(0,a.jsx)(s.code,{children:"Task"})," or ",(0,a.jsx)(s.code,{children:"void"})," will compile but fail at runtime when the Teams client expects a Response object."]})}),(0,a.jsx)(s.h2,{id:"basic-example",children:"Basic Example"})]}),"\n",(0,a.jsx)(s.p,{children:"In this example, we show how to handle dialog submissions from an Adaptive Card form:"}),"\n",(0,a.jsx)(o.A,{language:"csharp",children:(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-csharp",children:'using System.Text.Json;\nusing Microsoft.Teams.Api.TaskModules;\nusing Microsoft.Teams.Apps;\nusing Microsoft.Teams.Apps.Activities.Invokes;\nusing Microsoft.Teams.Apps.Annotations;\nusing Microsoft.Teams.Common.Logging;\n\n//...\n\n[TaskSubmit]\npublic async Task<Microsoft.Teams.Api.TaskModules.Response> OnTaskSubmit([Context] Tasks.SubmitActivity activity, [Context] IContext.Client client, [Context] ILogger log)\n{\n    var data = activity.Value?.Data as JsonElement?;\n    if (data == null)\n    {\n        log.Info("[TASK_SUBMIT] No data found in the activity value");\n        return new Microsoft.Teams.Api.TaskModules.Response(\n            new Microsoft.Teams.Api.TaskModules.MessageTask("No data found in the activity value"));\n    }\n\n    var submissionType = data.Value.TryGetProperty("submissiondialogtype", out var submissionTypeObj) && submissionTypeObj.ValueKind == JsonValueKind.String\n        ? submissionTypeObj.ToString()\n        : null;\n\n\n    string? GetFormValue(string key)\n    {\n        if (data.Value.TryGetProperty(key, out var val))\n        {\n            if (val is JsonElement element)\n                return element.GetString();\n            return val.ToString();\n        }\n        return null;\n    }\n\n    switch (submissionType)\n    {\n        case "simple_form":\n            var name = GetFormValue("name") ?? "Unknown";\n            await client.Send($"Hi {name}, thanks for submitting the form!");\n            return new Microsoft.Teams.Api.TaskModules.Response(\n                new Microsoft.Teams.Api.TaskModules.MessageTask("Form was submitted"));\n        // More examples below\n        default:\n            return new Microsoft.Teams.Api.TaskModules.Response(\n                new Microsoft.Teams.Api.TaskModules.MessageTask("Unknown submission type"));\n    }\n}\n'})})}),"\n",(0,a.jsx)(s.p,{children:"Similarly, handling dialog submissions from rendered webpages is also possible:"}),"\n",(0,a.jsx)(o.A,{language:"csharp",children:(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-csharp",children:'// Add this case to the switch statement in OnTaskSubmit method\ncase "webpage_dialog":\n    var webName = GetFormValue("name") ?? "Unknown";\n    var email = GetFormValue("email") ?? "No email";\n    await client.Send($"Hi {webName}, thanks for submitting the form! We got that your email is {email}");\n    return new Microsoft.Teams.Api.TaskModules.Response(\n        new Microsoft.Teams.Api.TaskModules.MessageTask("Form submitted successfully"));\n'})})}),"\n",(0,a.jsxs)(o.A,{language:"csharp",children:[(0,a.jsx)(s.h3,{id:"complete-tasksubmit-handler-example",children:"Complete TaskSubmit Handler Example"}),(0,a.jsx)(s.p,{children:"Here's the complete example showing how to handle multiple submission types:"}),(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-csharp",children:'using System.Text.Json;\nusing Microsoft.Teams.Api.TaskModules;\nusing Microsoft.Teams.Apps;\nusing Microsoft.Teams.Apps.Activities.Invokes;\nusing Microsoft.Teams.Apps.Annotations;\nusing Microsoft.Teams.Common.Logging;\n\n//...\n\n[TaskSubmit]\npublic async Task<Microsoft.Teams.Api.TaskModules.Response> OnTaskSubmit([Context] Tasks.SubmitActivity activity, [Context] IContext.Client client, [Context] ILogger log)\n{\n    var data = activity.Value?.Data as JsonElement?;\n    if (data == null)\n    {\n        log.Info("[TASK_SUBMIT] No data found in the activity value");\n        return new Microsoft.Teams.Api.TaskModules.Response(\n            new Microsoft.Teams.Api.TaskModules.MessageTask("No data found in the activity value"));\n    }\n\n    var submissionType = data.Value.TryGetProperty("submissiondialogtype", out var submissionTypeObj) && submissionTypeObj.ValueKind == JsonValueKind.String\n        ? submissionTypeObj.ToString()\n        : null;\n\n    string? GetFormValue(string key)\n    {\n        if (data.Value.TryGetProperty(key, out var val))\n        {\n            if (val is JsonElement element)\n                return element.GetString();\n            return val.ToString();\n        }\n        return null;\n    }\n\n    switch (submissionType)\n    {\n        case "simple_form":\n            var name = GetFormValue("name") ?? "Unknown";\n            await client.Send($"Hi {name}, thanks for submitting the form!");\n            return new Microsoft.Teams.Api.TaskModules.Response(\n                new Microsoft.Teams.Api.TaskModules.MessageTask("Form was submitted"));\n\n        case "webpage_dialog":\n            var webName = GetFormValue("name") ?? "Unknown";\n            var email = GetFormValue("email") ?? "No email";\n            await client.Send($"Hi {webName}, thanks for submitting the form! We got that your email is {email}");\n            return new Microsoft.Teams.Api.TaskModules.Response(\n                new Microsoft.Teams.Api.TaskModules.MessageTask("Form submitted successfully"));\n\n        default:\n            return new Microsoft.Teams.Api.TaskModules.Response(\n                new Microsoft.Teams.Api.TaskModules.MessageTask("Unknown submission type"));\n    }\n}\n'})})]})]})}function c(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,a.jsx)(s,{...e,children:(0,a.jsx)(u,{...e})}):u(e)}}}]);
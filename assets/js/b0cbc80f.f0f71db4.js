"use strict";(self.webpackChunkteams_md=self.webpackChunkteams_md||[]).push([[9437],{26802:(e,n,t)=>{t.d(n,{A:()=>s});var a=t(22147),i=t(62540);function s({language:e,children:n}){return(0,a.zy)().pathname.includes(`/${e}/`)?(0,i.jsx)(i.Fragment,{children:n}):null}},43023:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>r});var a=t(63696);const i={},s=a.createContext(i);function o(e){const n=a.useContext(s);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),a.createElement(s.Provider,{value:n},e.children)}},47678:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>u,frontMatter:()=>r,metadata:()=>a,toc:()=>p});const a=JSON.parse('{"id":"csharp/in-depth-guides/dialogs/handling-multi-step-forms","title":"Handling Multi-Step Forms","description":"\x3c!--","source":"@site/docs/main/csharp/in-depth-guides/dialogs/handling-multi-step-forms.mdx","sourceDirName":"csharp/in-depth-guides/dialogs","slug":"/csharp/in-depth-guides/dialogs/handling-multi-step-forms","permalink":"/teams-sdk/csharp/in-depth-guides/dialogs/handling-multi-step-forms","draft":false,"unlisted":false,"editUrl":"https://github.com/microsoft/teams-sdk/tree/main/teams.md/docs/main/csharp/in-depth-guides/dialogs/handling-multi-step-forms.mdx","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"sidebar_label":"Handling Multi-Step Forms","title":"Handling Multi-Step Forms","summary":"Tutorial on implementing multi-step dialogs in Teams, demonstrating how to create dynamic form flows that adapt based on user input, with examples of handling state between steps and conditional navigation."},"sidebar":"default","previous":{"title":"Handling Dialog Submissions","permalink":"/teams-sdk/csharp/in-depth-guides/dialogs/handling-dialog-submissions"},"next":{"title":"Message Extensions","permalink":"/teams-sdk/csharp/in-depth-guides/message-extensions/"}}');var i=t(62540),s=t(43023),o=t(26802);const r={sidebar_position:3,sidebar_label:"Handling Multi-Step Forms",title:"Handling Multi-Step Forms",summary:"Tutorial on implementing multi-step dialogs in Teams, demonstrating how to create dynamic form flows that adapt based on user input, with examples of handling state between steps and conditional navigation."},l="Handling Multi-Step Forms",d={},p=[{value:"Creating the Initial Dialog",id:"creating-the-initial-dialog",level:2},{value:"Complete Multi-Step Form Handler",id:"complete-multi-step-form-handler",level:3}];function m(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"handling-multi-step-forms",children:"Handling Multi-Step Forms"})}),"\n",(0,i.jsx)(n.p,{children:"Dialogs can become complex yet powerful with multi-step forms. These forms can alter the flow of the survey depending on the user's input or customize subsequent steps based on previous answers."}),"\n",(0,i.jsxs)(o.A,{language:"csharp",children:[(0,i.jsx)(n.h2,{id:"creating-the-initial-dialog",children:"Creating the Initial Dialog"}),(0,i.jsxs)(n.p,{children:["Start off by sending an initial card in the ",(0,i.jsx)(n.code,{children:"TaskFetch"})," event."]})]}),"\n",(0,i.jsx)(o.A,{language:"csharp",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:'using System.Text.Json;\nusing Microsoft.Teams.Api;\nusing Microsoft.Teams.Api.TaskModules;\nusing Microsoft.Teams.Cards;\n\n//...\n\nprivate static Response CreateMultiStepFormDialog()\n{\n    var cardJson = """\n    {\n        "type": "AdaptiveCard",\n        "version": "1.4",\n        "body": [\n            {\n                "type": "TextBlock",\n                "text": "This is a multi-step form",\n                "size": "Large",\n                "weight": "Bolder"\n            },\n            {\n                "type": "Input.Text",\n                "id": "name",\n                "label": "Name",\n                "placeholder": "Enter your name",\n                "isRequired": true\n            }\n        ],\n        "actions": [\n            {\n                "type": "Action.Submit",\n                "title": "Submit",\n                "data": {"submissiondialogtype": "webpage_dialog_step_1"}\n            }\n        ]\n    }\n    """;\n\n    var dialogCard = JsonSerializer.Deserialize<AdaptiveCard>(cardJson)\n        ?? throw new InvalidOperationException("Failed to deserialize multi-step form card");\n\n    var taskInfo = new TaskInfo\n    {\n        Title = "Multi-step Form Dialog",\n        Card = new Attachment\n        {\n            ContentType = new ContentType("application/vnd.microsoft.card.adaptive"),\n            Content = dialogCard\n        }\n    };\n\n    return new Response(new ContinueTask(taskInfo));\n}\n'})})}),"\n",(0,i.jsxs)(o.A,{language:"csharp",children:[(0,i.jsxs)(n.p,{children:["Then in the submission handler, you can choose to ",(0,i.jsx)(n.code,{children:"continue"})," the dialog with a different card."]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:'using System.Text.Json;\nusing Microsoft.Teams.Api;\nusing Microsoft.Teams.Api.TaskModules;\nusing Microsoft.Teams.Cards;\n\n//...\n\n// Add these cases to your OnTaskSubmit method\ncase "webpage_dialog_step_1":\n    var nameStep1 = GetFormValue("name") ?? "Unknown";\n    var nextStepCardJson = $$"""\n    {\n        "type": "AdaptiveCard",\n        "version": "1.4",\n        "body": [\n            {\n                "type": "TextBlock",\n                "text": "Email",\n                "size": "Large",\n                "weight": "Bolder"\n            },\n            {\n                "type": "Input.Text",\n                "id": "email",\n                "label": "Email",\n                "placeholder": "Enter your email",\n                "isRequired": true\n            }\n        ],\n        "actions": [\n            {\n                "type": "Action.Submit",\n                "title": "Submit",\n                "data": {"submissiondialogtype": "webpage_dialog_step_2", "name": "{{nameStep1}}"}\n            }\n        ]\n    }\n    """;\n\n    var nextStepCard = JsonSerializer.Deserialize<AdaptiveCard>(nextStepCardJson)\n        ?? throw new InvalidOperationException("Failed to deserialize next step card");\n\n    var nextStepTaskInfo = new TaskInfo\n    {\n        Title = $"Thanks {nameStep1} - Get Email",\n        Card = new Attachment\n        {\n            ContentType = new ContentType("application/vnd.microsoft.card.adaptive"),\n            Content = nextStepCard\n        }\n    };\n\n    return new Response(new ContinueTask(nextStepTaskInfo));\n\ncase "webpage_dialog_step_2":\n    var nameStep2 = GetFormValue("name") ?? "Unknown";\n    var emailStep2 = GetFormValue("email") ?? "No email";\n    await client.Send($"Hi {nameStep2}, thanks for submitting the form! We got that your email is {emailStep2}");\n    return new Response(new MessageTask("Multi-step form completed successfully"));\n'})})]}),"\n",(0,i.jsxs)(o.A,{language:"csharp",children:[(0,i.jsx)(n.h3,{id:"complete-multi-step-form-handler",children:"Complete Multi-Step Form Handler"}),(0,i.jsx)(n.p,{children:"Here's the complete example showing how to handle a multi-step form:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:'using System.Text.Json;\nusing Microsoft.Teams.Api;\nusing Microsoft.Teams.Api.TaskModules;\nusing Microsoft.Teams.Apps;\nusing Microsoft.Teams.Apps.Activities.Invokes;\nusing Microsoft.Teams.Apps.Annotations;\nusing Microsoft.Teams.Cards;\nusing Microsoft.Teams.Common.Logging;\n\n//...\n\n[TaskSubmit]\npublic async Task<Response> OnTaskSubmit([Context] Tasks.SubmitActivity activity, [Context] IContext.Client client, [Context] ILogger log)\n{\n    log.Info("[TASK_SUBMIT] Task submit request received");\n\n    var data = activity.Value?.Data as JsonElement?;\n    if (data == null)\n    {\n        log.Info("[TASK_SUBMIT] No data found in the activity value");\n        return new Response(new MessageTask("No data found in the activity value"));\n    }\n\n    var submissionType = data.Value.TryGetProperty("submissiondialogtype", out var submissionTypeObj) && submissionTypeObj.ValueKind == JsonValueKind.String\n        ? submissionTypeObj.ToString()\n        : null;\n\n    log.Info($"[TASK_SUBMIT] Submission type: {submissionType}");\n\n    string? GetFormValue(string key)\n    {\n        if (data.Value.TryGetProperty(key, out var val))\n        {\n            if (val is JsonElement element)\n                return element.GetString();\n            return val.ToString();\n        }\n        return null;\n    }\n\n    switch (submissionType)\n    {\n        case "webpage_dialog_step_1":\n            var nameStep1 = GetFormValue("name") ?? "Unknown";\n            var nextStepCardJson = $$"""\n            {\n                "type": "AdaptiveCard",\n                "version": "1.4",\n                "body": [\n                    {\n                        "type": "TextBlock",\n                        "text": "Email",\n                        "size": "Large",\n                        "weight": "Bolder"\n                    },\n                    {\n                        "type": "Input.Text",\n                        "id": "email",\n                        "label": "Email",\n                        "placeholder": "Enter your email",\n                        "isRequired": true\n                    }\n                ],\n                "actions": [\n                    {\n                        "type": "Action.Submit",\n                        "title": "Submit",\n                        "data": {"submissiondialogtype": "webpage_dialog_step_2", "name": "{{nameStep1}}"}\n                    }\n                ]\n            }\n            """;\n\n            var nextStepCard = JsonSerializer.Deserialize<AdaptiveCard>(nextStepCardJson)\n                ?? throw new InvalidOperationException("Failed to deserialize next step card");\n\n            var nextStepTaskInfo = new TaskInfo\n            {\n                Title = $"Thanks {nameStep1} - Get Email",\n                Card = new Attachment\n                {\n                    ContentType = new ContentType("application/vnd.microsoft.card.adaptive"),\n                    Content = nextStepCard\n                }\n            };\n\n            return new Response(new ContinueTask(nextStepTaskInfo));\n\n        case "webpage_dialog_step_2":\n            var nameStep2 = GetFormValue("name") ?? "Unknown";\n            var emailStep2 = GetFormValue("email") ?? "No email";\n            await client.Send($"Hi {nameStep2}, thanks for submitting the form! We got that your email is {emailStep2}");\n            return new Response(new MessageTask("Multi-step form completed successfully"));\n\n        default:\n            return new Response(new MessageTask("Unknown submission type"));\n    }\n}\n'})})]})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(m,{...e})}):m(e)}}}]);
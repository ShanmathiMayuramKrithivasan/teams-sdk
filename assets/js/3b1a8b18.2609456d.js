"use strict";(self.webpackChunkteams_md=self.webpackChunkteams_md||[]).push([[9883],{26802:(e,n,t)=>{t.d(n,{A:()=>s});var a=t(22147),i=t(62540);function s({language:e,children:n}){return(0,a.zy)().pathname.includes(`/${e}/`)?(0,i.jsx)(i.Fragment,{children:n}):null}},43023:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>d});var a=t(63696);const i={},s=a.createContext(i);function o(e){const n=a.useContext(s);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),a.createElement(s.Provider,{value:n},e.children)}},54348:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>h,frontMatter:()=>d,metadata:()=>a,toc:()=>c});const a=JSON.parse('{"id":"python/in-depth-guides/dialogs/creating-dialogs","title":"Creating Dialogs","description":"\x3c!--","source":"@site/docs/main/python/in-depth-guides/dialogs/creating-dialogs.mdx","sourceDirName":"python/in-depth-guides/dialogs","slug":"/python/in-depth-guides/dialogs/creating-dialogs","permalink":"/teams-sdk/python/in-depth-guides/dialogs/creating-dialogs","draft":false,"unlisted":false,"editUrl":"https://github.com/microsoft/teams-sdk/tree/main/teams.md/docs/main/python/in-depth-guides/dialogs/creating-dialogs.mdx","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"sidebar_label":"Creating Dialogs","title":"Creating Dialogs"},"sidebar":"default","previous":{"title":"Dialogs","permalink":"/teams-sdk/python/in-depth-guides/dialogs/"},"next":{"title":"Handling Dialog Submissions","permalink":"/teams-sdk/python/in-depth-guides/dialogs/handling-dialog-submissions"}}');var i=t(62540),s=t(43023),o=t(26802);const d={sidebar_position:1,sidebar_label:"Creating Dialogs",title:"Creating Dialogs"},r="Creating Dialogs",l={},c=[{value:"Entry Point",id:"entry-point",level:2},{value:"Handling Dialog Open Events",id:"handling-dialog-open-events",level:2},{value:"Rendering A Card",id:"rendering-a-card",level:3},{value:"Rendering A Webpage",id:"rendering-a-webpage",level:3},{value:"Setting up Embedded Web Content",id:"setting-up-embedded-web-content",level:3}];function p(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"creating-dialogs",children:"Creating Dialogs"})}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsxs)(n.p,{children:["If you're not familiar with how to build Adaptive Cards, check out ",(0,i.jsx)(n.a,{href:"../adaptive-cards",children:"the cards guide"}),". Understanding their basics is a prerequisite for this guide."]})}),"\n",(0,i.jsx)(n.h2,{id:"entry-point",children:"Entry Point"}),"\n",(0,i.jsx)(o.A,{language:"python",children:(0,i.jsx)(n.p,{children:"To open a dialog, you need to supply a special type of action as to the Adaptive Card. Once this button is clicked, the dialog will open and ask the application what to show."})}),"\n",(0,i.jsx)(o.A,{language:"python",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'from microsoft_teams.api import MessageActivity, MessageActivityInput, TypingActivityInput\nfrom microsoft_teams.apps import ActivityContext\nfrom microsoft_teams.cards import AdaptiveCard, TextBlock, TaskFetchAction\n# ...\n\n@app.on_message\nasync def handle_message(ctx: ActivityContext[MessageActivity]):\n    await ctx.reply(TypingActivityInput())\n\n    card = AdaptiveCard(\n        schema="http://adaptivecards.io/schemas/adaptive-card.json",\n        body=[\n            TextBlock(\n                text="Select the examples you want to see!",\n                size="Large",\n                weight="Bolder",\n            )\n        ]\n    ).with_actions([\n        # Special type of action to open a dialog\n        TaskFetchAction(value={"OpenDialogType": "webpage_dialog"}).with_title("Webpage Dialog"),\n        # This data will be passed back in an event, so we can handle what to show in the dialog\n        TaskFetchAction(value={"OpenDialogType": "multi_step_form"}).with_title("Multi-step Form"),\n        TaskFetchAction(value={"OpenDialogType": "mixed_example"}).with_title("Mixed Example")\n    ])\n    # Send the card as an attachment\n    message = MessageActivityInput(text="Enter this form").add_card(card)\n    await ctx.send(message)\n'})})}),"\n",(0,i.jsx)(n.h2,{id:"handling-dialog-open-events",children:"Handling Dialog Open Events"}),"\n",(0,i.jsx)(o.A,{language:"python",children:(0,i.jsx)(n.p,{children:"Once an action is executed to open a dialog, the Teams client will send an event to the agent to request what the content of the dialog should be. Here is how to handle this event:"})}),"\n",(0,i.jsx)(o.A,{language:"python",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'@app.on_dialog_open\nasync def handle_dialog_open(ctx: ActivityContext[TaskFetchInvokeActivity]):\n    """Handle dialog open events for all dialog types."""\n    card = AdaptiveCard(...)\n\n    # Return an object with the task value that renders a card\n    return InvokeResponse(\n                body=TaskModuleResponse(\n                    task=TaskModuleContinueResponse(\n                        value=CardTaskModuleTaskInfo(\n                            title="Title of Dialog",\n                            card=card_attachment(AdaptiveCardAttachment(content=card)),\n                        )\n                    )\n                )\n            )\n'})})}),"\n",(0,i.jsx)(n.h3,{id:"rendering-a-card",children:"Rendering A Card"}),"\n",(0,i.jsx)(n.p,{children:"You can render an Adaptive Card in a dialog by returning a card response."}),"\n",(0,i.jsx)(o.A,{language:"python",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'from microsoft_teams.api import AdaptiveCardAttachment, TaskFetchInvokeActivity, InvokeResponse, card_attachment\nfrom microsoft_teams.api import CardTaskModuleTaskInfo, TaskModuleContinueResponse, TaskModuleResponse\nfrom microsoft_teams.apps import ActivityContext\nfrom microsoft_teams.cards import AdaptiveCard, TextBlock, TextInput, SubmitAction, SubmitActionData\n# ...\n\n@app.on_dialog_open\nasync def handle_dialog_open(ctx: ActivityContext[TaskFetchInvokeActivity]):\n    """Handle dialog open events for all dialog types."""\n    # Return an object with the task value that renders a card\n    dialog_card = AdaptiveCard(\n        schema="http://adaptivecards.io/schemas/adaptive-card.json",\n        body=[\n            TextBlock(text="This is a simple form", size="Large", weight="Bolder"),\n            TextInput().with_label("Name").with_is_required(True).with_id("name").with_placeholder("Enter your name"),\n        ],\n        actions=[\n            SubmitAction().with_title("Submit").with_data(SubmitActionData(ms_teams={"SubmissionDialogType": "simple_form"}))\n        ]\n    )\n\n\n    # Return an object with the task value that renders a card\n    return InvokeResponse(\n                body=TaskModuleResponse(\n                    task=TaskModuleContinueResponse(\n                        value=CardTaskModuleTaskInfo(\n                            title="Simple Form Dialog",\n                            card=card_attachment(AdaptiveCardAttachment(content=dialog_card)),\n                        )\n                    )\n                )\n            )\n'})})}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsxs)(n.p,{children:["The action type for submitting a dialog must be ",(0,i.jsx)(n.code,{children:"Action.Submit"}),". This is a requirement of the Teams client. If you use a different action type, the dialog will not be submitted and the agent will not receive the submission event."]})}),"\n",(0,i.jsx)(n.h3,{id:"rendering-a-webpage",children:"Rendering A Webpage"}),"\n",(0,i.jsx)(n.p,{children:"You can render a webpage in a dialog as well. There are some security requirements to be aware of:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["The webpage must be hosted on a domain that is allow-listed as ",(0,i.jsx)(n.code,{children:"validDomains"})," in the Teams app ",(0,i.jsx)(n.a,{href:"/teams/manifest",children:"manifest"})," for the agent"]}),"\n",(0,i.jsxs)(n.li,{children:["The webpage must also host the ",(0,i.jsx)(n.a,{href:"https://www.npmjs.com/package/@microsoft/teams-js",children:"teams-js client library"}),". The reason for this is that for security purposes, the Teams client will not render arbitrary webpages. As such, the webpage must explicitly opt-in to being rendered in the Teams client. Setting up the teams-js client library handles this for you."]}),"\n"]}),"\n",(0,i.jsx)(o.A,{language:"python",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'import os\nfrom microsoft_teams.api import InvokeResponse, TaskModuleContinueResponse, TaskModuleResponse, UrlTaskModuleTaskInfo\n# ...\n\nreturn InvokeResponse(\n                body=TaskModuleResponse(\n                    task=TaskModuleContinueResponse(\n                        value=UrlTaskModuleTaskInfo(\n                            title="Webpage Dialog",\n                            # Here we are using a webpage that is hosted in the same\n                            # server as the agent. This server needs to be publicly accessible,\n                            # needs to set up teams.js client library (https://www.npmjs.com/package/@microsoft/teams-js)\n                            # and needs to be registered in the manifest.\n                            url=f"{os.getenv(\'BOT_ENDPOINT\')}/tabs/dialog-webpage",\n                            width=1000,\n                            height=800,\n                        )\n                    )\n                )\n            )\n'})})}),"\n",(0,i.jsxs)(o.A,{language:"python",children:[(0,i.jsx)(n.h3,{id:"setting-up-embedded-web-content",children:"Setting up Embedded Web Content"}),(0,i.jsxs)(n.p,{children:["To serve web content for dialogs, you can use the ",(0,i.jsx)(n.code,{children:"page"})," method to host static webpages:"]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'import os\n\n# In your app setup (e.g., main.py)\n# Hosts a static webpage at /tabs/dialog-form\napp.page("customform", os.path.join(os.path.dirname(__file__), "views", "customform"), "/tabs/dialog-form")\n'})})]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(p,{...e})}):p(e)}}}]);
"use strict";(self.webpackChunkteams_md=self.webpackChunkteams_md||[]).push([[4274],{26802:(e,n,t)=>{t.d(n,{A:()=>r});var a=t(22147),i=t(62540);function r({language:e,children:n}){return(0,a.zy)().pathname.includes(`/${e}/`)?(0,i.jsx)(i.Fragment,{children:n}):null}},43023:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>o});var a=t(63696);const i={},r=a.createContext(i);function s(e){const n=a.useContext(r);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),a.createElement(r.Provider,{value:n},e.children)}},76638:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>p,frontMatter:()=>o,metadata:()=>a,toc:()=>c});const a=JSON.parse('{"id":"python/in-depth-guides/ai/a2a/a2a-client","title":"A2A Client","description":"\x3c!--","source":"@site/docs/main/python/in-depth-guides/ai/a2a/a2a-client.mdx","sourceDirName":"python/in-depth-guides/ai/a2a","slug":"/python/in-depth-guides/ai/a2a/a2a-client","permalink":"/teams-sdk/python/in-depth-guides/ai/a2a/a2a-client","draft":false,"unlisted":false,"editUrl":"https://github.com/microsoft/teams-sdk/tree/main/teams.md/docs/main/python/in-depth-guides/ai/a2a/a2a-client.mdx","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"title":"A2A Client","sidebar_label":"A2A Client","summary":"How to implement an A2A client to proactively send tasks to A2A servers using the AgentManager.","languages":["typescript","python"]},"sidebar":"default","previous":{"title":"A2A Server","permalink":"/teams-sdk/python/in-depth-guides/ai/a2a/a2a-server"},"next":{"title":"Feedback","permalink":"/teams-sdk/python/in-depth-guides/feedback"}}');var i=t(62540),r=t(43023),s=t(26802);const o={sidebar_position:2,title:"A2A Client",sidebar_label:"A2A Client",summary:"How to implement an A2A client to proactively send tasks to A2A servers using the AgentManager.",languages:["typescript","python"]},l="A2A Client",d={},c=[{value:"What is an A2A Client?",id:"what-is-an-a2a-client",level:2},{value:"Using <code>A2AClient</code> Directly",id:"using-a2aclient-directly",level:2},{value:"Using <code>A2AClientPlugin</code> with ChatPrompt",id:"using-a2aclientplugin-with-chatprompt",level:2},{value:"Advanced <code>A2AClientPlugin</code> Configuration",id:"advanced-a2aclientplugin-configuration",level:3},{value:"Sequence Diagram",id:"sequence-diagram",level:2}];function u(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",mermaid:"mermaid",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"a2a-client",children:"A2A Client"})}),"\n",(0,i.jsx)(n.h2,{id:"what-is-an-a2a-client",children:"What is an A2A Client?"}),"\n",(0,i.jsx)(n.p,{children:"An A2A client is an agent or application that can proactively send tasks to A2A servers and interact with them using the A2A protocol."}),"\n",(0,i.jsxs)(n.h2,{id:"using-a2aclient-directly",children:["Using ",(0,i.jsx)(n.code,{children:"A2AClient"})," Directly"]}),"\n",(0,i.jsxs)(n.p,{children:["For direct control over A2A interactions, you can use the ",(0,i.jsx)(n.code,{children:"A2AClient"})," from the SDK:"]}),"\n",(0,i.jsx)(s.A,{language:"python",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'import uuid\nfrom httpx import AsyncClient\nfrom a2a.types import AgentCard, Message, Part, Role, Task, TextPart\nfrom a2a.client import ClientFactory, Client\nfrom a2a.client.card_resolver import A2ACardResolver\nfrom a2a.client.client import ClientConfig\nfrom .agent_client_info import AgentClientInfo\nfrom .agent_config import AgentConfig\n\n# Retrive the agent card based on the URL\nasync def fetch_agent_card(self, base_url: str, card_url: str) -> AgentCard:\n    async with AsyncClient() as httpx_client:\n      resolver = A2ACardResolver(httpx_client, base_url)\n      card = await resolver.get_agent_card(card_url)\n      return card\n\nasync def _get_client(self, key: str, config: AgentConfig) -> Client:\n  try:\n    # Example base_url=f"http://localhost:{PORT}/a2a"\n    # Example card_url=".well-known/agent-card.json"\n    card = await self.fetch_agent_card(base_url=config.base_url, card_url=config.card_url)\n    client_config = ClientConfig()\n    # Create the client from the URL\n    client = ClientFactory(client_config).create(card=card)\n    client_info = AgentClientInfo(**asdict(config), client=client, agent_card=card)\n    self._clients.update({key: client_info})\n    return client\n  except Exception as e:\n    self.log.error(f"Error creating client or fetching agent card for {key}: {e}")\n    raise e\n\nasync def _send_message(self) -> None:\n  # Send a message directly\n  message = Message(\n              message_id=str(uuid.uuid4()),\n              role=Role("user"),\n              parts=[Part(root=TextPart(kind="text", text="What is the weather?"))],\n          )\n\n  async for event in self._get_client().send_message(message):\n    # Handle the event\n'})})}),"\n",(0,i.jsxs)(n.h2,{id:"using-a2aclientplugin-with-chatprompt",children:["Using ",(0,i.jsx)(n.code,{children:"A2AClientPlugin"})," with ChatPrompt"]}),"\n",(0,i.jsxs)(n.p,{children:["A2A is most effective when used with an LLM. The ",(0,i.jsx)(n.code,{children:"A2AClientPlugin"})," can be added to your chat prompt to allow interaction with A2A agents. Once added, the plugin will automatically configure the system prompt and tool calls to determine if the a2a server is needed for a particular task, and if so, it will do the work of orchestrating the call to the A2A server."]}),"\n",(0,i.jsx)(s.A,{language:"python",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'from os import getenv\nfrom microsoft_teams.openai.completions_model import OpenAICompletionsAIModel\nfrom microsoft_teams.a2a import A2AClientPlugin, A2APluginUseParams\nfrom microsoft_teams.ai import ChatPrompt\n\nPORT = getenv("PORT", "4000")\n\n# Setup AI\ndef get_required_env(key: str) -> str:\n    value = getenv(key)\n    if not value:\n        raise ValueError(f"Required environment variable {key} is not set")\n    return value\n\n\nAZURE_OPENAI_MODEL = get_required_env("AZURE_OPENAI_MODEL")\ncompletions_model = OpenAICompletionsAIModel(model=AZURE_OPENAI_MODEL)\n\n# Setup A2A Client Plugin\nclient_plugin = A2AClientPlugin()\n# Specify the connection details for the agent we want to use\nclient_plugin.on_use_plugin(\n    A2APluginUseParams(\n        key="my-weather-agent", base_url=f"http://localhost:{PORT}/a2a", card_url=".well-known/agent-card.json"\n    )\n)\nprompt = ChatPrompt(\n    model=completions_model,\n    plugins=[client_plugin],\n)\n'})})}),"\n",(0,i.jsx)(n.p,{children:"To send a message:"}),"\n",(0,i.jsx)(s.A,{language:"python",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"# Now we can send the message to the prompt and it will decide if\n# the a2a agent should be used or not and also manages contacting the agent\nresult = await prompt.send(message)\n"})})}),"\n",(0,i.jsxs)(n.h3,{id:"advanced-a2aclientplugin-configuration",children:["Advanced ",(0,i.jsx)(n.code,{children:"A2AClientPlugin"})," Configuration"]}),"\n",(0,i.jsx)(n.p,{children:"You can customize how the client interacts with A2A agents by providing custom builders:"}),"\n",(0,i.jsx)(s.A,{language:"python",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'# Example with custom message builders and response processors\ndef build_function_metadata(card: AgentCard) -> FunctionMetadata:\n    return FunctionMetadata(\n        name=f"ask{re.sub(r\'\\s+\', \'\', card.name)}",\n        description=f"Ask {card.name} about {card.description or \'anything\'}",\n    )\n\n\ndef build_message_for_agent(data: BuildMessageForAgentMetadata) -> Union[Message, str]:\n    # Return a string - will be automatically wrapped in a Message\n    return f"[To {data.card.name}]: {data.input}"\n\n    # Uncomment the following block to return a full Message object\n    # message = Message(\n    #                 kind=\'message\',\n    #                 message_id=str(uuid4()),\n    #                 role=Role(\'user\'),\n    #                 parts=[Part(root=TextPart(kind=\'text\', text=f"[To {data.card.name}]: {data.input}"))],\n    #                 metadata={"source": "chat-prompt", **(data.metadata if data.metadata else {})}\n    #             )\n    # return message\n\n\ndef build_message_from_agent_response(data: BuildMessageFromAgentMetadata) -> str:\n    if isinstance(data.response, Message):\n        text_parts: List[str] = []\n        for part in data.response.parts:\n            if getattr(part.root, "kind", None) == "text":\n                text_part = cast(TextPart, part.root)\n                text_parts.append(text_part.text)\n        return f"{data.card.name} says: {\' \'.join(text_parts)}"\n    return f"{data.card.name} sent a non-text response."\n\n\n## Advanced A2AClientPlugin\nadvanced_plugin = A2AClientPlugin(\n    # Custom function metadata builder\n    build_function_metadata=build_function_metadata,\n    # Custom message builder - can return either Message or string\n    build_message_for_agent=build_message_for_agent,\n    # Custom response processor\n    build_message_from_agent_response=build_message_from_agent_response,\n)\nadvanced_plugin.on_use_plugin(\n    A2APluginUseParams(\n        key="my-weather-agent", base_url=f"http://localhost:{PORT}/a2a", card_url=".well-known/agent-card.json"\n    )\n)\nadvanced_prompt = ChatPrompt(model=completions_model, plugins=[advanced_plugin])\n'})})}),"\n",(0,i.jsx)(n.h2,{id:"sequence-diagram",children:"Sequence Diagram"}),"\n",(0,i.jsxs)(n.p,{children:["Here's how the A2A client works with ",(0,i.jsx)(n.code,{children:"ChatPrompt"})," and ",(0,i.jsx)(n.code,{children:"A2AClientPlugin"}),":"]}),"\n",(0,i.jsx)(s.A,{language:"python",children:(0,i.jsx)(n.mermaid,{value:"sequenceDiagram\n    participant User\n    participant ChatPrompt\n    participant A2AClientPlugin\n    participant A2ACardResolver\n    participant Client\n    participant LLM\n    participant A2AServer\n\n    Note over User,A2AServer: Configuration\n    User->>A2AClientPlugin: on_use_plugin()\n\n    Note over User,A2AServer: Message Flow\n    User->>ChatPrompt: send(message)\n    ChatPrompt->>A2AClientPlugin: on_build_instructions()\n    A2AClientPlugin->>A2ACardResolver: fetch_agent_card()\n    A2ACardResolver->>A2AServer: GET /.well-known/agent-card.json\n    A2AServer--\x3e>A2ACardResolver: AgentCard\n    A2ACardResolver--\x3e>A2AClientPlugin: AgentCard\n    A2AClientPlugin--\x3e>ChatPrompt: Enhanced system prompt\n\n    ChatPrompt->>A2AClientPlugin: on_build_functions()\n    A2AClientPlugin--\x3e>ChatPrompt: Function tools for agents\n\n    ChatPrompt->>LLM: Enhanced prompt + tools\n    LLM--\x3e>ChatPrompt: Function call (message_agent)\n    ChatPrompt->>A2AClientPlugin: Execute function handler\n    A2AClientPlugin->>Client: send_message()\n    Client->>A2AServer: POST /a2a/task/send\n    A2AServer--\x3e>Client: Response\n    Client--\x3e>A2AClientPlugin: Response\n    A2AClientPlugin--\x3e>ChatPrompt: Processed response\n    ChatPrompt--\x3e>User: Final response"})})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(u,{...e})}):u(e)}}}]);
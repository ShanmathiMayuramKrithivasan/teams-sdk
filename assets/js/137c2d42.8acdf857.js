"use strict";(self.webpackChunkteams_md=self.webpackChunkteams_md||[]).push([[261],{26802:(e,t,n)=>{n.d(t,{A:()=>r});var s=n(22147),i=n(62540);function r({language:e,children:t}){return(0,s.zy)().pathname.includes(`/${e}/`)?(0,i.jsx)(i.Fragment,{children:t}):null}},43023:(e,t,n)=>{n.d(t,{R:()=>d,x:()=>c});var s=n(63696);const i={},r=s.createContext(i);function d(e){const t=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),s.createElement(r.Provider,{value:t},e.children)}},51138:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>u,frontMatter:()=>c,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"typescript/in-depth-guides/tabs/functions/index","title":"Functions","description":"\x3c!--","source":"@site/docs/main/typescript/in-depth-guides/tabs/functions/index.mdx","sourceDirName":"typescript/in-depth-guides/tabs/functions","slug":"/typescript/in-depth-guides/tabs/functions/","permalink":"/teams-sdk/typescript/in-depth-guides/tabs/functions/","draft":false,"unlisted":false,"editUrl":"https://github.com/microsoft/teams-sdk/tree/main/teams.md/docs/main/typescript/in-depth-guides/tabs/functions/index.mdx","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5,"title":"Functions","summary":"Details on how to register REST endpoints that can be called from Tab apps.","languages":["typescript","csharp"]},"sidebar":"default","previous":{"title":"Microsoft Graph","permalink":"/teams-sdk/typescript/in-depth-guides/tabs/graph"},"next":{"title":"Executing Functions","permalink":"/teams-sdk/typescript/in-depth-guides/tabs/functions/function-calling"}}');var i=n(62540),r=n(43023),d=n(26802);const c={sidebar_position:5,title:"Functions",summary:"Details on how to register REST endpoints that can be called from Tab apps.",languages:["typescript","csharp"]},a="Functions",l={},o=[{value:"Function context",id:"function-context",level:2},{value:"Additional resources",id:"additional-resources",level:2}];function h(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"functions",children:"Functions"})}),"\n",(0,i.jsx)(d.A,{language:"typescript",children:(0,i.jsxs)(t.p,{children:["Agents may want to expose REST APIs that client applications can call. This SDK makes it easy to implement those APIs through the ",(0,i.jsx)(t.code,{children:"app.function()"})," method. The function takes a name and a callback that implements the function."]})}),"\n",(0,i.jsxs)(d.A,{language:"typescript",children:[(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-typescript",children:"app.function('do-something', () => {\n  // do something useful\n});\n"})}),(0,i.jsxs)(t.p,{children:["This registers a REST API hosted at ",(0,i.jsx)(t.code,{children:"http://localhost:{PORT}/api/functions/do-something"})," or ",(0,i.jsx)(t.code,{children:"https://{BOT_DOMAIN}/api/functions/do-something"})," that clients can POST to. When they do, this SDK validates that the caller provides a valid Microsoft Entra bearer token before invoking the registered callback. If the token is missing or invalid, the request is denied with a HTTP 401."]}),(0,i.jsxs)(t.p,{children:["The function can be typed to accept input arguments. The clients would include those in the POST request payload, and they are made available in the callback through the ",(0,i.jsx)(t.code,{children:"data"})," context argument."]}),(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-typescript",children:"app.function<{}, { message: string }>('process-message', ({ data, log }) => {\n  log.info(`process-message called with: ${data.message}`);\n});\n"})})]}),"\n",(0,i.jsx)(d.A,{language:"typescript",children:(0,i.jsx)(t.admonition,{type:"warning",children:(0,i.jsx)(t.p,{children:"This SDK does not validate that the function arguments are of the expected types or otherwise trustworthy. You must take care to validate the input arguments before using them."})})}),"\n",(0,i.jsxs)(d.A,{language:"typescript",children:[(0,i.jsx)(t.p,{children:"If desired, the function can return data to the caller. The return value can be a string, an object, or an array."}),(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-typescript",children:"app.function('get-random-number', () => {\n  return '4'; // chosen by fair dice roll;\n  // guaranteed to be random\n});\n"})}),(0,i.jsx)(t.p,{children:"If your function returns a number, that will be interpreted as an HTTP status code:"}),(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-typescript",children:"app.function('privileged-action', ({ userId }) => {\n  if (!hasPermission(userId)) {\n    return 401; // HTTP response will have status 401: unauthorized\n  }\n  // ... do something\n});\n"})})]}),"\n",(0,i.jsx)(t.h2,{id:"function-context",children:"Function context"}),"\n",(0,i.jsx)(d.A,{language:"typescript",children:(0,i.jsx)(t.p,{children:"The function callback receives a context object with a number of useful values. Some originate within the agent itself, while others are furnished by the caller via the HTTP Request."})}),"\n",(0,i.jsx)(d.A,{language:"typescript",children:(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Property"}),(0,i.jsx)(t.th,{children:"Source"}),(0,i.jsx)(t.th,{children:"Description"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"api"})}),(0,i.jsx)(t.td,{children:"Agent"}),(0,i.jsx)(t.td,{children:"The API client."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"appGraph"})}),(0,i.jsx)(t.td,{children:"Agent"}),(0,i.jsx)(t.td,{children:"The app graph client."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"appId"})}),(0,i.jsx)(t.td,{children:"Agent"}),(0,i.jsx)(t.td,{children:"Unique identifier assigned to the app after deployment, ensuring correct app instance recognition across hosts."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"appSessionId"})}),(0,i.jsx)(t.td,{children:"Caller"}),(0,i.jsx)(t.td,{children:"Unique ID for the calling app's session, used to correlate telemetry data."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"authToken"})}),(0,i.jsx)(t.td,{children:"Caller"}),(0,i.jsx)(t.td,{children:"The validated MSAL Entra token."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"channelId"})}),(0,i.jsx)(t.td,{children:"Caller"}),(0,i.jsx)(t.td,{children:"Microsoft Teams ID for the channel associated with the content."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"chatId"})}),(0,i.jsx)(t.td,{children:"Caller"}),(0,i.jsx)(t.td,{children:"Microsoft Teams ID for the chat associated with the content."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"data"})}),(0,i.jsx)(t.td,{children:"Caller"}),(0,i.jsx)(t.td,{children:"The function payload."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"getCurrentConversationId"})}),(0,i.jsx)(t.td,{children:"Agent"}),(0,i.jsxs)(t.td,{children:["Attempts to find the conversation ID where the app is used and verifies agent-user presence. Returns ",(0,i.jsx)(t.code,{children:"undefined"})," if not found or invalid."]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"log"})}),(0,i.jsx)(t.td,{children:"Agent"}),(0,i.jsx)(t.td,{children:"The app logger instance."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"meetingId"})}),(0,i.jsx)(t.td,{children:"Caller"}),(0,i.jsx)(t.td,{children:"Meeting ID used by tab when running in meeting context."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"messageId"})}),(0,i.jsx)(t.td,{children:"Caller"}),(0,i.jsx)(t.td,{children:"ID of the parent message from which the task module was launched (only available in bot card-launched modules)."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"pageId"})}),(0,i.jsx)(t.td,{children:"Caller"}),(0,i.jsx)(t.td,{children:"Developer-defined unique ID for the page this content points to."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"send"})}),(0,i.jsx)(t.td,{children:"Agent"}),(0,i.jsxs)(t.td,{children:["Sends an activity to the current conversation. Returns ",(0,i.jsx)(t.code,{children:"null"})," if the conversation ID is invalid or undetermined."]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"subPageId"})}),(0,i.jsx)(t.td,{children:"Caller"}),(0,i.jsx)(t.td,{children:"Developer-defined unique ID for the sub-page this content points to. Used to restore specific state within a page."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"teamId"})}),(0,i.jsx)(t.td,{children:"Caller"}),(0,i.jsx)(t.td,{children:"Microsoft Teams ID for the team associated with the content."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"tenantId"})}),(0,i.jsx)(t.td,{children:"Caller"}),(0,i.jsx)(t.td,{children:"Microsoft Entra tenant ID of the current user, extracted from the validated auth token."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"userId"})}),(0,i.jsx)(t.td,{children:"Caller"}),(0,i.jsx)(t.td,{children:"Microsoft Entra object ID of the current user, extracted from the validated auth token."})]})]})]})}),"\n",(0,i.jsxs)(d.A,{language:"typescript",children:[(0,i.jsxs)(t.p,{children:["The ",(0,i.jsx)(t.code,{children:"authToken"})," is validated before the function callback is invoked, and the ",(0,i.jsx)(t.code,{children:"tenantId"})," and ",(0,i.jsx)(t.code,{children:"userId"})," values are extracted from the validated token. In the typical case, the remaining caller-supplied values would reflect what the Teams Tab app retrieves from the teams-js ",(0,i.jsx)(t.code,{children:"getContext()"})," API, but the agent does not validate them."]}),(0,i.jsx)(t.admonition,{type:"warning",children:(0,i.jsx)(t.p,{children:"Take care to validate the caller-supplied values before using them. Don't assume that the calling user actually has access to items indicated in the context."})})]}),"\n",(0,i.jsxs)(d.A,{language:"typescript",children:[(0,i.jsxs)(t.p,{children:["To simplify two common scenarios, the context provides the ",(0,i.jsx)(t.code,{children:"getCurrentConversationId"})," and ",(0,i.jsx)(t.code,{children:"send"})," methods."]}),(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["The ",(0,i.jsx)(t.code,{children:"getCurrentConversationId"})," method attempts to find the current conversation ID based on the context provided by the client (chatId and channelId) and validates that both the agent and the calling user are actually present in the conversation. If neither chatId or channelId is provided by the caller, the ID of the 1:1 conversation between the agent and the user is returned."]}),"\n",(0,i.jsxs)(t.li,{children:["The ",(0,i.jsx)(t.code,{children:"send"})," method relies on ",(0,i.jsx)(t.code,{children:"getCurrentConversationId"})," to find the conversation where the app is hosted and posts an activity."]}),"\n"]})]}),"\n",(0,i.jsx)(t.h2,{id:"additional-resources",children:"Additional resources"}),"\n",(0,i.jsx)(d.A,{language:"typescript",children:(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["For details on how to Tab apps can invoke these functions, see the ",(0,i.jsx)(t.a,{href:"./function-calling",children:"Executing Functions"})," in-depth guide."]}),"\n"]})})]})}function u(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}}}]);
"use strict";(self.webpackChunkteams_md=self.webpackChunkteams_md||[]).push([[9825],{6485:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"python/in-depth-guides/message-extensions/link-unfurling","title":"Link Unfurling","description":"\x3c!--","source":"@site/docs/main/python/in-depth-guides/message-extensions/link-unfurling.mdx","sourceDirName":"python/in-depth-guides/message-extensions","slug":"/python/in-depth-guides/message-extensions/link-unfurling","permalink":"/teams-sdk/python/in-depth-guides/message-extensions/link-unfurling","draft":false,"unlisted":false,"editUrl":"https://github.com/microsoft/teams-sdk/tree/main/teams.md/docs/main/python/in-depth-guides/message-extensions/link-unfurling.mdx","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4,"sidebar_label":"Link Unfurling","title":"Link Unfurling","summary":"Enable your app to respond when users paste URLs by creating preview cards with additional information and actions."},"sidebar":"default","previous":{"title":"Settings","permalink":"/teams-sdk/python/in-depth-guides/message-extensions/settings"},"next":{"title":"\ud83d\udd12 User Authentication","permalink":"/teams-sdk/python/in-depth-guides/user-authentication"}}');var s=t(62540),a=t(43023),r=t(26802);const o={sidebar_position:4,sidebar_label:"Link Unfurling",title:"Link Unfurling",summary:"Enable your app to respond when users paste URLs by creating preview cards with additional information and actions."},l="\ud83d\udd17 Link unfurling",d={},c=[{value:"Setting up your Teams app manifest",id:"setting-up-your-teams-app-manifest",level:2},{value:"Configure message handlers",id:"configure-message-handlers",level:3},{value:"How link unfurling works",id:"how-link-unfurling-works",level:3},{value:"Implementing link unfurling",id:"implementing-link-unfurling",level:2},{value:"Handle the query link event",id:"handle-the-query-link-event",level:3},{value:"Create the unfurl card",id:"create-the-unfurl-card",level:3},{value:"User experience flow",id:"user-experience-flow",level:3},{value:"Resources",id:"resources",level:2}];function u(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",mermaid:"mermaid",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"-link-unfurling",children:"\ud83d\udd17 Link unfurling"})}),"\n",(0,s.jsx)(n.p,{children:"Link unfurling lets your app respond when users paste URLs into Teams. When a URL from your registered domain is pasted, your app receives the URL and can return a card with additional information or actions. This works like a search command where the URL acts as the search term."}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsxs)(n.p,{children:["Users can use link unfurling even before they discover or install your app in Teams. This is called ",(0,s.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/microsoftteams/platform/messaging-extensions/how-to/link-unfurling?tabs=desktop%2Cjson%2Cadvantages#zero-install-for-link-unfurling",children:"Zero install link unfurling"}),". In this scenario, your app will receive a ",(0,s.jsx)(n.code,{children:"message.ext.anon-query-link"})," activity instead of the usual ",(0,s.jsx)(n.code,{children:"message.ext.query-link"}),"."]})}),"\n",(0,s.jsx)(n.h2,{id:"setting-up-your-teams-app-manifest",children:"Setting up your Teams app manifest"}),"\n",(0,s.jsx)(n.h3,{id:"configure-message-handlers",children:"Configure message handlers"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'"composeExtensions": [\n    {\n        "botId": "${{BOT_ID}}",\n        "messageHandlers": [\n            {\n                "type": "link",\n                "value": {\n                    "domains": [\n                        "www.test.com"\n                    ]\n                }\n            }\n        ]\n    }\n]\n'})}),"\n",(0,s.jsx)(n.h3,{id:"how-link-unfurling-works",children:"How link unfurling works"}),"\n",(0,s.jsxs)(n.p,{children:["When a user pastes a URL from your registered domain (like ",(0,s.jsx)(n.code,{children:"www.test.com"}),") into the Teams compose box, your app will receive a notification. Your app can then respond by returning an adaptive card that displays a preview of the linked content. This preview card appears before the user sends their message in the compose box, allowing them to see how the link will be displayed to others."]}),"\n",(0,s.jsx)(n.mermaid,{value:'flowchart TD\n    A1["User pastes a URL (e.g., www\\.test\\.com) in Teams compose box"]\n    B1([Microsoft Teams])\n    C1["Your App"]\n    D1["Adaptive Card Preview"]\n\n    A1 --\x3e B1\n    B1 --\x3e|Sends URL paste notification| C1\n    C1 --\x3e|Returns card and preview| B1\n    B1 --\x3e D1\n\n    %% Styling for readability and compatibility\n    style B1 fill:#2E86AB,stroke:#1B4F72,stroke-width:2px,color:#ffffff\n    style C1 fill:#28B463,stroke:#1D8348,stroke-width:2px,color:#ffffff\n    style D1 fill:#F39C12,stroke:#D68910,stroke-width:2px,color:#ffffff'}),"\n",(0,s.jsx)(n.h2,{id:"implementing-link-unfurling",children:"Implementing link unfurling"}),"\n",(0,s.jsx)(n.h3,{id:"handle-the-query-link-event",children:"Handle the query link event"}),"\n",(0,s.jsx)(n.p,{children:"Handle link unfurling when a URL from your registered domain is submitted into the Teams compose box."}),"\n",(0,s.jsx)(r.A,{language:"python",children:(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'from microsoft_teams.api import (\n    AdaptiveCardAttachment,\n    MessageExtensionQueryLinkInvokeActivity,\n    ThumbnailCardAttachment,\n    card_attachment,\n    InvokeResponse,\n    AttachmentLayout,\n    MessagingExtensionAttachment,\n    MessagingExtensionInvokeResponse,\n    MessagingExtensionResult,\n    MessagingExtensionResultType,\n)\nfrom microsoft_teams.apps import ActivityContext\n# ...\n\n@app.on_message_ext_query_link\nasync def handle_message_ext_query_link(ctx: ActivityContext[MessageExtensionQueryLinkInvokeActivity]):\n    url = ctx.activity.value.url\n\n    if not url:\n        return InvokeResponse[MessagingExtensionInvokeResponse](status=400)\n\n    card_data = create_link_unfurl_card(url)\n    main_attachment = card_attachment(AdaptiveCardAttachment(content=card_data["card"]))\n    preview_attachment = card_attachment(ThumbnailCardAttachment(content=card_data["thumbnail"]))\n\n    attachment = MessagingExtensionAttachment(\n        content_type=main_attachment.content_type,\n        content=main_attachment.content,\n        preview=preview_attachment,\n    )\n\n    result = MessagingExtensionResult(\n        type=MessagingExtensionResultType.RESULT,\n        attachment_layout=AttachmentLayout.LIST,\n        attachments=[attachment],\n    )\n\n    return MessagingExtensionInvokeResponse(compose_extension=result)\n'})})}),"\n",(0,s.jsx)(n.h3,{id:"create-the-unfurl-card",children:"Create the unfurl card"}),"\n",(0,s.jsxs)(r.A,{language:"python",children:[(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"create_link_unfurl_card()"})," function"]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'from typing import Any, Dict\nfrom microsoft_teams.cards import AdaptiveCard\n# ...\n\ndef create_link_unfurl_card(url: str) -> Dict[str, Any]:\n    """Create a card for link unfurling."""\n    thumbnail = {\n        "title": "Unfurled Link",\n        "text": url,\n        "images": [{"url": IMAGE_URL}],\n    }\n\n    card = AdaptiveCard.model_validate(\n        {\n            "type": "AdaptiveCard",\n            "version": "1.4",\n            "body": [\n                {\n                    "type": "TextBlock",\n                    "text": "Unfurled Link",\n                    "size": "Large",\n                    "weight": "Bolder",\n                    "color": "Accent",\n                    "style": "heading",\n                },\n                {\n                    "type": "TextBlock",\n                    "text": url,\n                    "size": "Small",\n                    "weight": "Lighter",\n                    "color": "Good",\n                },\n            ],\n        }\n    )\n\n    return {"card": card, "thumbnail": thumbnail}\n'})})]}),"\n",(0,s.jsx)(n.h3,{id:"user-experience-flow",children:"User experience flow"}),"\n",(0,s.jsx)(n.p,{children:"The link unfurling response includes both a full adaptive card and a preview card. The preview card appears in the compose box when a user pastes a URL:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Screenshot showing a preview card for an unfurled URL in the Teams compose box.",src:t(84041).A+"",width:"2164",height:"1464"})}),"\n",(0,s.jsxs)(n.p,{children:["The user can expand the preview card by clicking on the ",(0,s.jsx)(n.em,{children:"expand"})," button on the top right."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Screenshot of Teams compose box with an outline around the unfurled link card labeled &#39;Adaptive Card&#39;.",src:t(38715).A+"",width:"2160",height:"1456"})}),"\n",(0,s.jsx)(n.p,{children:"The user can then choose to send either the preview or the full adaptive card as a message."}),"\n",(0,s.jsx)(n.h2,{id:"resources",children:"Resources"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/microsoftteams/platform/messaging-extensions/how-to/link-unfurling?tabs=desktop%2Cjson%2Cadvantages",children:"Link unfurling"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/microsoftteams/platform/messaging-extensions/how-to/link-unfurling?tabs=desktop%2Cjson%2Cadvantages#zero-install-for-link-unfurling",children:"Zero install link unfurling"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(u,{...e})}):u(e)}},26802:(e,n,t)=>{t.d(n,{A:()=>a});var i=t(22147),s=t(62540);function a({language:e,children:n}){return(0,i.zy)().pathname.includes(`/${e}/`)?(0,s.jsx)(s.Fragment,{children:n}):null}},38715:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/link-unfurl-card-df5a2c57a04f28bb0816ab33e3524d8b.png"},43023:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>o});var i=t(63696);const s={},a=i.createContext(s);function r(e){const n=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),i.createElement(a.Provider,{value:n},e.children)}},84041:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/link-unfurl-preview-b562d28cfcf58c80f7bd98c8bb870c1f.png"}}]);
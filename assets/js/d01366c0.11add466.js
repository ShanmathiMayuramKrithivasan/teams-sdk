"use strict";(self.webpackChunkteams_md=self.webpackChunkteams_md||[]).push([[5038],{26802:(e,n,t)=>{t.d(n,{A:()=>r});var s=t(22147),i=t(62540);function r({language:e,children:n}){return(0,s.zy)().pathname.includes(`/${e}/`)?(0,i.jsx)(i.Fragment,{children:n}):null}},43023:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>a});var s=t(63696);const i={},r=s.createContext(i);function o(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(r.Provider,{value:n},e.children)}},73141:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>p,contentTitle:()=>c,default:()=>u,frontMatter:()=>a,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"typescript/in-depth-guides/ai/mcp/mcp-server","title":"MCP Server","description":"\x3c!--","source":"@site/docs/main/typescript/in-depth-guides/ai/mcp/mcp-server.mdx","sourceDirName":"typescript/in-depth-guides/ai/mcp","slug":"/typescript/in-depth-guides/ai/mcp/mcp-server","permalink":"/teams-sdk/typescript/in-depth-guides/ai/mcp/mcp-server","draft":false,"unlisted":false,"editUrl":"https://github.com/microsoft/teams-sdk/tree/main/teams.md/docs/main/typescript/in-depth-guides/ai/mcp/mcp-server.mdx","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"sidebar_label":"MCP Server","title":"MCP Server","summary":"How to convert your Teams app into an MCP server using the McpPlugin to expose tools, resources, and prompts to other MCP applications.","languages":["typescript","python"]},"sidebar":"default","previous":{"title":"MCP","permalink":"/teams-sdk/typescript/in-depth-guides/ai/mcp/"},"next":{"title":"MCP Client","permalink":"/teams-sdk/typescript/in-depth-guides/ai/mcp/mcp-client"}}');var i=t(62540),r=t(43023),o=t(26802);const a={sidebar_position:1,sidebar_label:"MCP Server",title:"MCP Server",summary:"How to convert your Teams app into an MCP server using the McpPlugin to expose tools, resources, and prompts to other MCP applications.",languages:["typescript","python"]},c="MCP Server",p={},d=[{value:"Piping messages to the user",id:"piping-messages-to-the-user",level:2}];function l(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"mcp-server",children:"MCP Server"})}),"\n",(0,i.jsx)(o.A,{language:"typescript",children:(0,i.jsxs)(n.p,{children:["You are able to convert any ",(0,i.jsx)(n.code,{children:"App"})," into an MCP server by using the ",(0,i.jsx)(n.code,{children:"McpPlugin"}),". This plugin adds the necessary endpoints to your application to serve as an MCP server. The plugin allows you to define tools, resources, and prompts that can be exposed to other MCP applications."]})}),"\n",(0,i.jsxs)(o.A,{language:"typescript",children:[(0,i.jsx)(n.p,{children:"Install it to your application:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"npm install @microsoft/teams.mcp\n"})})]}),"\n",(0,i.jsxs)(o.A,{language:"typescript",children:[(0,i.jsx)(n.p,{children:"Your plugin can be configured as follows:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import { z } from 'zod';\nimport { App } from '@microsoft/teams.apps';\nimport { McpPlugin } from '@microsoft/teams.mcp';\n// ...\n\nconst mcpServerPlugin = new McpPlugin({\n  // Describe the MCP server with a helpful name and description\n  // for MCP clients to discover and use it.\n  name: 'test-mcp',\n  description: 'Allows you to test the mcp server',\n  // Optionally, you can provide a URL to the mcp dev-tools\n  // during development\n  inspector: 'http://localhost:5173?proxyPort=9000',\n}).tool(\n  // Describe the tools with helpful names and descriptions\n  'echo',\n  'echos back whatever you said',\n  {\n    input: z.string().describe('the text to echo back'),\n  },\n  {\n    readOnlyHint: true,\n    idempotentHint: true,\n  },\n  async ({ input }) => {\n    return {\n      content: [\n        {\n          type: 'text',\n          text: `you said \"${input}\"`,\n        },\n      ],\n    };\n  }\n);\n"})})]}),"\n",(0,i.jsx)(o.A,{language:"typescript",children:(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["By default, the MCP server will be available at ",(0,i.jsx)(n.code,{children:"/mcp"})," on your application. You can change this by setting the ",(0,i.jsx)(n.code,{children:"transport.path"})," property in the plugin configuration."]})})}),"\n",(0,i.jsxs)(o.A,{language:"typescript",children:[(0,i.jsx)(n.p,{children:"And included in the app like any other plugin:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import { App } from '@microsoft/teams.apps';\nimport { DevtoolsPlugin } from '@microsoft/teams.dev';\nimport { McpPlugin } from '@microsoft/teams.mcp';\n// ...\n\nconst app = new App({\n  plugins: [\n    new DevtoolsPlugin(),\n    // Add this plugin\n    mcpServerPlugin,\n  ],\n});\n"})})]}),"\n",(0,i.jsx)(o.A,{language:"typescript",children:(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsxs)(n.p,{children:["Enabling mcp request inspection and the ",(0,i.jsx)(n.code,{children:"DevtoolsPlugin"})," allows you to see all the requests and responses to and from your MCP server (similar to how the ",(0,i.jsx)(n.strong,{children:"Activities"})," tab works)."]})})}),"\n",(0,i.jsx)(o.A,{language:"typescript",children:(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"MCP Server in Devtools",src:t(97283).A+"",width:"908",height:"778"})})}),"\n",(0,i.jsx)(n.h2,{id:"piping-messages-to-the-user",children:"Piping messages to the user"}),"\n",(0,i.jsx)(n.p,{children:"Since your agent is provisioned to work on Teams, one very helpful feature is to use this server as a way to send messages to the user. This can be helpful in various scenarios:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Human in the loop - if the server or an MCP client needs to confirm something with the user, it is able to do so."}),"\n",(0,i.jsx)(n.li,{children:"Notifications - the server can be used as a way to send notifications to the user."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Here is an example of how to do this. Configure your plugin so that:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"It can validate if the incoming request is allowed to send messages to the user"}),"\n",(0,i.jsx)(n.li,{children:"It fetches the correct conversation ID for the given user."}),"\n",(0,i.jsxs)(n.li,{children:["It sends a proactive message to the user. See ",(0,i.jsx)(n.a,{href:"../../../essentials/sending-messages/proactive-messaging",children:"Proactive Messaging"})," for more details."]}),"\n"]}),"\n",(0,i.jsx)(o.A,{language:"typescript",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import { z } from 'zod';\nimport { App } from '@microsoft/teams.apps';\nimport { McpPlugin } from '@microsoft/teams.mcp';\n// ...\n\n// Keep a store of the user to the conversation id\n// In a production app, you probably would want to use a\n// persistent store like a database\nconst userToConversationId = new Map<string, string>();\n\n// Add a an MCP server tool\nmcpServerPlugin.tool(\n  'alertUser',\n  'alerts the user about something important',\n  {\n    input: z.string().describe('the text to echo back'),\n    userAadObjectId: z.string().describe('the user to alert'),\n  },\n  {\n    readOnlyHint: true,\n    idempotentHint: true,\n  },\n  async ({ input, userAadObjectId }, { authInfo }) => {\n    if (!isAuthValid(authInfo)) {\n      throw new Error('Not allowed to call this tool');\n    }\n\n    const conversationId = userToConversationId.get(userAadObjectId);\n    if (!conversationId) {\n      console.log('Current conversation map', userToConversationId);\n      return {\n        content: [\n          {\n            type: 'text',\n            text: `user ${userAadObjectId} is not in a conversation`,\n          },\n        ],\n      };\n    }\n\n    // Leverage the app's proactive messaging capabilities to send a mesage to\n    // correct conversation id.\n    await app.send(conversationId, `Notification: ${input}`);\n    return {\n      content: [\n        {\n          type: 'text',\n          text: 'User was notified',\n        },\n      ],\n    };\n  }\n);\n"})})}),"\n",(0,i.jsx)(o.A,{language:"typescript",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import { App } from '@microsoft/teams.apps';\n// ...\n\napp.on('message', async ({ send, activity }) => {\n  await send({ type: 'typing' });\n  await send(`you said \"${activity.text}\"`);\n  if (activity.from.aadObjectId && !userToConversationId.has(activity.from.aadObjectId)) {\n    userToConversationId.set(activity.from.aadObjectId, activity.conversation.id);\n    app.log.info(\n      `Just added user ${activity.from.aadObjectId} to conversation ${activity.conversation.id}`\n    );\n  }\n});\n"})})})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},97283:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/mcp-devtools-0aca96b4ef24e17890c0e0c5d1e70d74.gif"}}]);
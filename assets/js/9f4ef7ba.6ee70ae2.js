"use strict";(self.webpackChunkteams_md=self.webpackChunkteams_md||[]).push([[8045],{43023:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>a});var s=t(63696);const i={},o=s.createContext(i);function r(e){const n=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),s.createElement(o.Provider,{value:n},e.children)}},66870:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>p,frontMatter:()=>r,metadata:()=>s,toc:()=>u});const s=JSON.parse('{"id":"typescript/in-depth-guides/tabs/functions/function-calling","title":"Executing Functions","description":"\x3c!--","source":"@site/docs/main/typescript/in-depth-guides/tabs/functions/function-calling.mdx","sourceDirName":"typescript/in-depth-guides/tabs/functions","slug":"/typescript/in-depth-guides/tabs/functions/function-calling","permalink":"/teams-sdk/typescript/in-depth-guides/tabs/functions/function-calling","draft":false,"unlisted":false,"editUrl":"https://github.com/microsoft/teams-sdk/tree/main/teams.md/docs/main/typescript/in-depth-guides/tabs/functions/function-calling.mdx","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"title":"Executing Functions","summary":"Call remote agent functions from tab apps with authentication and custom headers using the exec() method.","languages":["typescript"],"suppressLanguageIncludeWarning":true},"sidebar":"default","previous":{"title":"Functions","permalink":"/teams-sdk/typescript/in-depth-guides/tabs/functions/"},"next":{"title":"Feedback","permalink":"/teams-sdk/typescript/in-depth-guides/feedback"}}');var i=t(62540),o=t(43023);const r={sidebar_position:1,title:"Executing Functions",summary:"Call remote agent functions from tab apps with authentication and custom headers using the exec() method.",languages:["typescript"],suppressLanguageIncludeWarning:!0},a="Executing Functions",c={},u=[{value:"Invoking a remote function",id:"invoking-a-remote-function",level:2},{value:"Function arguments",id:"function-arguments",level:2},{value:"Request headers",id:"request-headers",level:2},{value:"Request bearer token",id:"request-bearer-token",level:2},{value:"Ensuring user consent",id:"ensuring-user-consent",level:2},{value:"References",id:"references",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"executing-functions",children:"Executing Functions"})}),"\n",(0,i.jsxs)(n.p,{children:["The client App exposes an ",(0,i.jsx)(n.code,{children:"exec()"})," method that can be used to call functions implemented in an agent created with this SDK. The function call uses the ",(0,i.jsx)(n.code,{children:"app.http"})," client to make a request, attaching a bearer token created from the ",(0,i.jsx)(n.code,{children:"app.msalInstance"})," MSAL public client application, so that the remote function can authenticate and authorize the caller."]}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"exec()"})," method supports passing arguments and provides options to attach custom request headers and/or controlling the MSAL token scope."]}),"\n",(0,i.jsx)(n.h2,{id:"invoking-a-remote-function",children:"Invoking a remote function"}),"\n",(0,i.jsx)(n.p,{children:"When the tab app and the remote agent are deployed to the same location and in the same AAD app, it's simple to construct the client app and call the function."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import { App } from '@microsoft/teams.client';\n\nconst app = new App(clientId);\nawait app.start();\n\n// this requests a token for 'api://<clientId>/access_as_user' and attaches\n// that to an HTTP POST request to /api/functions/my-function\nconst result = await app.exec<string>('my-function');\n"})}),"\n",(0,i.jsxs)(n.p,{children:["If the deployment is more complex, the ",(0,i.jsx)(n.a,{href:"../app-options",children:"AppOptions"})," can be used to influence the URL as well as the scope in the token."]}),"\n",(0,i.jsx)(n.h2,{id:"function-arguments",children:"Function arguments"}),"\n",(0,i.jsx)(n.p,{children:"Any argument for the remote function can be provided as an object."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"const args = { arg1: 'value1', arg2: 'value2' };\nconst result = await app.exec('my-function', args);\n"})}),"\n",(0,i.jsx)(n.h2,{id:"request-headers",children:"Request headers"}),"\n",(0,i.jsx)(n.p,{children:"By default, the HTTP request will include a header with a bearer token as well as headers that give contextual information about the state of the app, such as which channel or team or chat or meeting the tab is active in."}),"\n",(0,i.jsxs)(n.p,{children:["If needed, you can add additional headers to the ",(0,i.jsx)(n.code,{children:"requestHeaders"})," option field. This may be handy to provide additional context to the remote function, such as a logging correlation ID."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"const requestHeaders = {\n  'x-custom-correlation-id': 'aaaa0000-bb11-2222-33cc-444444dddddd',\n};\n\n// custom headers when the function does not take arguments\nconst result = await app.exec('my-function', undefined, { requestHeaders });\n\n// custom headers when the function takes arguments\nconst args = { arg1: 'value1', arg2: 'value2' };\nconst result = await app.exec('my-other-function', args, { requestHeaders });\n"})}),"\n",(0,i.jsx)(n.h2,{id:"request-bearer-token",children:"Request bearer token"}),"\n",(0,i.jsxs)(n.p,{children:["By default, the HTTP request will include a header with a bearer token acquired by requesting an ",(0,i.jsx)(n.code,{children:"access_as_user"})," permission. The resource used for the request depends on the ",(0,i.jsx)(n.code,{children:"remoteApiOptions.remoteAppResource"})," ",(0,i.jsx)(n.a,{href:"../app-options",children:"AppOption"}),". If this app option is not provided, the token is requested for the scope ",(0,i.jsx)(n.code,{children:"api://<clientId>/access_as_user"}),". If this option is provided, the token is requested for the scope ",(0,i.jsx)(n.code,{children:"<remoteApiOptions.remoteAppResource>/access_as_user"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["When calling a function that requires a different permission or scope, the ",(0,i.jsx)(n.code,{children:"exec"})," options let you override the behavior."]}),"\n",(0,i.jsxs)(n.p,{children:["To specify a custom permission, set the permission field in the ",(0,i.jsx)(n.code,{children:"exec"})," options."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// with this option, the exec() call will request a token for either\n// api://<clientId>/my_custom_permission or\n// <remoteApiOptions.remoteAppResource>/my_custom_permission,\n// depending on the app options used.\nconst options = {\n  permission: 'my_custom_permission',\n};\n\n// custom permission when the function does not take arguments\nconst result = await app.exec('my-function', undefined, options);\n\n// custom permission when the function takes arguments\nconst args = { arg1: 'value1', arg2: 'value2' };\nconst result = await app.exec('my-other-function', args, options);\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Sometimes you may need even more control. You might for need a scope for a different resource than your default when calling a particular remote agent function. In these cases you can provide the exact token request object you need as part of the ",(0,i.jsx)(n.code,{children:"exec"})," options."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// with this option, the exec() call will request a token for exactly\n// api://my-custom-resources/my_custom_scope, regardless of which app\n// options were used to construct the app.\nconst options = {\n  msalTokenRequest: {\n    scopes: ['api://my-custom-resources/my_custom_scope'],\n  },\n};\n\n// custom token request when the function does not take arguments\nconst result = await app.exec('my-function', undefined, options);\n\n// custom token request when the function takes arguments\nconst args = { arg1: 'value1', arg2: 'value2' };\nconst result = await app.exec('my-other-function', args, options);\n"})}),"\n",(0,i.jsx)(n.h2,{id:"ensuring-user-consent",children:"Ensuring user consent"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"exec()"})," function supports incremental, just-in-time consent such that the user is prompted to consent during the ",(0,i.jsx)(n.code,{children:"exec()"})," call, if they haven't already consented earlier."]}),"\n",(0,i.jsxs)(n.p,{children:["If you find that you'd rather test for consent or request consent before making the ",(0,i.jsx)(n.code,{children:"exec()"})," call, the ",(0,i.jsx)(n.code,{children:"hasConsentForScopes"})," and ",(0,i.jsx)(n.code,{children:"ensureConsentForScopes"})," can be used. More details about those are given in the ",(0,i.jsx)(n.a,{href:"../graph",children:"Graph"})," section."]}),"\n",(0,i.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/graph/api/overview",children:"Graph API overview"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/graph/permissions-reference",children:"Graph API permissions overview"})}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}}}]);